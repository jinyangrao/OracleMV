<!DOCTYPE html>
<!-- saved from url=(0062)https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8576 -->
<html lang="zh-CN" style="" class="js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" src="./物化视图的高级查询重写_files/shares.json"></script><script type="text/javascript" src="https://graph.facebook.com/?id=http%3A%2F%2Fdocs.oracle.com%2Fdatabase%2F121%2FDWHSG%2Fqradv.htm%23DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36&amp;callback=_ate.cbs.rcb_i4zv0"></script><script type="text/javascript" src="./物化视图的高级查询重写_files/shares(1).json"></script><script type="text/javascript" src="https://graph.facebook.com/?id=https%3A%2F%2Fdocs.oracle.com%2Fdatabase%2F121%2FDWHSG%2Fqradv.htm%23DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36&amp;callback=_ate.cbs.rcb_jmir0"></script><script type="text/javascript" src="./物化视图的高级查询重写_files/1.txt"></script><script type="text/javascript" src="./物化视图的高级查询重写_files/1(1).txt"></script>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta http-equiv="Content-Type" content="UTF-8">
<title>物化视图的高级查询重写</title>
<meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
<meta name="keywords" content="query delta joins">
<meta name="dcterms.created" content="2017-06-07T18:07:59Z">
<meta name="robots" content="all">
<meta name="dcterms.title" content="Database Data Warehousing Guide">
<meta name="dcterms.identifier" content="E41670-11">
<meta name="dcterms.isVersionOf" content="DWHSG">
<meta name="dcterms.rights" content="Copyright © 2001, 2017, Oracle and/or its affiliates. All rights reserved.">
<link rel="Start" href="https://docs.oracle.com/database/121/index.htm" title="家" type="text/html">
<link rel="Copyright" href="https://docs.oracle.com/database/121/dcommon/html/cpyr.htm" title="版权" type="text/html">

<script type="application/javascript" src="./物化视图的高级查询重写_files/headfoot.js.下载"></script>
<script type="application/javascript" src="./物化视图的高级查询重写_files/doccd.js.下载" charset="UTF-8"></script>
<link rel="Contents" href="https://docs.oracle.com/database/121/DWHSG/toc.htm" title="内容" type="text/html">
<link rel="Index" href="https://docs.oracle.com/database/121/DWHSG/index.htm" title="指数" type="text/html">
<link rel="Glossary" href="https://docs.oracle.com/database/121/DWHSG/glossary.htm" title="词汇表" type="text/html">
<link rel="Prev" href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm" title="以前" type="text/html">
<link rel="Next" href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm" title="下一个" type="text/html">
<link rel="alternate" href="https://docs.oracle.com/database/121/DWHSG/E41670-11.pdf" title="PDF版本" type="application/pdf">
<link rel="schema.dcterms" href="http://purl.org/dc/terms/">
<link rel="stylesheet" href="./物化视图的高级查询重写_files/fusiondoc.css">
<link rel="stylesheet" type="text/css" href="./物化视图的高级查询重写_files/header.css">
<link rel="stylesheet" type="text/css" href="./物化视图的高级查询重写_files/footer.css">
<link rel="stylesheet" type="text/css" href="./物化视图的高级查询重写_files/fonts.css">
<link rel="stylesheet" href="./物化视图的高级查询重写_files/foundation.css">
<link rel="stylesheet" href="./物化视图的高级查询重写_files/codemirror.css">
<link rel="stylesheet" type="text/css" title="默认" href="./物化视图的高级查询重写_files/html5.css">
<link rel="stylesheet" href="./物化视图的高级查询重写_files/respond-480-tablet.css">
<link rel="stylesheet" href="./物化视图的高级查询重写_files/respond-768-laptop.css">
<link rel="stylesheet" href="./物化视图的高级查询重写_files/respond-1140-deskop.css">
<script type="application/javascript" src="./物化视图的高级查询重写_files/modernizr.js.下载"></script>
<script type="application/javascript" src="./物化视图的高级查询重写_files/codemirror.js.下载"></script>
<script type="application/javascript" src="./物化视图的高级查询重写_files/jquery.js.下载"></script>
<script type="application/javascript" src="./物化视图的高级查询重写_files/foundation.min.js.下载"></script><meta class="foundation-data-attribute-namespace"><meta class="foundation-mq-xxlarge"><meta class="foundation-mq-xlarge"><meta class="foundation-mq-large"><meta class="foundation-mq-medium"><meta class="foundation-mq-small"><style></style>
<script type="text/javascript" src="./物化视图的高级查询重写_files/addthis_widget.js.下载" async="async"></script>
<script type="application/javascript" src="./物化视图的高级查询重写_files/jqfns.js.下载"></script>
<script type="application/javascript" src="./物化视图的高级查询重写_files/ohc-inline-videos.js.下载"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="./物化视图的高级查询重写_files/jquery.fancybox.css" type="text/css" media="screen">
<script type="text/javascript" src="./物化视图的高级查询重写_files/jquery.fancybox.pack.js.下载"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet" href="./物化视图的高级查询重写_files/jquery.fancybox-buttons.css" type="text/css" media="screen">
<script type="text/javascript" src="./物化视图的高级查询重写_files/jquery.fancybox-buttons.js.下载"></script>
<script type="text/javascript" src="./物化视图的高级查询重写_files/jquery.fancybox-media.js.下载"></script>
<link rel="stylesheet" href="./物化视图的高级查询重写_files/jquery.fancybox-thumbs.css" type="text/css" media="screen">
<script type="text/javascript" src="./物化视图的高级查询重写_files/jquery.fancybox-thumbs.js.下载"></script>

                    <script async="" src="./物化视图的高级查询重写_files/aksb.min.js.下载"></script><script>var w=window;if(w.performance||w.mozPerformance||w.msPerformance||w.webkitPerformance){var d=document;AKSB=w.AKSB||{},AKSB.q=AKSB.q||[],AKSB.mark=AKSB.mark||function(e,_){AKSB.q.push(["mark",e,_||(new Date).getTime()])},AKSB.measure=AKSB.measure||function(e,_,t){AKSB.q.push(["measure",e,_,t||(new Date).getTime()])},AKSB.done=AKSB.done||function(e){AKSB.q.push(["done",e])},AKSB.mark("firstbyte",(new Date).getTime()),AKSB.prof={custid:"322179",ustr:"",originlat:"0",clientrtt:"35",ghostip:"60.210.22.178",ipv6:false,pct:"10",clientip:"183.195.4.161",requestid:"19e0c7d",region:"15414",protocol:"",blver:14,akM:"ca2",akN:"ae",akTT:"O",akTX:"1",akTI:"19e0c7d",ai:"206465",ra:"false",pmgn:"",pmgi:"",pmp:"",qc:""},function(e){var _=d.createElement("script");_.async="async",_.src=e;var t=d.getElementsByTagName("script"),t=t[t.length-1];t.parentNode.insertBefore(_,t)}(("https:"===d.location.protocol?"https:":"http:")+"//ds-aksb-a.akamaihd.net/aksb.min.js")}</script>
                    <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script><script src="./物化视图的高级查询重写_files/global.js.下载"></script><script src="./物化视图的高级查询重写_files/disclaimer.js.下载" defer=""></script><style type="text/css">.fancybox-margin{margin-right:17px;}</style><style type="text/css">.at-icon{fill:#fff;border:0}.at-icon-wrapper{display:inline-block;overflow:hidden}a .at-icon-wrapper{cursor:pointer}.at-rounded,.at-rounded-element .at-icon-wrapper{border-radius:12%}.at-circular,.at-circular-element .at-icon-wrapper{border-radius:50%}.addthis_32x32_style .at-icon{width:2pc;height:2pc}.addthis_24x24_style .at-icon{width:24px;height:24px}.addthis_20x20_style .at-icon{width:20px;height:20px}.addthis_16x16_style .at-icon{width:1pc;height:1pc}#at16lb{display:none;position:absolute;top:0;left:0;width:100%;height:100%;z-index:1001;background-color:#000;opacity:.001}#at_complete,#at_error,#at_share,#at_success{position:static!important}.at15dn{display:none}#at15s,#at16p,#at16p form input,#at16p label,#at16p textarea,#at_share .at_item{font-family:arial,helvetica,tahoma,verdana,sans-serif!important;font-size:9pt!important;outline-style:none;outline-width:0;line-height:1em}* html #at15s.mmborder{position:absolute!important}#at15s.mmborder{position:fixed!important;width:250px!important}#at15s{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);float:none;line-height:1em;margin:0;overflow:visible;padding:5px;text-align:left;position:absolute}#at15s a,#at15s span{outline:0;direction:ltr;text-transform:none}#at15s .at-label{margin-left:5px}#at15s .at-icon-wrapper{width:1pc;height:1pc;vertical-align:middle}#at15s .at-icon{width:1pc;height:1pc}.at4-icon{display:inline-block;background-repeat:no-repeat;background-position:top left;margin:0;overflow:hidden;cursor:pointer}.addthis_16x16_style .at4-icon,.addthis_default_style .at4-icon,.at4-icon,.at-16x16{width:1pc;height:1pc;line-height:1pc;background-size:1pc!important}.addthis_32x32_style .at4-icon,.at-32x32{width:2pc;height:2pc;line-height:2pc;background-size:2pc!important}.addthis_24x24_style .at4-icon,.at-24x24{width:24px;height:24px;line-height:24px;background-size:24px!important}.addthis_20x20_style .at4-icon,.at-20x20{width:20px;height:20px;line-height:20px;background-size:20px!important}.at4-icon.circular,.circular .at4-icon,.circular.aticon{border-radius:50%}.at4-icon.rounded,.rounded .at4-icon{border-radius:4px}.at4-icon-left{float:left}#at15s .at4-icon{text-indent:20px;padding:0;overflow:visible;white-space:nowrap;background-size:1pc;width:1pc;height:1pc;background-position:top left;display:inline-block;line-height:1pc}.addthis_vertical_style .at4-icon,.at4-follow-container .at4-icon{margin-right:5px}html>body #at15s{width:250px!important}#at15s.atm{background:none!important;padding:0!important;width:10pc!important}#at15s_inner{background:#fff;border:1px solid #fff;margin:0}#at15s_head{position:relative;background:#f2f2f2;padding:4px;cursor:default;border-bottom:1px solid #e5e5e5}.at15s_head_success{background:#cafd99!important;border-bottom:1px solid #a9d582!important}.at15s_head_success a,.at15s_head_success span{color:#000!important;text-decoration:none}#at15s_brand,#at15sptx,#at16_brand{position:absolute}#at15s_brand{top:4px;right:4px}.at15s_brandx{right:20px!important}a#at15sptx{top:4px;right:4px;text-decoration:none;color:#4c4c4c;font-weight:700}#at15sptx:hover{text-decoration:underline}#at16_brand{top:5px;right:30px;cursor:default}#at_hover{padding:4px}#at_hover .at_item,#at_share .at_item{background:#fff!important;float:left!important;color:#4c4c4c!important}#at_share .at_item .at-icon-wrapper{margin-right:5px}#at_hover .at_bold{font-weight:700;color:#000!important}#at_hover .at_item{width:7pc!important;padding:2px 3px!important;margin:1px;text-decoration:none!important}#at_hover .at_item.athov,#at_hover .at_item:focus,#at_hover .at_item:hover{margin:0!important}#at_hover .at_item.athov,#at_hover .at_item:focus,#at_hover .at_item:hover,#at_share .at_item.athov,#at_share .at_item:hover{background:#f2f2f2!important;border:1px solid #e5e5e5;color:#000!important;text-decoration:none}.ipad #at_hover .at_item:focus{background:#fff!important;border:1px solid #fff}.at15t{display:block!important;height:1pc!important;line-height:1pc!important;padding-left:20px!important;background-position:0 0;text-align:left}.addthis_button,.at15t{cursor:pointer}.addthis_toolbox a.at300b,.addthis_toolbox a.at300m{width:auto}.addthis_toolbox a{margin-bottom:5px;line-height:initial}.addthis_toolbox.addthis_vertical_style{width:200px}.addthis_button_facebook_like .fb_iframe_widget{line-height:100%}.addthis_button_facebook_like iframe.fb_iframe_widget_lift{max-width:none}.addthis_toolbox a.addthis_button_counter,.addthis_toolbox a.addthis_button_facebook_like,.addthis_toolbox a.addthis_button_facebook_send,.addthis_toolbox a.addthis_button_facebook_share,.addthis_toolbox a.addthis_button_foursquare,.addthis_toolbox a.addthis_button_google_plusone,.addthis_toolbox a.addthis_button_linkedin_counter,.addthis_toolbox a.addthis_button_pinterest_pinit,.addthis_toolbox a.addthis_button_tweet{display:inline-block}.at-share-tbx-element .google_plusone_iframe_widget>span>div{vertical-align:top!important}.addthis_toolbox span.addthis_follow_label{display:none}.addthis_toolbox.addthis_vertical_style span.addthis_follow_label{display:block;white-space:nowrap}.addthis_toolbox.addthis_vertical_style a{display:block}.addthis_toolbox.addthis_vertical_style.addthis_32x32_style a{line-height:2pc;height:2pc}.addthis_toolbox.addthis_vertical_style .at300bs{margin-right:4px;float:left}.addthis_toolbox.addthis_20x20_style span{line-height:20px}.addthis_toolbox.addthis_32x32_style span{line-height:2pc}.addthis_toolbox.addthis_pill_combo_style .addthis_button_compact .at15t_compact,.addthis_toolbox.addthis_pill_combo_style a{float:left}.addthis_toolbox.addthis_pill_combo_style a.addthis_button_tweet{margin-top:-2px}.addthis_toolbox.addthis_pill_combo_style .addthis_button_compact .at15t_compact{margin-right:4px}.addthis_default_style .addthis_separator{margin:0 5px;display:inline}div.atclear{clear:both}.addthis_default_style .addthis_separator,.addthis_default_style .at4-icon,.addthis_default_style .at300b,.addthis_default_style .at300bo,.addthis_default_style .at300bs,.addthis_default_style .at300m{float:left}.at300b img,.at300bo img{border:0}a.at300b .at4-icon,a.at300m .at4-icon{display:block}.addthis_default_style .at300b,.addthis_default_style .at300bo,.addthis_default_style .at300m{padding:0 2px}.at300b,.at300bo,.at300bs,.at300m{cursor:pointer}.addthis_button_facebook_like.at300b:hover,.addthis_button_facebook_like.at300bs:hover,.addthis_button_facebook_send.at300b:hover,.addthis_button_facebook_send.at300bs:hover{opacity:1}.addthis_20x20_style .at15t,.addthis_20x20_style .at300bs{overflow:hidden;display:block;height:20px!important;width:20px!important;line-height:20px!important}.addthis_32x32_style .at15t,.addthis_32x32_style .at300bs{overflow:hidden;display:block;height:2pc!important;width:2pc!important;line-height:2pc!important}.at300bs{overflow:hidden;display:block;background-position:0 0;height:1pc;width:1pc;line-height:1pc!important}.addthis_default_style .at15t_compact,.addthis_default_style .at15t_expanded{margin-right:4px}#at_share .at_item{width:123px!important;padding:4px;margin-right:2px;border:1px solid #fff}#at16p{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);z-index:10000001;position:absolute;top:50%;left:50%;width:300px;padding:10px;margin:0 auto;margin-top:-185px;margin-left:-155px;font-family:arial,helvetica,tahoma,verdana,sans-serif;font-size:9pt;color:#5e5e5e}#at_share{margin:0;padding:0}#at16pt{position:relative;background:#f2f2f2;height:13px;padding:5px 10px}#at16pt a,#at16pt h4{font-weight:700}#at16pt h4{display:inline;margin:0;padding:0;font-size:9pt;color:#4c4c4c;cursor:default}#at16pt a{position:absolute;top:5px;right:10px;color:#4c4c4c;text-decoration:none;padding:2px}#at15sptx:focus,#at16pt a:focus{outline:thin dotted}#at15s #at16pf a{top:1px}#_atssh{width:1px!important;height:1px!important;border:0!important}.atm{width:10pc!important;padding:0;margin:0;line-height:9pt;letter-spacing:normal;font-family:arial,helvetica,tahoma,verdana,sans-serif;font-size:9pt;color:#444;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgaGAgAjAxEAlGFVJHIUCAAQDcngCUgqGMqwAAAABJRU5ErkJggg==);padding:4px}.atm-f{text-align:right;border-top:1px solid #ddd;padding:5px 8px}.atm-i{background:#fff;border:1px solid #d5d6d6;padding:0;margin:0;box-shadow:1px 1px 5px rgba(0,0,0,.15)}.atm-s{margin:0!important;padding:0!important}.atm-s a:focus{border:transparent;outline:0;transition:none}#at_hover.atm-s a,.atm-s a{display:block;text-decoration:none;padding:4px 10px;color:#235dab!important;font-weight:400;font-style:normal;transition:none}#at_hover.atm-s .at_bold{color:#235dab!important}#at_hover.atm-s a:hover,.atm-s a:hover{background:#2095f0;text-decoration:none;color:#fff!important}#at_hover.atm-s .at_bold{font-weight:700}#at_hover.atm-s a:hover .at_bold{color:#fff!important}.atm-s a .at-label{vertical-align:middle;margin-left:5px;direction:ltr}.at_PinItButton{display:block;width:40px;height:20px;padding:0;margin:0;background-image:url(//s7.addthis.com/static/t00/pinit00.png);background-repeat:no-repeat}.at_PinItButton:hover{background-position:0 -20px}.addthis_toolbox .addthis_button_pinterest_pinit{position:relative}.at-share-tbx-element .fb_iframe_widget span{vertical-align:baseline!important}#at16pf{height:auto;text-align:right;padding:4px 8px}.at-privacy-info{position:absolute;left:7px;bottom:7px;cursor:pointer;text-decoration:none;font-family:helvetica,arial,sans-serif;font-size:10px;line-height:9pt;letter-spacing:.2px;color:#666}.at-privacy-info:hover{color:#000}.body .wsb-social-share .wsb-social-share-button-vert{padding-top:0;padding-bottom:0}.body .wsb-social-share.addthis_counter_style .addthis_button_tweet.wsb-social-share-button{padding-top:40px}.body .wsb-social-share.addthis_counter_style .addthis_button_google_plusone.wsb-social-share-button{padding-top:0}.body .wsb-social-share.addthis_counter_style .addthis_button_facebook_like.wsb-social-share-button{padding-top:21px}@media print{#at4-follow,#at4-share,#at4-thankyou,#at4-whatsnext,#at4m-mobile,#at15s,.at4,.at4-recommended{display:none!important}}@media screen and (max-width:400px){.at4win{width:100%}}@media screen and (max-height:700px) and (max-width:400px){.at4-thankyou-inner .at4-recommended-container{height:122px;overflow:hidden}.at4-thankyou-inner .at4-recommended .at4-recommended-item:first-child{border-bottom:1px solid #c5c5c5}}</style><style type="text/css">.at-branding-logo{font-family:helvetica,arial,sans-serif;text-decoration:none;font-size:10px;display:inline-block;margin:2px 0;letter-spacing:.2px}.at-branding-logo .at-branding-icon{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF////+GlNUkcc1QAAAB1JREFUeNpiYIQDBjQmAwMmkwEM0JnY1WIxFyDAABGeAFEudiZsAAAAAElFTkSuQmCC")}.at-branding-logo .at-branding-icon,.at-branding-logo .at-privacy-icon{display:inline-block;height:10px;width:10px;margin-left:4px;margin-right:3px;margin-bottom:-1px;background-repeat:no-repeat}.at-branding-logo .at-privacy-icon{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAKCAMAAABR24SMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABhQTFRF8fr9ot/xXcfn2/P5AKva////////AKTWodjhjAAAAAd0Uk5T////////ABpLA0YAAAA6SURBVHjaJMzBDQAwCAJAQaj7b9xifV0kUKJ9ciWxlzWEWI5gMF65KUTv0VKkjVeTerqE/x7+9BVgAEXbAWI8QDcfAAAAAElFTkSuQmCC")}.at-branding-logo span{text-decoration:none}.at-branding-logo .at-branding-addthis,.at-branding-logo .at-branding-powered-by{color:#666}.at-branding-logo .at-branding-addthis:hover{color:#333}.at-cv-with-image .at-branding-addthis,.at-cv-with-image .at-branding-addthis:hover{color:#fff}a.at-branding-logo:visited{color:initial}.at-branding-info{display:inline-block;padding:0 5px;color:#666;border:1px solid #666;border-radius:50%;font-size:10px;line-height:9pt;opacity:.7;transition:all .3s ease;text-decoration:none}.at-branding-info span{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.at-branding-info:before{content:'i';font-family:Times New Roman}.at-branding-info:hover{color:#0780df;border-color:#0780df}</style><meta name="viewport" content="width=device-width,initial-scale=1.0"><script type="text/javascript" charset="utf-8" async="" src="./物化视图的高级查询重写_files/layers.c387ea0d8ef6d16b44e4.js.下载"></script><style type="text/css">.at-share-dock.atss{top:auto;left:0;right:0;bottom:0;width:100%;max-width:100%;z-index:1000200;box-shadow:0 0 1px 1px #e2dfe2}.at-share-dock.at-share-dock-zindex-hide{z-index:-1!important}.at-share-dock.atss-top{bottom:auto;top:0}.at-share-dock a{width:auto;transition:none;color:#fff;text-decoration:none;box-sizing:content-box;-webkit-box-sizing:content-box;-moz-box-sizing:content-box}.at-share-dock a:hover{width:auto}.at-share-dock .at4-count{height:43px;padding:5px 0 0;line-height:20px;background:#fff;font-family:Helvetica neue,arial}.at-share-dock .at4-count span{width:100%}.at-share-dock .at4-count .at4-share-label{color:#848484;font-size:10px;letter-spacing:1px}.at-share-dock .at4-count .at4-counter{top:2px;position:relative;display:block;color:#222;font-size:22px}.at-share-dock.at-shfs-medium .at4-count{height:36px;line-height:1pc;padding-top:4px}.at-share-dock.at-shfs-medium .at4-count .at4-counter{font-size:18px}.at-share-dock.at-shfs-medium .at-share-btn .at-icon-wrapper,.at-share-dock.at-shfs-medium a .at-icon-wrapper{padding:6px 0}.at-share-dock.at-shfs-small .at4-count{height:26px;line-height:1;padding-top:3px}.at-share-dock.at-shfs-small .at4-count .at4-share-label{font-size:8px}.at-share-dock.at-shfs-small .at4-count .at4-counter{font-size:14px}.at-share-dock.at-shfs-small .at-share-btn .at-icon-wrapper,.at-share-dock.at-shfs-small a .at-icon-wrapper{padding:4px 0}</style><style type="text/css">div.at-share-close-control.ats-dark,div.at-share-open-control-left.ats-dark,div.at-share-open-control-right.ats-dark{background:#262b30}div.at-share-close-control.ats-light,div.at-share-open-control-left.ats-light,div.at-share-open-control-right.ats-light{background:#fff}div.at-share-close-control.ats-gray,div.at-share-open-control-left.ats-gray,div.at-share-open-control-right.ats-gray{background:#f2f2f2}.atss{position:fixed;top:20%;width:3pc;z-index:100020;background:none}.at-share-close-control{position:relative;width:3pc;overflow:auto}.at-share-open-control-left{position:fixed;top:20%;z-index:100020;left:0;width:22px}.at-share-close-control .at4-arrow.at-left{float:right}.atss-left{left:0;float:left;right:auto}.atss-right{left:auto;float:right;right:0}.atss-right.at-share-close-control .at4-arrow.at-right{position:relative;right:0;overflow:auto}.atss-right.at-share-close-control .at4-arrow{float:left}.at-share-open-control-right{position:fixed;top:20%;z-index:100020;right:0;width:22px;float:right}.atss-right .at-share-close-control .at4-arrow{float:left}.atss.atss-right a{float:right}.atss.atss-right .at4-share-title{float:right;overflow:hidden}.atss .at-share-btn,.atss a{position:relative;display:block;width:3pc;margin:0;outline-offset:-1px;text-align:center;float:left;transition:width .15s ease-in-out;overflow:hidden;background:#e8e8e8;z-index:100030;cursor:pointer}.at-share-btn::-moz-focus-inner{border:0;padding:0}.atss-right .at-share-btn{float:right}.atss .at-share-btn{border:0;padding:0}.atss .at-share-btn:focus,.atss .at-share-btn:hover,.atss a:focus,.atss a:hover{width:4pc}.atss .at-share-btn .at-icon-wrapper,.atss a .at-icon-wrapper{display:block;padding:8px 0}.atss .at-share-btn:last-child,.atss a:last-child{border:none}.atss .at-share-btn span .at-icon,.atss a span .at-icon{position:relative;top:0;left:0;display:block;background-repeat:no-repeat;background-position:50% 50%;width:2pc;height:2pc;line-height:2pc;border:none;padding:0;margin:0 auto;overflow:hidden;cursor:pointer;cursor:hand}.at4-share .at-custom-sidebar-counter{font-family:Helvetica neue,arial;vertical-align:top;margin-right:4px;display:inline-block;text-align:center}.at4-share .at-custom-sidebar-count{font-size:17px;line-height:1.25em;color:#222}.at4-share .at-custom-sidebar-text{font-size:9px;line-height:1.25em;color:#888;letter-spacing:1px}.at4-share .at4-share-count-container{position:absolute;left:0;right:auto;top:auto;bottom:0;width:100%;color:#fff;background:inherit}.at4-share .at4-share-count,.at4-share .at4-share-count-container{line-height:1pc;font-size:10px}.at4-share .at4-share-count{text-indent:0;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-weight:200;width:100%;height:1pc}.at4-share .at4-share-count-anchor{padding-bottom:8px;text-decoration:none;transition:padding .15s ease-in-out .15s,width .15s ease-in-out}</style><style type="text/css">#at4-drawer-outer-container{top:0;width:20pc;position:fixed}#at4-drawer-outer-container.at4-drawer-inline{position:relative}#at4-drawer-outer-container.at4-drawer-inline.at4-drawer-right{float:right;right:0;left:auto}#at4-drawer-outer-container.at4-drawer-inline.at4-drawer-left{float:left;left:0;right:auto}#at4-drawer-outer-container.at4-drawer-shown,#at4-drawer-outer-container.at4-drawer-shown *{z-index:999999}#at4-drawer-outer-container,#at4-drawer-outer-container .at4-drawer-outer,#at-drawer{height:100%;overflow-y:auto;overflow-x:hidden}.at4-drawer-push-content-right-back{position:relative;right:0}.at4-drawer-push-content-right{position:relative;left:20pc!important}.at4-drawer-push-content-left-back{position:relative;left:0}.at4-drawer-push-content-left{position:relative;right:20pc!important}#at4-drawer-outer-container.at4-drawer-right{left:auto;right:-20pc}#at4-drawer-outer-container.at4-drawer-left{right:auto;left:-20pc}#at4-drawer-outer-container.at4-drawer-shown.at4-drawer-right{left:auto;right:0}#at4-drawer-outer-container.at4-drawer-shown.at4-drawer-left{right:auto;left:0}#at-drawer{top:0;z-index:9999999;height:100%;animation-duration:.4s}#at-drawer.drawer-push.at-right{right:-20pc}#at-drawer.drawer-push.at-left{left:-20pc}#at-drawer .at-recommended-label{padding:0 0 0 20px;color:#999;line-height:3pc;font-size:18px;font-weight:300;cursor:default}#at-drawer-arrow{width:30px;height:5pc}#at-drawer-arrow.ats-dark{background:#262b30}#at-drawer-arrow.ats-gray{background:#f2f2f2}#at-drawer-open-arrow{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAABcCAYAAAC1OT8uAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk3ODNCQjdERUQ3QjExRTM5NjFGRUZBODc3MTIwMTNCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk3ODNCQjdFRUQ3QjExRTM5NjFGRUZBODc3MTIwMTNCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTc4M0JCN0JFRDdCMTFFMzk2MUZFRkE4NzcxMjAxM0IiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTc4M0JCN0NFRDdCMTFFMzk2MUZFRkE4NzcxMjAxM0IiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7kstzCAAAB4ElEQVR42uyWv0oDQRDGb9dYimgVjliID2Ca9AGfwtZob2Grja1PIFj7EhGCYK99VPBPOkVMp8X5rc6FeN7dfjOksMjAxwXZ3667OzvfLKRr682l5ZV9aDh+fxsnRHhoDzqGLjFBi4XOoFtoAxowoB893o/w7WpAl/+QgQMBwwRdTPhUC2lAV/wDA7qy5WOgq9psHejqTqkKdLE7KYCv0JZjMgBgB58raBG6mP1K6j2pT099T+qMUOeeOss1wDcEIA1PnQXy576rAUI0oFMoC7VCnn40Gs8Pd4lAiXNUKmJ0lh1mPzGEWiyUCqAGW3Pwv4IvUJsFO9CHgP3Zr6Te0xwgAf3LxaAjS241pbikCRkOg+nSJdV4p8HOPl3vvRYI5dtrgVDvvcWovcWovcWovcWovcWovcWovQChWNywNpqvdAKtQp/QNmPUIQ6kwwqt2Xmsxf6GMPM1Pptsbz45CPmXqKb+15Gz4J/LZcDSNIqBlQlbB0afe1mmUDWiCNKFZRq0VKMeXY1CTDq2sJLWsCmoaBBRqNRR6qBKC6qCaj2rDIqaXBGiXHEaom00h1S+K3fVlr6HNuqgvgCh0+owt21bybQn8+mZ78mcEebcM2e5+T2ZX24ZqCph0qn1vgQYAJ/KDpLQr2tPAAAAAElFTkSuQmCC);background-repeat:no-repeat;width:13px;height:23px;margin:28px 0 0 8px}.at-left #at-drawer-open-arrow{background-position:0 -46px}.ats-dark #at-drawer-open-arrow{background-position:0 -23px}.ats-dark.at-left #at-drawer-open-arrow{background-position:0 -69px}#at-drawer-arrow.at4-drawer-modern-browsers{position:fixed;top:40%;background-repeat:no-repeat;background-position:0 0!important;z-index:9999999}.at4-drawer-inline #at-drawer-arrow{position:absolute}#at-drawer-arrow.at4-drawer-modern-browsers.at-right{right:0}#at-drawer-arrow.at4-drawer-modern-browsers.at-left{left:0}.at4-drawer-push-animation-left{transition:left .4s ease-in-out .15s}.at4-drawer-push-animation-right{transition:right .4s ease-in-out .15s}#at-drawer.drawer-push.at4-drawer-push-animation-right{right:0}#at-drawer.drawer-push.at4-drawer-push-animation-right-back{right:-20pc!important}#at-drawer.drawer-push.at4-drawer-push-animation-left{left:0}#at-drawer.drawer-push.at4-drawer-push-animation-left-back{left:-20pc!important}#at-drawer .at4-closebutton.drawer-close{content:'X';color:#999;display:block;position:absolute;margin:0;top:0;right:0;width:3pc;height:45px;line-height:45px;overflow:hidden;opacity:.5}#at-drawer.ats-dark .at4-closebutton.drawer-close{color:#fff}#at-drawer .at4-closebutton.drawer-close:hover{opacity:1}#at-drawer.ats-dark.at4-recommended .at4-logo-container a{color:#666}#at-drawer.at4-recommended .at4-recommended-vertical{padding:0}#at-drawer.at4-recommended .at4-recommended-item .sponsored-label{margin:2px 0 0 21px;color:#ddd}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item{position:relative;padding:0;width:20pc;height:180px;margin:0}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img a:after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.65);z-index:1000000;transition:all .2s ease-in-out}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item.at-hover .at4-recommended-item-img a:after{background:rgba(0,0,0,.8)}#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img,#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img a,#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img img{width:20pc;height:180px;float:none}#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption{width:100%;position:absolute;bottom:0;left:0;height:70px}#at-drawer .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4{color:#fff;position:absolute;height:52px;top:0;left:20px;right:20px;margin:0;padding:0;line-height:25px;font-size:20px;font-weight:600;z-index:1000001;text-decoration:none;text-transform:none}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4 a:hover{text-decoration:none}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4 a:link{color:#fff}#at-drawer.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption small{position:absolute;top:auto;bottom:10px;left:20px;width:auto;color:#ccc}#at-drawer.at4-recommended .at4-logo-container{margin-left:20px}#at-drawer.ats-dark.at4-recommended .at4-logo-container a:hover{color:#fff}#at-drawer.at4-recommended .at-logo{margin:0}</style><style type="text/css">.at4-follow.at-mobile{display:none!important}.at4-follow{position:fixed;top:0;right:0;font-weight:400;color:#666;cursor:default;z-index:10001}.at4-follow .at4-follow-inner{position:relative;padding:10px 24px 10px 15px}.at4-follow-inner,.at-follow-open-control{border:0 solid #c5c5c5;border-width:1px 0 1px 1px;margin-top:-1px}.at4-follow .at4-follow-container{margin-left:9pt}.at4-follow.at4-follow-24 .at4-follow-container{height:24px;line-height:23px;font-size:13px}.at4-follow.at4-follow-32 .at4-follow-container{width:15pc;height:2pc;line-height:2pc;font-size:14px}.at4-follow .at4-follow-container .at-follow-label{display:inline-block;height:24px;line-height:24px;margin-right:10px;padding:0;cursor:default;float:left}.at4-follow .at4-follow-container .at-icon-wrapper{height:24px;width:24px}.at4-follow.ats-transparent .at4-follow-inner,.at-follow-open-control.ats-transparent{border-color:transparent}.at4-follow.ats-dark .at4-follow-inner,.at-follow-open-control.ats-dark{background:#262b30;border-color:#000;color:#fff}.at4-follow.ats-dark .at-follow-close-control{background-color:#262b30}.at4-follow.ats-light .at4-follow-inner{background:#fff;border-color:#c5c5c5}.at4-follow.ats-gray .at4-follow-inner,.at-follow-open-control.ats-gray{background:#f2f2f2;border-color:#c5c5c5}.at4-follow.ats-light .at4-follow-close-control,.at-follow-open-control.ats-light{background:#e5e5e5}.at4-follow .at4-follow-inner .at4-follow-close-control{position:absolute;top:0;bottom:0;left:0;width:20px;cursor:pointer;display:none}.at4-follow .at4-follow-inner .at4-follow-close-control div{display:block;line-height:20px;text-indent:-9999em;margin-top:calc(50% + 1px);overflow:hidden}.at-follow-open-control div.at4-arrow.at-left{background-position:0 -2px}.at-follow-open-control{position:fixed;height:35px;top:0;right:0;padding-top:10px;z-index:10002}.at-follow-btn{margin:0 5px 5px 0;padding:0;outline-offset:-1px;display:inline-block;box-sizing:content-box;transition:all .2s ease-in-out}.at-follow-btn:focus,.at-follow-btn:hover{transform:translateY(-4px)}.at4-follow-24 .at-follow-btn{height:25px;line-height:0;width:25px}</style><style type="text/css">.at-follow-tbx-element .at300b,.at-follow-tbx-element .at300m{display:inline-block;width:auto;padding:0;margin:0 2px 5px;outline-offset:-1px;transition:all .2s ease-in-out}.at-follow-tbx-element .at300b:focus,.at-follow-tbx-element .at300b:hover,.at-follow-tbx-element .at300m:focus,.at-follow-tbx-element .at300m:hover{transform:translateY(-4px)}.at-follow-tbx-element .addthis_vertical_style .at300b,.at-follow-tbx-element .addthis_vertical_style .at300m{display:block}.at-follow-tbx-element .addthis_vertical_style .at300b .addthis_follow_label,.at-follow-tbx-element .addthis_vertical_style .at300b .at-icon-wrapper,.at-follow-tbx-element .addthis_vertical_style .at300m .addthis_follow_label,.at-follow-tbx-element .addthis_vertical_style .at300m .at-icon-wrapper{display:inline-block;vertical-align:middle;margin-right:5px}.at-follow-tbx-element .addthis_vertical_style .at300b:focus,.at-follow-tbx-element .addthis_vertical_style .at300b:hover,.at-follow-tbx-element .addthis_vertical_style .at300m:focus,.at-follow-tbx-element .addthis_vertical_style .at300m:hover{transform:none}</style><style type="text/css">.at4-jumboshare .at-share-btn{display:inline-block;margin-right:13px;margin-top:13px}.at4-jumboshare .at-share-btn .at-icon{float:left}.at4-jumboshare .at-share-btn .at300bs{display:inline-block;float:left;cursor:pointer}.at4-jumboshare .at4-mobile .at-share-btn .at-icon,.at4-jumboshare .at4-mobile .at-share-btn .at-icon-wrapper{margin:0;padding:0}.at4-jumboshare .at4-mobile .at-share-btn{padding:0}.at4-jumboshare .at4-mobile .at-share-btn .at-label{display:none}.at4-jumboshare .at4-count{font-size:60px;line-height:60px;font-family:Helvetica neue,arial;font-weight:700}.at4-jumboshare .at4-count-container{display:table-cell;text-align:center;min-width:200px;vertical-align:middle;border-right:1px solid #ccc;padding-right:20px}.at4-jumboshare .at4-share-container{display:table-cell;vertical-align:middle;padding-left:20px}.at4-jumboshare .at4-share-container.at-share-tbx-element{padding-top:0}.at4-jumboshare .at4-title{position:relative;font-size:18px;line-height:18px;bottom:2px}.at4-jumboshare .at4-spacer{height:1px;display:block;visibility:hidden;opacity:0}.at4-jumboshare .at-share-btn{display:inline-block;margin:0 2px;line-height:0;padding:0;overflow:hidden;text-decoration:none;text-transform:none;color:#fff;cursor:pointer;transition:all .2s ease-in-out;border:0;background-color:transparent}.at4-jumboshare .at-share-btn:focus,.at4-jumboshare .at-share-btn:hover{transform:translateY(-4px);color:#fff;text-decoration:none}.at4-jumboshare .at-label{font-family:helvetica neue,helvetica,arial,sans-serif;font-size:9pt;padding:0 15px 0 0;margin:0;height:2pc;line-height:2pc;background:none}.at4-jumboshare .at-share-btn:hover,.at4-jumboshare .at-share-btn:link{text-decoration:none}.at4-jumboshare .at-share-btn::-moz-focus-inner{border:0;padding:0}.at4-jumboshare.at-mobile .at-label{display:none}</style><style type="text/css">.at4-recommendedbox-outer-container{display:inline}.at4-recommended-outer{position:static}.at4-recommended{top:20%;margin:0;text-align:center;font-weight:400;font-size:13px;line-height:17px;color:#666}.at4-recommended.at-inline .at4-recommended-horizontal{text-align:left}.at4-recommended-recommendedbox{padding:0;z-index:inherit}.at4-recommended-recommended{padding:40px 0}.at4-recommended-horizontal{max-height:340px}.at4-recommended.at-medium .at4-recommended-horizontal{max-height:15pc}.at4-recommended.at4-minimal.at-medium .at4-recommended-horizontal{padding-top:10px;max-height:230px}.at4-recommended-text-only .at4-recommended-horizontal{max-height:130px}.at4-recommended-horizontal{padding-top:5px;overflow-y:hidden}.at4-minimal{background:none;color:#000;border:none!important;box-shadow:none!important}@media screen and (max-width:900px){.at4-recommended-horizontal .at4-recommended-item,.at4-recommended-horizontal .at4-recommended-item .at4-recommended-item-img{width:15pc}}.at4-recommended.at4-minimal .at4-recommended-horizontal .at4-recommended-item .at4-recommended-item-caption{padding:0 0 10px}.at4-recommended.at4-minimal .at4-recommended-horizontal .at4-recommended-item-caption{padding:20px 0 0!important}.addthis-smartlayers .at4-recommended .at-h3.at-recommended-label{margin:0;padding:0;font-weight:300;font-size:18px;line-height:24px;color:#464646;width:100%;display:inline-block;zoom:1}.addthis-smartlayers .at4-recommended.at-inline .at-h3.at-recommended-label{text-align:left}#at4-thankyou .addthis-smartlayers .at4-recommended.at-inline .at-h3.at-recommended-label{text-align:center}.at4-recommended .at4-recommended-item{display:inline-block;zoom:1;position:relative;background:#fff;border:1px solid #c5c5c5;width:200px;margin:10px}.addthis_recommended_horizontal .at4-recommended-item{border:none}.at4-recommended .at4-recommended-item .sponsored-label{color:#666;font-size:9px;position:absolute;top:-20px}.at4-recommended .at4-recommended-item-img .at-tli,.at4-recommended .at4-recommended-item-img a{position:absolute;left:0}.at4-recommended.at-inline .at4-recommended-horizontal .at4-recommended-item{margin:10px 20px 0 0}.at4-recommended.at-medium .at4-recommended-horizontal .at4-recommended-item{margin:10px 10px 0 0}.at4-recommended.at-medium .at4-recommended-item{width:140px;overflow:hidden}.at4-recommended .at4-recommended-item .at4-recommended-item-img{position:relative;text-align:center;width:100%;height:200px;line-height:0;overflow:hidden}.at4-recommended .at4-recommended-item .at4-recommended-item-img a{display:block;width:100%;height:200px}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-img,.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-img a{height:140px}.at4-recommended .at4-recommended-item .at4-recommended-item-img img{position:absolute;top:0;left:0;min-height:0;min-width:0;max-height:none;max-width:none;margin:0;padding:0}.at4-recommended .at4-recommended-item .at4-recommended-item-caption{height:74px;overflow:hidden;padding:20px;text-align:left;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-caption{height:50px;padding:15px}.at4-recommended .at4-recommended-item .at4-recommended-item-caption .at-h4{height:54px;margin:0 0 5px;padding:0;overflow:hidden;word-wrap:break-word;font-size:14px;font-weight:400;line-height:18px;text-align:left}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-caption .at-h4{font-size:9pt;line-height:1pc;height:33px}.at4-recommended .at4-recommended-item:hover .at4-recommended-item-caption .at-h4{text-decoration:underline}.at4-recommended a:link,.at4-recommended a:visited{text-decoration:none;color:#464646}.at4-recommended .at4-recommended-item .at4-recommended-item-caption .at-h4 a:hover{text-decoration:underline;color:#000}.at4-recommended .at4-recommended-item .at4-recommended-item-caption small{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:11px;color:#666}.at4-recommended.at-medium .at4-recommended-item .at4-recommended-item-caption small{font-size:9px}.at4-recommended .at4-recommended-vertical{padding:15px 0 0}.at4-recommended .at4-recommended-vertical .at4-recommended-item{display:block;width:auto;max-width:100%;height:60px;border:none;margin:0 0 15px;box-shadow:none;background:none}.at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img,.at4-recommended-vertical .at4-recommended-item .at4-recommended-item-img img{width:60px;height:60px;float:left}.at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption{border-top:none;margin:0;height:60px;padding:3px 5px}.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption .at-h4{height:38px;margin:0}.at4-recommended .at4-recommended-vertical .at4-recommended-item .at4-recommended-item-caption small{position:absolute;bottom:0}.at4-recommended .at-recommended-label.at-vertical{text-align:left}.at4-no-image-light-recommended,.at4-no-image-minimal-recommended{background-color:#f2f2f2!important}.at4-no-image-gray-recommended{background-color:#e6e6e5!important}.at4-no-image-dark-recommended{background-color:#4e555e!important}.at4-recommended .at4-recommended-item-placeholder-img{background-repeat:no-repeat!important;background-position:center!important;width:100%!important;height:100%!important}.at4-recommended-horizontal .at4-no-image-dark-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAfCAYAAACCox+xAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjlFNUUyQTg3MTI0RDExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjlFNUUyQTg4MTI0RDExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OUU1RTJBODUxMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OUU1RTJBODYxMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6oCfPiAAABfUlEQVR42uyWTU/DMAyGm3bdBxp062hHe+PC//9HCIkDYpNAO7CPAuWN5Eohyhpno2GHWqq8pO78xHHsiLquH4L/l6cwuBAZaOPKs//YBFIJIR59UiAt7huYi90aE/UQakTDLaL26RUEAAJqiefm93T9Bpj1X4O0bY0OIUXCpYBJvYDAUWyAUCWliHGTcnpqRMaM72ImRAJVknYG+eb4YEDIBeU0zGnsBLK1ODogYSsLhDwIJeVVk18lzfNA4ERGZNXi59UCIQhiYDilpSm/jp4awLxDvWhlf4/nGe8+LLuSt+SZul28ggaHG6gNVhDR+IuRFzOoxGKWwG7vVFm5AAQxgcqYpzrjFjR9zwPH5LSuT7XlNr2MQm5LzqjLpncNNaM+s8M27Y60g3FwhoSMzrtUQllgLtRs5pZ2cB4IhbvQbGRZv1NsrhyS8+SI5Mo9RJWpjAI1xqKL+0iEP180vy214JbeR12AyOgsHI7e0NfFyKv0ID1ID+IqPwIMAOeljGQOryBmAAAAAElFTkSuQmCC)!important}.at4-recommended-vertical .at4-no-image-dark-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAOCAYAAADwikbvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzREMyNTM2MTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAzREMyNTM3MTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDNEQzI1MzQxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDNEQzI1MzUxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5GfbtkAAAAxklEQVR42qRSTQvCMAxduk53mEOHKFPP/v8/5cGTiIibivVFUomlG7gFHvloXpKmJefcPhkmNyvGEWj+IOZA6ckPImoxxVwOLvCvXUzkpayNCpRQK64IbOBnAYGAXMeMslNlU+CzrIEdCkxi5DPAoz6BE8ZuVNdKJuL8rS9sv62IXlCHyP0KqKUKZXK9uwkSLVArfwpVR3b225kXwovibcP+jC4jUtfWPZmfqJJnYlkAM128j1z0nHWKSUbIKDL/msHktwADAPptQo+vkZNLAAAAAElFTkSuQmCC)!important}.at4-recommended-horizontal .at4-no-image-gray-recommended .at4-recommended-item-placeholder-img,.at4-recommended-horizontal .at4-no-image-light-recommended .at4-recommended-item-placeholder-img,.at4-recommended-horizontal .at4-no-image-minimal-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAfCAYAAACCox+xAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzREMyNTMyMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAzREMyNTMzMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OUU1RTJBODkxMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OUU1RTJBOEExMjREMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6dfDQvAAABg0lEQVR42uyWS0vDQBDH82jaKNW0qUltbl68e/Di98eLBz+CCB5EBaWIpUat/4UJLMuame1j7SEDYbqbKfPLvHbDi8ur8+D/5T4K9kR6xrr27D+xgdS3N9d3PilQFmcNzN6mxkbdhxrQcoGofXkFAUAINcVzrG2vsP8KmJdtg7SlxoRQouBywOReQOAosUDoklPEpEU5XDciqeB/iRAig6pIO4P8CHysBBDqg0palrR2Alkwjj5RsDUDoRqhorpq6quifRkInKiIPLf4eWIgQoLoWbq0stXXn10DmDeoR2PsL/E84N0Hk5Wypc70dMkGGhzOoeb4gpjW34K6GEFljFkGu6XTZJUCEMQBVCHs6kI60MycB47FyUmo20oPvYJCzhVnvIsR3zg5ghoRTNpyHKTBBhIJTt6pFsoZ9iLDZswcB5uBULhnho0a66eazaFDca59Hym1e4guQ4rCO4Fu/T4Sw8Gk+c3MghN6H+8CRKVg4tB6fV8XI6/SgXQgHYir/AowAMU5TskhKVUNAAAAAElFTkSuQmCC)!important}.at4-recommended-vertical .at4-no-image-gray-recommended .at4-recommended-item-placeholder-img,.at4-recommended-vertical .at4-no-image-light-recommended .at4-recommended-item-placeholder-img,.at4-recommended-vertical .at4-no-image-minimal-recommended .at4-recommended-item-placeholder-img{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAOCAYAAADwikbvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjAzREMyNTNBMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjAzREMyNTNCMTI0RjExRTM4NzAwREJDRjlCQzAyMUVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDNEQzI1MzgxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MDNEQzI1MzkxMjRGMTFFMzg3MDBEQkNGOUJDMDIxRUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz65Fr9cAAAA0ElEQVR42qRRuQrCQBDd3SSaIgYNosSrtLew8f+xsfAnYmEVRMR4YHwjExjCbsBk4DHHzptjR2+2u7VqJ3efjTNQ/EEMgbgiv46H/QNTDPnhCv/mYiLPI21EIIaaUEVgBj+oETQQypgRtidsXfNJpsACBXo28gWgUd9AjrEL0TXhiSh/XhWudlZI/kCdLPtFUGMRCni9p6kl+kAq/D5UavmzX2fNd87obsCSfztnrOR0rjvTiRImkoyAQQNRyZ2jhjenGNVBOpF1WZatyV8BBgBJ+irgS/KHdAAAAABJRU5ErkJggg==)!important}#at-drawer.ats-dark,.at4-recommended.ats-dark .at4-recommended-horizontal .at4-recommended-item-caption,.at4-recommended.ats-dark .at4-recommended-vertical .at4-recommended-item-caption{background:#262b30}#at-drawer.ats-gray,.at4-recommended.ats-gray .at4-recommended-horizontal .at4-recommended-item-caption{background:#f2f2f2}#at-drawer.ats-light,.at4-recommended.ats-light .at4-recommended-horizontal .at4-recommended-item-caption{background:#fff}.at4-recommended.ats-dark .at4-recommended-vertical .at4-recommended-item{background:none}.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption a:hover,.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption a:link,.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption a:visited,.at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption small,.at4-recommended.ats-dark .at4-recommended-item-caption,.at4-recommended.ats-dark .at-logo a:hover,.at4-recommended.ats-dark .at-recommended-label.at-vertical{color:#fff}.at4-recommended-vertical-logo{padding-top:0;text-align:left}.at4-recommended-vertical-logo .at4-logo-container{line-height:10px}.at4-recommended-horizontal-logo{text-align:center}.at4-recommended.at-inline .at4-recommended-horizontal-logo{text-align:left}#at4-thankyou .at4-recommended.at-inline .at4-recommended-horizontal{text-align:center}.at4-recommended .at-logo{margin:10px 0 0;padding:0;height:25px;overflow:auto;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}.at4-recommended.at-inline .at4-recommended-horizontal .at-logo{text-align:left}.at4-recommended .at4-logo-container a.at-sponsored-link{color:#666}.at4-recommended-class .at4-logo-container a:hover,.at4-recommendedbox-outer-container .at4-recommended-recommendedbox .at4-logo-container a:hover{color:#000}</style><style type="text/css">.at-recommendedjumbo-outer-container{margin:0;padding:0;border:0;background:none;color:#000}.at-recommendedjumbo-footer{position:relative;width:100%;height:510px;overflow:hidden;transition:all .3s ease-in-out}.at-mobile .at-recommendedjumbo-footer{height:250px}.at-recommendedjumbo-footer #bg-link:after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.75)}.at-recommendedjumbo-footer:hover #bg-link:after{background:rgba(0,0,0,.85)}.at-recommendedjumbo-footer *,.at-recommendedjumbo-footer :after,.at-recommendedjumbo-footer :before{box-sizing:border-box}.at-recommendedjumbo-footer:hover #at-recommendedjumbo-footer-bg{animation:atRecommendedJumboAnimatedBackground 1s ease-in-out 1;animation-fill-mode:forwards}.at-recommendedjumbo-footer #at-recommendedjumbo-top-holder{position:absolute;top:0;padding:0 40px;width:100%}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-top-holder{padding:0 20px}.at-recommendedjumbo-footer .at-recommendedjumbo-footer-inner{position:relative;text-align:center;font-family:helvetica,arial,sans-serif;z-index:2;width:100%}.at-recommendedjumbo-footer #at-recommendedjumbo-label-holder{margin:40px 0 0;max-height:30px}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-label-holder{margin:20px 0 0;max-height:20px}.at-recommendedjumbo-footer #at-recommendedjumbo-label{font-weight:300;font-size:24px;line-height:24px;color:#fff;margin:0}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-label{font-weight:150;font-size:14px;line-height:14px}.at-recommendedjumbo-footer #at-recommendedjumbo-title-holder{margin:20px 0 0;min-height:3pc;max-height:78pt}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-title-holder{margin:10px 0 0;min-height:24px;max-height:54px}.at-recommendedjumbo-footer #at-recommendedjumbo-content-title{font-size:3pc;line-height:52px;font-weight:700;margin:0}.at-mobile .at-recommendedjumbo-footer #at-recommendedjumbo-content-title{font-size:24px;line-height:27px}.at-recommendedjumbo-footer a{text-decoration:none;color:#fff}.at-recommendedjumbo-footer a:visited{color:#fff}.at-recommendedjumbo-footer small{margin:20px 0 0;display:inline-block;height:2pc;line-height:2pc;font-size:14px;color:#ccc;cursor:default}.at-mobile .at-recommendedjumbo-footer small{margin:10px 0 0;height:14px;line-height:14px;font-size:9pt}.at-recommendedjumbo-footer .at-logo-container{position:absolute;bottom:20px;margin:auto;left:0;right:0}.at-mobile .at-recommendedjumbo-footer .at-logo-container{bottom:10px}.at-recommendedjumbo-footer a.at-sponsored-link{color:#ccc}.at-recommendedjumbo-footer div #at-recommendedjumbo-logo-link{padding:2px 0 0 11px;text-decoration:none;line-height:20px;font-family:helvetica,arial,sans-serif;font-size:9px;color:#ccc}@keyframes atRecommendedJumboAnimatedBackground{0%{transform:scale(1,1)}to{transform:scale(1.1,1.1)}}</style><style type="text/css">.at-resp-share-element{position:relative;padding:0;margin:0;font-size:0;line-height:0}.at-resp-share-element:after,.at-resp-share-element:before{content:" ";display:table}.at-resp-share-element.at-mobile .at4-share-count-container,.at-resp-share-element.at-mobile .at-label{display:none}.at-resp-share-element .at-share-btn{display:inline-block;*display:inline;*zoom:1;margin:0 2px 5px;padding:0;overflow:hidden;line-height:0;text-decoration:none;text-transform:none;color:#fff;cursor:pointer;transition:all .2s ease-in-out;border:0;font-family:helvetica neue,helvetica,arial,sans-serif;background-color:transparent}.at-resp-share-element .at-share-btn::-moz-focus-inner{border:0;padding:0}.at-resp-share-element .at-share-btn:focus,.at-resp-share-element .at-share-btn:hover{transform:translateY(-4px);color:#fff;text-decoration:none}.at-resp-share-element .at-share-btn .at-icon-wrapper{float:left}.at-resp-share-element .at-share-btn.at-share-btn.at-svc-compact:hover{transform:none}.at-resp-share-element .at-share-btn .at-label{font-family:helvetica neue,helvetica,arial,sans-serif;font-size:9pt;padding:0 15px 0 0;margin:0 0 0 5px;height:2pc;line-height:2pc;background:none}.at-resp-share-element .at-icon,.at-resp-share-element .at-label{cursor:pointer}.at-resp-share-element .at4-share-count-container{text-decoration:none;float:right;padding-right:15px;font-size:9pt}.at-mobile .at-resp-share-element .at-label{display:none}.at-resp-share-element.at-mobile .at-share-btn{margin-right:5px}.at-mobile .at-resp-share-element .at-share-btn{padding:5px;margin-right:5px}</style><style type="text/css">.at-share-tbx-element{position:relative;margin:0;color:#fff;font-size:0}.at-share-tbx-element,.at-share-tbx-element .at-share-btn{font-family:helvetica neue,helvetica,arial,sans-serif;padding:0;line-height:0}.at-share-tbx-element .at-share-btn{cursor:pointer;margin:0 5px 5px 0;display:inline-block;overflow:hidden;border:0;text-decoration:none;text-transform:none;background-color:transparent;color:inherit;transition:all .2s ease-in-out}.at-share-tbx-element .at-share-btn:focus,.at-share-tbx-element .at-share-btn:hover{transform:translateY(-4px);outline-offset:-1px;color:inherit}.at-share-tbx-element .at-share-btn::-moz-focus-inner{border:0;padding:0}.at-share-tbx-element .at-share-btn.at-share-btn.at-svc-compact:hover{transform:none}.at-share-tbx-element .at-icon-wrapper{vertical-align:middle}.at-share-tbx-element .at4-share-count,.at-share-tbx-element .at-label{margin:0 7.5px 0 2.5px;text-decoration:none;vertical-align:middle;display:inline-block;background:none;height:0;font-size:inherit;line-height:inherit;color:inherit}.at-share-tbx-element.at-mobile .at4-share-count,.at-share-tbx-element.at-mobile .at-label{display:none}.at-share-tbx-element .at_native_button{vertical-align:middle}.at-share-tbx-element .addthis_counter.addthis_bubble_style{margin:0 2px;vertical-align:middle;display:inline-block}.at-share-tbx-element .fb_iframe_widget{display:block}.at-share-tbx-element.at-share-tbx-native .at300b{vertical-align:middle}.at-style-responsive .at-share-btn{padding:5px}.at-style-jumbo{display:table}.at-style-jumbo .at4-spacer{height:1px;display:block;visibility:hidden;opacity:0}.at-style-jumbo .at4-count-container{display:table-cell;text-align:center;min-width:200px;vertical-align:middle;border-right:1px solid #ccc;padding-right:20px}.at-style-jumbo .at4-count{font-size:60px;line-height:60px;font-weight:700}.at-style-jumbo .at4-count-title{position:relative;font-size:18px;line-height:18px;bottom:2px}.at-style-jumbo .at-share-btn-elements{display:table-cell;vertical-align:middle;padding-left:20px}.at_flat_counter{cursor:pointer;font-family:helvetica,arial,sans-serif;font-weight:700;text-transform:uppercase;display:inline-block;position:relative;vertical-align:top;height:auto;margin:0 5px;padding:0 6px;left:-1px;background:#ebebeb;color:#32363b;transition:all .2s ease}.at_flat_counter:after{top:30%;left:-4px;content:"";position:absolute;border-width:5px 8px 5px 0;border-style:solid;border-color:transparent #ebebeb transparent transparent;display:block;width:0;height:0;transform:translateY(360deg)}.at_flat_counter:hover{background:#e1e2e2}</style><style type="text/css">.at4-thankyou-background{top:0;right:0;left:0;bottom:0;-webkit-overflow-scrolling:touch;z-index:9999999;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpizCuu/sRABGBiIBKMKqSOQoAAAwC8KgJipENhxwAAAABJRU5ErkJggg==);background:hsla(217,6%,46%,.95)}.at4-thankyou-background.at-thankyou-shown{position:fixed}.at4-thankyou-inner{position:absolute;width:100%;top:10%;left:50%;margin-left:-50%;text-align:center}.at4-thankyou-mobile .at4-thankyou-inner{top:5%}.thankyou-description{font-weight:400}.at4-thankyou-background .at4lb-inner{position:relative;width:100%;height:100%}.at4-thankyou-background .at4lb-inner .at4x{position:absolute;top:15px;right:15px;display:block;width:20px;height:20px;padding:20px;margin:0;cursor:pointer;transition:opacity .25s ease-in;opacity:.4;background:url("data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMTEvMTMvMTKswDp5AAAAd0lEQVQ4jb2VQRLAIAgDE///Z3qqY1FAhalHMCsCIkVEAIAkkVgvp2lDBgYAnAyHkWotLccNrEd4A7X2TqIdqLfnWBAdaF5rJdyJfjtPH5GT37CaGhoVq3nOm/XflUuLUto2pY1d+vRKh0Pp+MrAVtDe2JkvYNQ+jVSEEFmOkggAAAAASUVORK5CYII=") no-repeat center center;overflow:hidden;text-indent:-99999em;border:1px solid transparent}.at4-thankyou-background .at4lb-inner .at4x:focus,.at4-thankyou-background .at4lb-inner .at4x:hover{border:1px solid #fff;border-radius:50%;outline:0}.at4-thankyou-background .at4lb-inner #at4-palogo{position:absolute;bottom:10px;display:inline-block;text-decoration:none;font-family:helvetica,arial,sans-serif;font-size:11px;cursor:pointer;-webkit-transition:opacity .25s ease-in;moz-transition:opacity .25s ease-in;transition:opacity .25s ease-in;opacity:.5;z-index:100020;color:#fff;padding:2px 0 0 13px}.at4-thankyou-background .at4lb-inner #at4-palogo .at-branding-addthis,.at4-thankyou-background .at4lb-inner #at4-palogo .at-branding-info{color:#fff}.at4-thankyou-background .at4lb-inner #at4-palogo:hover,.at4-thankyou-background.ats-dark .at4lb-inner a#at4-palogo:hover{text-decoration:none;color:#fff;opacity:1}.at4-thankyou-background.ats-dark{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABtJREFUeNpiZGBgeMZABGBiIBKMKqSOQoAAAwB+cQD6hqlbCwAAAABJRU5ErkJggg==");background:rgba(0,0,0,.85)}.at4-thankyou-background .thankyou-title{color:#fff;font-size:38.5px;margin:10px 20px;line-height:38.5px;font-family:helvetica neue,helvetica,arial,sans-serif;font-weight:300}.at4-thankyou-background.ats-dark .thankyou-description,.at4-thankyou-background.ats-dark .thankyou-title{color:#fff}.at4-thankyou-background .thankyou-description{color:#fff;font-size:18px;margin:10px 0;line-height:24px;padding:0;font-family:helvetica neue,helvetica,arial,sans-serif;font-weight:300}.at4-thankyou-background .at4-thanks-icons{padding-top:10px}.at4-thankyou-mobile *{-webkit-overflow-scrolling:touch}#at4-thankyou .at4-recommended-recommendedbox .at-logo{display:none}.at4-thankyou .at-h3{height:49px;line-height:49px;margin:0 50px 0 20px;padding:1px 0 0;font-family:helvetica neue,helvetica,arial,sans-serif;font-size:1pc;font-weight:700;color:#fff;text-shadow:0 1px #000}.at4-thanks{padding-top:50px;text-align:center}.at4-thanks label{display:block;margin:0 0 15px;font-size:1pc;line-height:1pc}.at4-thanks .at4-h2{background:none;border:none;margin:0 0 10px;padding:0;font-family:helvetica neue,helvetica,arial,sans-serif;font-size:28px;font-weight:300;color:#000}.at4-thanks .at4-thanks-icons{position:relative;height:2pc}.at4-thanks .at4-thanks-icons .at-thankyou-label{display:block;padding-bottom:10px;font-size:14px;color:#666}.at4-thankyou-layer .at-follow .at-icon-wrapper{width:2pc;height:2pc}</style><style type="text/css">.at4-recommended-toaster{position:fixed;top:auto;bottom:0;right:0;z-index:100021}.at4-recommended-toaster.ats-light{border:1px solid #c5c5c5;background:#fff}.at4-recommended-toaster.ats-gray{border:1px solid #c5c5c5;background:#f2f2f2}.at4-recommended-toaster.ats-dark{background:#262b30;color:#fff}.at4-recommended-toaster .at4-recommended-container{padding-top:0;margin:0}.at4-recommended.at4-recommended-toaster div.at-recommended-label{line-height:1pc;font-size:1pc;text-align:left;padding:20px 0 0 20px}.at4-toaster-outer .at4-recommended .at4-recommended-item .at4-recommended-item-caption .at-h4{font-size:11px;line-height:11px;margin:10px 0 6px;height:30px}.at4-recommended.at4-recommended-toaster div.at-recommended-label.ats-gray,.at4-recommended.at4-recommended-toaster div.at-recommended-label.ats-light{color:#464646}.at4-recommended.at4-recommended-toaster div.at-recommended-label.ats-dark{color:#fff}.at4-toaster-close-control{position:absolute;top:0;right:0;display:block;width:20px;height:20px;line-height:20px;margin:5px 5px 0 0;padding:0;text-indent:-9999em}.at4-toaster-open-control{position:fixed;right:0;bottom:0;z-index:100020}.at4-toaster-outer .at4-recommended-item{width:90pt;border:0;margin:9px 10px 0}.at4-toaster-outer .at4-recommended-item:first-child{margin-left:20px}.at4-toaster-outer .at4-recommended-item:last-child{margin-right:20px}.at4-toaster-outer .at4-recommended-item .at4-recommended-item-img{max-height:90pt;max-width:90pt}.at4-toaster-outer .at4-recommended-item .at4-recommended-item-img img{height:90pt;width:90pt}.at4-toaster-outer .at4-recommended-item .at4-recommended-item-caption{height:30px;padding:0;margin:0;height:initial}.at4-toaster-outer .ats-dark .at4-recommended-item .at4-recommended-item-caption{background:#262b30}.at4-toaster-outer .at4-recommended .at4-recommended-item .at4-recommended-item-caption small{width:auto;line-height:14px;margin:0}.at4-toaster-outer .at4-recommended.ats-dark .at4-recommended-item .at4-recommended-item-caption small{color:#fff}.at4-recommended-toaster .at-logo{margin:0 0 3px 20px;text-align:left}.at4-recommended-toaster .at-logo .at4-logo-container.at-sponsored-logo{position:relative}.at4-toaster-outer .at4-recommended-item .sponsored-label{text-align:right;font-size:10px;color:#666;float:right;position:fixed;bottom:6px;right:20px;top:initial;z-index:99999}</style><style type="text/css">.at4-whatsnext{position:fixed;bottom:0!important;right:0;background:#fff;border:1px solid #c5c5c5;margin:-1px;width:390px;height:90pt;overflow:hidden;font-size:9pt;font-weight:400;color:#000;z-index:1800000000}.at4-whatsnext a{color:#666}.at4-whatsnext .at-whatsnext-content{height:90pt;position:relative}.at4-whatsnext .at-whatsnext-content .at-branding{position:absolute;bottom:15px;right:10px;padding-left:9px;text-decoration:none;line-height:10px;font-family:helvetica,arial,sans-serif;font-size:10px;color:#666}.at4-whatsnext .at-whatsnext-content .at-whatsnext-content-inner{position:absolute;top:15px;right:20px;bottom:15px;left:140px;text-align:left;height:105px}.at4-whatsnext .at-whatsnext-content-inner a{display:inline-block}.at4-whatsnext .at-whatsnext-content-inner div.at-h6{text-align:left;margin:0;padding:0 0 3px;font-size:11px;color:#666;cursor:default}.at4-whatsnext .at-whatsnext-content .at-h3{text-align:left;margin:5px 0;padding:0;line-height:1.2em;font-weight:400;font-size:14px;height:3pc}.at4-whatsnext .at-whatsnext-content-inner a:link,.at4-whatsnext .at-whatsnext-content-inner a:visited{text-decoration:none;font-weight:400;color:#464646}.at4-whatsnext .at-whatsnext-content-inner a:hover{color:#000}.at4-whatsnext .at-whatsnext-content-inner small{position:absolute;bottom:15px;line-height:10px;font-size:11px;color:#666;cursor:default;text-align:left}.at4-whatsnext .at-whatsnext-content .at-whatsnext-content-img{position:absolute;top:0;left:0;width:90pt;height:90pt;overflow:hidden}.at4-whatsnext .at-whatsnext-content .at-whatsnext-content-img img{position:absolute;top:0;left:0;max-height:none;max-width:none}.at4-whatsnext .at-whatsnext-close-control{position:absolute;top:0;right:0;display:block;width:20px;height:20px;line-height:20px;margin:0 5px 0 0;padding:0;text-indent:-9999em}.at-whatsnext-open-control{position:fixed;right:0;bottom:0;z-index:100020}.at4-whatsnext.ats-dark{background:#262b30}.at4-whatsnext.ats-dark .at-whatsnext-content .at-h3,.at4-whatsnext.ats-dark .at-whatsnext-content a.at4-logo:hover,.at4-whatsnext.ats-dark .at-whatsnext-content-inner a:link,.at4-whatsnext.ats-dark .at-whatsnext-content-inner a:visited{color:#fff}.at4-whatsnext.ats-light{background:#fff}.at4-whatsnext.ats-gray{background:#f2f2f2}.at4-whatsnext.at-whatsnext-nophoto{width:270px}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content-img{display:none}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner{top:15px;right:0;left:20px}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner.addthis_32x32_style{top:0;right:0;left:0;padding:45px 20px 0;font-size:20px}.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner .at4-icon,.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner .at4-icon-fw,.at4-whatsnext.at-whatsnext-nophoto .at-whatsnext-content .at-whatsnext-content-inner .whatsnext-msg{vertical-align:middle}.at-whatsnext-img,.at-whatsnext-img-lnk{position:absolute;left:0}</style><style type="text/css">.at4-whatsnextmobile{position:fixed;bottom:0;right:0;left:0;background:#fff;z-index:9999998;height:170px;font-size:28px}.at4-whatsnextmobile .col-2{height:100%;font-size:1em}.at4-whatsnextmobile .col-2:first-child{max-width:200px;display:inline-block;float:left}.at4-whatsnextmobile .col-2:last-child{position:absolute;left:200px;right:50px;top:0;bottom:0;display:inline-block}.at4-whatsnextmobile .at-whatsnext-content-inner{font-size:1em}.at4-whatsnextmobile .at-whatsnext-content-img img{height:100%;width:100%}.at4-whatsnextmobile .at-close-control{font-size:1em;position:absolute;top:0;right:0;width:50px;height:50px}.at4-whatsnextmobile .at-close-control button{width:100%;height:100%;font-size:1em;font-weight:400;text-decoration:none;opacity:.5;padding:0;cursor:pointer;background:0 0;border:0;-webkit-appearance:none}.at4-whatsnextmobile .at-h3,.at4-whatsnextmobile .at-h6{font-size:1em;margin:0;color:#a1a1a1;margin-left:2.5%;margin-top:25px}.at4-whatsnextmobile .at-h3{font-size:1em;line-height:1em;font-weight:500;height:50%}.at4-whatsnextmobile .at-h3 a{font-size:1em;text-decoration:none}.at4-whatsnextmobile .at-h6{font-size:.8em;line-height:.8em;font-weight:500}.at4-whatsnextmobile .footer{position:absolute;bottom:2px;left:200px;right:0;padding-left:2.5%;font-size:1em;line-height:.6em}.at4-whatsnextmobile .footer small{font-size:.6em;color:#a1a1a1}.at4-whatsnextmobile .footer small:first-child{margin-right:5%;float:left}.at4-whatsnextmobile .footer small:last-child{margin-right:2.5%;float:right}.at4-whatsnextmobile .at-whatsnext-content{height:100%}.at4-whatsnextmobile.ats-dark{background:#262b30;color:#fff}.at4-whatsnextmobile .at-close-control button{color:#bfbfbf}.at4-whatsnextmobile.ats-dark a:link,.at4-whatsnextmobile.ats-dark a:visited{color:#fff}.at4-whatsnextmobile.ats-gray{background:#f2f2f2;color:#262b30}.at4-whatsnextmobile.ats-light{background:#fff;color:#262b30}.at4-whatsnextmobile.ats-dark .footer a:link,.at4-whatsnextmobile.ats-dark .footer a:visited,.at4-whatsnextmobile.ats-gray .footer a:link,.at4-whatsnextmobile.ats-gray .footer a:visited,.at4-whatsnextmobile.ats-light .footer a:link,.at4-whatsnextmobile.ats-light .footer a:visited{color:#a1a1a1}.at4-whatsnextmobile.ats-gray a:link,.at4-whatsnextmobile.ats-gray a:visited,.at4-whatsnextmobile.ats-light a:link,.at4-whatsnextmobile.ats-light a:visited{color:#262b30}@media only screen and (min-device-width:320px) and (max-device-width:480px){.at4-whatsnextmobile{height:85px;font-size:14px}.at4-whatsnextmobile .col-2:first-child{width:75pt}.at4-whatsnextmobile .col-2:last-child{right:25px;left:75pt}.at4-whatsnextmobile .footer{left:75pt}.at4-whatsnextmobile .at-close-control{width:25px;height:25px}.at4-whatsnextmobile .at-h3,.at4-whatsnextmobile .at-h6{margin-top:12.5px}}</style><style type="text/css">.at-custom-mobile-bar{left:0;right:0;width:100%;height:56px;position:fixed;text-align:center;z-index:100020;background:#fff;overflow:hidden;box-shadow:0 0 10px 0 rgba(0,0,0,.2);font:initial;line-height:normal;top:auto;bottom:0}.at-custom-mobile-bar.at-custom-mobile-bar-zindex-hide{z-index:-1!important}.at-custom-mobile-bar.atss-top{top:0;bottom:auto}.at-custom-mobile-bar.atss-bottom{top:auto;bottom:0}.at-custom-mobile-bar .at-custom-mobile-bar-btns{display:inline-block;text-align:center}.at-custom-mobile-bar .at-custom-mobile-bar-counter,.at-custom-mobile-bar .at-share-btn{margin-top:4px}.at-custom-mobile-bar .at-share-btn{display:inline-block;text-decoration:none;transition:none;box-sizing:content-box}.at-custom-mobile-bar .at-custom-mobile-bar-counter{font-family:Helvetica neue,arial;vertical-align:top;margin-left:4px;margin-right:4px;display:inline-block}.at-custom-mobile-bar .at-custom-mobile-bar-count{font-size:26px;line-height:1.25em;color:#222}.at-custom-mobile-bar .at-custom-mobile-bar-text{font-size:9pt;line-height:1.25em;color:#888;letter-spacing:1px}.at-custom-mobile-bar .at-icon-wrapper{text-align:center;height:3pc;width:3pc;margin:0 4px}.at-custom-mobile-bar .at-icon{vertical-align:top;margin:8px;width:2pc;height:2pc}.at-custom-mobile-bar.at-shfs-medium{height:3pc}.at-custom-mobile-bar.at-shfs-medium .at-custom-mobile-bar-counter{margin-top:6px}.at-custom-mobile-bar.at-shfs-medium .at-custom-mobile-bar-count{font-size:18px}.at-custom-mobile-bar.at-shfs-medium .at-custom-mobile-bar-text{font-size:10px}.at-custom-mobile-bar.at-shfs-medium .at-icon-wrapper{height:40px;width:40px}.at-custom-mobile-bar.at-shfs-medium .at-icon{margin:6px;width:28px;height:28px}.at-custom-mobile-bar.at-shfs-small{height:40px}.at-custom-mobile-bar.at-shfs-small .at-custom-mobile-bar-counter{margin-top:3px}.at-custom-mobile-bar.at-shfs-small .at-custom-mobile-bar-count{font-size:1pc}.at-custom-mobile-bar.at-shfs-small .at-custom-mobile-bar-text{font-size:10px}.at-custom-mobile-bar.at-shfs-small .at-icon-wrapper{height:2pc;width:2pc}.at-custom-mobile-bar.at-shfs-small .at-icon{margin:4px;width:24px;height:24px}</style><style type="text/css">.at-custom-sidebar{top:20%;width:58px;position:fixed;text-align:center;z-index:100020;background:#fff;overflow:hidden;box-shadow:0 0 10px 0 rgba(0,0,0,.2);font:initial;line-height:normal;top:auto;bottom:0}.at-custom-sidebar.at-custom-sidebar-zindex-hide{z-index:-1!important}.at-custom-sidebar.atss-left{left:0;right:auto;float:left;border-radius:0 4px 4px 0}.at-custom-sidebar.atss-right{left:auto;right:0;float:right;border-radius:4px 0 0 4px}.at-custom-sidebar .at-custom-sidebar-btns{display:inline-block;text-align:center;padding-top:4px}.at-custom-sidebar .at-custom-sidebar-counter{margin-bottom:8px}.at-custom-sidebar .at-share-btn{display:inline-block;text-decoration:none;transition:none;box-sizing:content-box}.at-custom-sidebar .at-custom-sidebar-counter{font-family:Helvetica neue,arial;vertical-align:top;margin-left:4px;margin-right:4px;display:inline-block}.at-custom-sidebar .at-custom-sidebar-count{font-size:21px;line-height:1.25em;color:#222}.at-custom-sidebar .at-custom-sidebar-text{font-size:10px;line-height:1.25em;color:#888;letter-spacing:1px}.at-custom-sidebar .at-icon-wrapper{text-align:center;margin:0 4px}.at-custom-sidebar .at-icon{vertical-align:top;margin:9px;width:2pc;height:2pc}.at-custom-sidebar .at-icon-wrapper{position:relative}.at-custom-sidebar .at4-share-count,.at-custom-sidebar .at4-share-count-container{line-height:1pc;font-size:10px}.at-custom-sidebar .at4-share-count{text-indent:0;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-weight:200;width:100%;height:1pc}.at-custom-sidebar .at4-share-count-anchor .at-icon{margin-top:3px}.at-custom-sidebar .at4-share-count-container{position:absolute;left:0;right:auto;top:auto;bottom:0;width:100%;color:#fff;background:inherit}</style><style type="text/css">.at-image-sharing-mobile-icon{position:absolute;background:#000 url(//s7.addthis.com/static/44a36d35bafef33aa9455b7d3039a771.png) no-repeat top center;background-color:rgba(0,0,0,.9);background-image:url(//s7.addthis.com/static/10db525181ee0bbe1a515001be1c7818.svg),none;border-radius:3px;width:50px;height:40px;top:-9999px;left:-9999px}.at-image-sharing-tool{display:block;position:absolute;text-align:center;z-index:9001;background:none;overflow:hidden;top:-9999px;left:-9999px;font:initial;line-height:0}.at-image-sharing-tool.addthis-animated{animation-duration:.15s}.at-image-sharing-tool.at-orientation-vertical .at-share-btn{display:block}.at-image-sharing-tool.at-orientation-horizontal .at-share-btn{display:inline-block}.at-image-sharing-tool.at-image-sharing-tool-size-big .at-icon{width:43px;height:43px}.at-image-sharing-tool.at-image-sharing-tool-size-mobile .at-share-btn{margin:0!important}.at-image-sharing-tool.at-image-sharing-tool-size-mobile .at-icon-wrapper{height:60px;width:100%;border-radius:0!important}.at-image-sharing-tool.at-image-sharing-tool-size-mobile .at-icon{max-width:100%;height:54px!important;width:54px!important}.at-image-sharing-tool .at-custom-shape.at-image-sharing-tool-btns{margin-right:8px;margin-bottom:8px}.at-image-sharing-tool .at-custom-shape .at-share-btn{margin-top:8px;margin-left:8px}.at-image-sharing-tool .at-share-btn{line-height:0;text-decoration:none;transition:none;box-sizing:content-box}.at-image-sharing-tool .at-icon-wrapper{text-align:center;height:100%;width:100%}.at-image-sharing-tool .at-icon{vertical-align:top;width:2pc;height:2pc;margin:3px}</style><style type="text/css">.at-expanding-share-button{box-sizing:border-box;position:fixed;z-index:9999}.at-expanding-share-button[data-position=bottom-right]{bottom:10px;right:10px}.at-expanding-share-button[data-position=bottom-right] .at-expanding-share-button-toggle-bg,.at-expanding-share-button[data-position=bottom-right] .at-expanding-share-button-toggle-btn[data-name]:after,.at-expanding-share-button[data-position=bottom-right] .at-icon-wrapper,.at-expanding-share-button[data-position=bottom-right] [data-name]:after{float:right}.at-expanding-share-button[data-position=bottom-right] [data-name]:after{margin-right:10px}.at-expanding-share-button[data-position=bottom-right] .at-expanding-share-button-toggle-btn[data-name]:after{margin-right:5px}.at-expanding-share-button[data-position=bottom-right] .at-icon-wrapper{margin-right:-3px}.at-expanding-share-button[data-position=bottom-left]{bottom:10px;left:10px}.at-expanding-share-button[data-position=bottom-left] .at-expanding-share-button-toggle-bg,.at-expanding-share-button[data-position=bottom-left] .at-expanding-share-button-toggle-btn[data-name]:after,.at-expanding-share-button[data-position=bottom-left] .at-icon-wrapper,.at-expanding-share-button[data-position=bottom-left] [data-name]:after{float:left}.at-expanding-share-button[data-position=bottom-left] [data-name]:after{margin-left:10px}.at-expanding-share-button[data-position=bottom-left] .at-expanding-share-button-toggle-btn[data-name]:after{margin-left:5px}.at-expanding-share-button *,.at-expanding-share-button :after,.at-expanding-share-button :before{box-sizing:border-box}.at-expanding-share-button .at-expanding-share-button-services-list{display:none;list-style:none;margin:0 5px;overflow:visible;padding:0}.at-expanding-share-button .at-expanding-share-button-services-list>li{display:block;height:45px;position:relative;overflow:visible}.at-expanding-share-button .at-expanding-share-button-toggle-btn,.at-expanding-share-button .at-share-btn{transition:.1s;text-decoration:none}.at-expanding-share-button .at-share-btn{display:block;height:40px;padding:0 3px 0 0}.at-expanding-share-button .at-expanding-share-button-toggle-btn{position:relative;overflow:auto}.at-expanding-share-button .at-expanding-share-button-toggle-btn.at-expanding-share-button-hidden[data-name]:after{display:none}.at-expanding-share-button .at-expanding-share-button-toggle-bg{box-shadow:0 2px 4px 0 rgba(0,0,0,.3);border-radius:50%;position:relative}.at-expanding-share-button .at-expanding-share-button-toggle-bg>span{background-image:url("data:image/svg+xml,%3Csvg%20width%3D%2232px%22%20height%3D%2232px%22%20viewBox%3D%220%200%2032%2032%22%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Ctitle%3Eshare%3C%2Ftitle%3E%3Cg%20stroke%3D%22none%22%20stroke-width%3D%221%22%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23FFFFFF%22%3E%3Cpath%20d%3D%22M26%2C13.4285714%20C26%2C13.6220248%2025.9293162%2C13.7894338%2025.7879464%2C13.9308036%20L20.0736607%2C19.6450893%20C19.932291%2C19.786459%2019.7648819%2C19.8571429%2019.5714286%2C19.8571429%20C19.3779752%2C19.8571429%2019.2105662%2C19.786459%2019.0691964%2C19.6450893%20C18.9278267%2C19.5037195%2018.8571429%2C19.3363105%2018.8571429%2C19.1428571%20L18.8571429%2C16.2857143%20L16.3571429%2C16.2857143%20C15.6279725%2C16.2857143%2014.9750773%2C16.3080355%2014.3984375%2C16.3526786%20C13.8217977%2C16.3973217%2013.2488868%2C16.477306%2012.6796875%2C16.5926339%20C12.1104882%2C16.7079619%2011.6157015%2C16.8660704%2011.1953125%2C17.0669643%20C10.7749235%2C17.2678581%2010.3824423%2C17.5264121%2010.0178571%2C17.8426339%20C9.65327199%2C18.1588557%209.35565592%2C18.534596%209.125%2C18.9698661%20C8.89434408%2C19.4051361%208.71391434%2C19.9203839%208.58370536%2C20.515625%20C8.45349637%2C21.1108661%208.38839286%2C21.7842224%208.38839286%2C22.5357143%20C8.38839286%2C22.9449425%208.40699386%2C23.4025272%208.44419643%2C23.9084821%20C8.44419643%2C23.9531252%208.45349693%2C24.0405499%208.47209821%2C24.1707589%20C8.4906995%2C24.3009679%208.5%2C24.3995532%208.5%2C24.4665179%20C8.5%2C24.5781256%208.46837829%2C24.6711306%208.40513393%2C24.7455357%20C8.34188956%2C24.8199408%208.25446484%2C24.8571429%208.14285714%2C24.8571429%20C8.02380893%2C24.8571429%207.9196433%2C24.7938994%207.83035714%2C24.6674107%20C7.77827355%2C24.6004461%207.72991094%2C24.5186017%207.68526786%2C24.421875%20C7.64062478%2C24.3251483%207.59040206%2C24.2135423%207.53459821%2C24.0870536%20C7.47879436%2C23.9605648%207.43973225%2C23.87128%207.41741071%2C23.8191964%20C6.47246551%2C21.6986501%206%2C20.0208395%206%2C18.7857143%20C6%2C17.3050521%206.19717065%2C16.0662252%206.59151786%2C15.0691964%20C7.79688103%2C12.0706695%2011.0520568%2C10.5714286%2016.3571429%2C10.5714286%20L18.8571429%2C10.5714286%20L18.8571429%2C7.71428571%20C18.8571429%2C7.52083237%2018.9278267%2C7.35342333%2019.0691964%2C7.21205357%20C19.2105662%2C7.07068382%2019.3779752%2C7%2019.5714286%2C7%20C19.7648819%2C7%2019.932291%2C7.07068382%2020.0736607%2C7.21205357%20L25.7879464%2C12.9263393%20C25.9293162%2C13.067709%2026%2C13.2351181%2026%2C13.4285714%20L26%2C13.4285714%20Z%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E");background-position:center center;background-repeat:no-repeat;transition:transform .4s ease;border-radius:50%;display:block}.at-expanding-share-button .at-icon-wrapper{box-shadow:0 2px 4px 0 rgba(0,0,0,.3);border-radius:50%;display:inline-block;height:40px;line-height:40px;text-align:center;width:40px}.at-expanding-share-button .at-icon{display:inline-block;height:34px;margin:3px 0;vertical-align:top;width:34px}.at-expanding-share-button [data-name]:after{box-shadow:0 2px 4px 0 rgba(0,0,0,.3);transform:translate(0, -50%);transition:.4s;background-color:#fff;border-radius:3px;color:#666;content:attr(data-name);font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:9pt;line-height:9pt;font-weight:500;opacity:0;padding:3px 5px;position:relative;top:20px;white-space:nowrap}.at-expanding-share-button.at-expanding-share-button-show-icons .at-expanding-share-button-services-list{display:block}.at-expanding-share-button.at-expanding-share-button-animate-in .at-expanding-share-button-toggle-bg>span{transform:rotate(270deg);background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20viewBox%3D%220%200%2032%2032%22%3E%3Cg%3E%3Cpath%20d%3D%22M18%2014V8h-4v6H8v4h6v6h4v-6h6v-4h-6z%22%20fill-rule%3D%22evenodd%22%20fill%3D%22white%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fsvg%3E");background-position:center center;background-repeat:no-repeat}.at-expanding-share-button.at-expanding-share-button-animate-in [data-name]:after{opacity:1}.at-expanding-share-button.at-hide-label [data-name]:after{display:none}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle{height:50px}.at-expanding-share-button.at-expanding-share-button-desktop .at-icon-wrapper:hover{box-shadow:0 2px 5px 0 rgba(0,0,0,.5)}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg{height:50px;line-height:50px;width:50px}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg>span{height:50px;width:50px}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg:after{box-shadow:0 2px 5px 0 rgba(0,0,0,.2);transition:opacity .2s ease;border-radius:50%;content:'';height:100%;opacity:0;position:absolute;top:0;left:0;width:100%}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-bg:hover:after{opacity:1}.at-expanding-share-button.at-expanding-share-button-desktop .at-expanding-share-button-toggle-btn[data-name]:after{top:25px}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-services-list{margin:0}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle-btn,.at-expanding-share-button.at-expanding-share-button-mobile .at-share-btn{outline:0}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle{height:40px;-webkit-tap-highlight-color:transparent}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle-bg,.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-toggle-bg span{height:40px;line-height:40px;width:40px}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-click-flash{transform:scale(0);transition:transform ease,opacity ease-in;background-color:hsla(0,0%,100%,.3);border-radius:50%;height:40px;opacity:1;position:absolute;width:40px;z-index:10000}.at-expanding-share-button.at-expanding-share-button-mobile .at-expanding-share-button-click-flash.at-expanding-share-button-click-flash-animate{transform:scale(1);opacity:0}.at-expanding-share-button.at-expanding-share-button-mobile+.at-expanding-share-button-mobile-overlay{transition:opacity ease;bottom:0;background-color:hsla(0,0%,87%,.7);display:block;height:auto;left:0;opacity:0;position:fixed;right:0;top:0;width:auto;z-index:9998}.at-expanding-share-button.at-expanding-share-button-mobile+.at-expanding-share-button-mobile-overlay.at-expanding-share-button-hidden{height:0;width:0;z-index:-10000}.at-expanding-share-button.at-expanding-share-button-mobile.at-expanding-share-button-animate-in+.at-expanding-share-button-mobile-overlay{transition:opacity ease;opacity:1}</style><style type="text/css">.at-tjin-element .at300b,.at-tjin-element .at300m{display:inline-block;width:auto;padding:0;margin:0 2px 5px;outline-offset:-1px;transition:all .2s ease-in-out}.at-tjin-element .at300b:focus,.at-tjin-element .at300b:hover,.at-tjin-element .at300m:focus,.at-tjin-element .at300m:hover{transform:translateY(-4px)}.at-tjin-element .addthis_tjin_label{display:none}.at-tjin-element .addthis_vertical_style .at300b,.at-tjin-element .addthis_vertical_style .at300m{display:block}.at-tjin-element .addthis_vertical_style .at300b .addthis_tjin_label,.at-tjin-element .addthis_vertical_style .at300b .at-icon-wrapper,.at-tjin-element .addthis_vertical_style .at300m .addthis_tjin_label,.at-tjin-element .addthis_vertical_style .at300m .at-icon-wrapper{display:inline-block;vertical-align:middle;margin-right:5px}.at-tjin-element .addthis_vertical_style .at300b:focus,.at-tjin-element .addthis_vertical_style .at300b:hover,.at-tjin-element .addthis_vertical_style .at300m:focus,.at-tjin-element .addthis_vertical_style .at300m:hover{transform:none}.at-tjin-element .at-tjin-btn{margin:0 5px 5px 0;padding:0;outline-offset:-1px;display:inline-block;box-sizing:content-box;transition:all .2s ease-in-out}.at-tjin-element .at-tjin-btn:focus,.at-tjin-element .at-tjin-btn:hover{transform:translateY(-4px)}.at-tjin-element .at-tjin-title{margin:0 0 15px}</style><style type="text/css">#addthissmartlayerscssready{color:#bada55!important}.addthis-smartlayers,div#at4-follow,div#at4-share,div#at4-thankyou,div#at4-whatsnext{padding:0;margin:0}#at4-follow-label,#at4-share-label,#at4-whatsnext-label,.at4-recommended-label.hidden{padding:0;border:none;background:none;position:absolute;top:0;left:0;height:0;width:0;overflow:hidden;text-indent:-9999em}.addthis-smartlayers .at4-arrow:hover{cursor:pointer}.addthis-smartlayers .at4-arrow:after,.addthis-smartlayers .at4-arrow:before{content:none}a.at4-logo{background:url(data:image/gif;base64,R0lGODlhBwAHAJEAAP9uQf///wAAAAAAACH5BAkKAAIALAAAAAAHAAcAAAILFH6Ge8EBH2MKiQIAOw==) no-repeat left center}.at4-minimal a.at4-logo{background:url(data:image/gif;base64,R0lGODlhBwAHAJEAAP9uQf///wAAAAAAACH5BAkKAAIALAAAAAAHAAcAAAILFH6Ge8EBH2MKiQIAOw==) no-repeat left center!important}button.at4-closebutton{position:absolute;top:0;right:0;padding:0;margin-right:10px;cursor:pointer;background:transparent;border:0;-webkit-appearance:none;font-size:19px;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.2}button.at4-closebutton:hover{color:#000;text-decoration:none;cursor:pointer;opacity:.5}div.at4-arrow{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAoCAYAAABpYH0BAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAV1JREFUeNrsmesOgyAMhQfxwfrofTM3E10ME2i5Oeppwr9a5OMUCrh1XV+wcvNAAIAA+BiAzrmtUWln27dbjEcC3AdODfo0BdEPhmcO4nIDvDNELi2jggk4/k8dT7skfeKzWIEd4VUpMQKvNB7X+OZSmAZkATWC1xvipbpnLmOosbJZC08CkAeA4E6qFUEMwLAGnlSBPCE8lW8CYnZTcimH2HoT7kSFOx5HBmCnDhTIu1p5s98G+QZrxGPhZVMY1vgyAQaAAAiAAAgDQACcBOD+BvJtBWfRy7NpJK5tBe4FNzXokywV734wPHMQlxvgnSGyNoUP/2ACjv/7iSeYKO3YWKzAjvCqlBiBVxqPa3ynexNJwOsN8TJbzL6JNIYYXWpMv4lIIAZgWANPqkCeEJ7KNwExu8lpLlSpAVQarO77TyKdBsyRPuwV0h0gmoGnTWFYzVkYBoAA+I/2FmAAt6+b5XM9mFkAAAAASUVORK5CYII=);background-repeat:no-repeat;width:20px;height:20px;margin:0;padding:0;overflow:hidden;text-indent:-9999em;text-align:left;cursor:pointer}#at4-recommendedpanel-outer-container .at4-arrow.at-right,div.at4-arrow.at-right{background-position:-20px 0}#at4-recommendedpanel-outer-container .at4-arrow.at-left,div.at4-arrow.at-left{background-position:0 0}div.at4-arrow.at-down{background-position:-60px 0}div.at4-arrow.at-up{background-position:-40px 0}.ats-dark div.at4-arrow.at-right{background-position:-20px -20px}.ats-dark div.at4-arrow.at-left{background-position:0 -20px}.ats-dark div.at4-arrow.at-down{background-position:-60px -20px}.ats-dark div.at4-arrow.at-up{background-position:-40px -20}.at4-opacity-hidden{opacity:0!important}.at4-opacity-visible{opacity:1!important}.at4-visually-hidden{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;overflow:hidden}.at4-hidden-off-screen,.at4-hidden-off-screen *{position:absolute!important;top:-9999px!important;left:-9999px!important}.at4-show{display:block!important;opacity:1!important}.at4-show-content{opacity:1!important;visibility:visible}.at4-hide{display:none!important;opacity:0!important}.at4-hide-content{opacity:0!important;visibility:hidden}.at4-visible{display:block!important;opacity:0!important}.at-wordpress-hide{display:none!important;opacity:0!important}.addthis-animated{animation-fill-mode:both;animation-timing-function:ease-out;animation-duration:.3s}.slideInDown.addthis-animated,.slideInLeft.addthis-animated,.slideInRight.addthis-animated,.slideInUp.addthis-animated,.slideOutDown.addthis-animated,.slideOutLeft.addthis-animated,.slideOutRight.addthis-animated,.slideOutUp.addthis-animated{animation-duration:.4s}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.fadeIn{animation-name:fadeIn}@keyframes fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.fadeInUp{animation-name:fadeInUp}@keyframes fadeInDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.fadeInDown{animation-name:fadeInDown}@keyframes fadeInLeft{0%{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.fadeInLeft{animation-name:fadeInLeft}@keyframes fadeInRight{0%{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}.fadeInRight{animation-name:fadeInRight}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}.fadeOut{animation-name:fadeOut}@keyframes fadeOutUp{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(-20px)}}.fadeOutUp{animation-name:fadeOutUp}@keyframes fadeOutDown{0%{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(20px)}}.fadeOutDown{animation-name:fadeOutDown}@keyframes fadeOutLeft{0%{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(-20px)}}.fadeOutLeft{animation-name:fadeOutLeft}@keyframes fadeOutRight{0%{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(20px)}}.fadeOutRight{animation-name:fadeOutRight}@keyframes slideInUp{0%{transform:translateY(1500px)}0%,to{opacity:1}to{transform:translateY(0)}}.slideInUp{animation-name:slideInUp}.slideInUp.addthis-animated{animation-duration:.4s}@keyframes slideInDown{0%{transform:translateY(-850px)}0%,to{opacity:1}to{transform:translateY(0)}}.slideInDown{animation-name:slideInDown}@keyframes slideOutUp{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(-250px)}}.slideOutUp{animation-name:slideOutUp}@keyframes slideOutUpFast{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(-1250px)}}#at4m-menu.slideOutUp{animation-name:slideOutUpFast}@keyframes slideOutDown{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(350px)}}.slideOutDown{animation-name:slideOutDown}@keyframes slideOutDownFast{0%{transform:translateY(0)}0%,to{opacity:1}to{transform:translateY(1250px)}}#at4m-menu.slideOutDown{animation-name:slideOutDownFast}@keyframes slideInLeft{0%{opacity:0;transform:translateX(-850px)}to{transform:translateX(0)}}.slideInLeft{animation-name:slideInLeft}@keyframes slideInRight{0%{opacity:0;transform:translateX(1250px)}to{transform:translateX(0)}}.slideInRight{animation-name:slideInRight}@keyframes slideOutLeft{0%{transform:translateX(0)}to{opacity:0;transform:translateX(-350px)}}.slideOutLeft{animation-name:slideOutLeft}@keyframes slideOutRight{0%{transform:translateX(0)}to{opacity:0;transform:translateX(350px)}}.slideOutRight{animation-name:slideOutRight}.at4win{margin:0 auto;background:#fff;border:1px solid #ebeced;width:25pc;box-shadow:0 0 10px rgba(0,0,0,.3);border-radius:8px;font-family:helvetica neue,helvetica,arial,sans-serif;text-align:left;z-index:9999}.at4win .at4win-header{position:relative;border-bottom:1px solid #f2f2f2;background:#fff;height:49px;-webkit-border-top-left-radius:8px;-webkit-border-top-right-radius:8px;-moz-border-radius-topleft:8px;-moz-border-radius-topright:8px;border-top-left-radius:8px;border-top-right-radius:8px;cursor:default}.at4win .at4win-header .at-h3,.at4win .at4win-header h3{height:49px;line-height:49px;margin:0 50px 0 0;padding:1px 0 0;margin-left:20px;font-family:helvetica neue,helvetica,arial,sans-serif;font-size:1pc;font-weight:700;text-shadow:0 1px #fff;color:#333}.at4win .at4win-header .at-h3 img,.at4win .at4win-header h3 img{display:inline-block;margin-right:4px}.at4win .at4win-header .at4-close{display:block;position:absolute;top:0;right:0;background:url("data:image/gif;base64,R0lGODlhFAAUAIABAAAAAP///yH5BAEAAAEALAAAAAAUABQAAAIzBIKpG+YMm5Enpodw1HlCfnkKOIqU1VXk55goVb2hi7Y0q95lfG70uurNaqLgTviyyUoFADs=") no-repeat center center;background-repeat:no-repeat;background-position:center center;border-left:1px solid #d2d2d1;width:49px;height:49px;line-height:49px;overflow:hidden;text-indent:-9999px;text-shadow:none;cursor:pointer;opacity:.5;border:0;transition:opacity .15s ease-in}.at4win .at4win-header .at4-close::-moz-focus-inner{border:0;padding:0}.at4win .at4win-header .at4-close:hover{opacity:1;background-color:#ebeced;border-top-right-radius:7px}.at4win .at4win-content{position:relative;background:#fff;min-height:220px}#at4win-footer{position:relative;background:#fff;border-top:1px solid #d2d2d1;-webkit-border-bottom-right-radius:8px;-webkit-border-bottom-left-radius:8px;-moz-border-radius-bottomright:8px;-moz-border-radius-bottomleft:8px;border-bottom-right-radius:8px;border-bottom-left-radius:8px;height:11px;line-height:11px;padding:5px 20px;font-size:11px;color:#666;-ms-box-sizing:content-box;-o-box-sizing:content-box;box-sizing:content-box}#at4win-footer a{margin-right:10px;text-decoration:none;color:#666}#at4win-footer a:hover{text-decoration:none;color:#000}#at4win-footer a.at4-logo{top:5px;padding-left:10px}#at4win-footer a.at4-privacy{position:absolute;top:5px;right:10px;padding-right:14px}.at4win.ats-dark{border-color:#555;box-shadow:none}.at4win.ats-dark .at4win-header{background:#1b1b1b;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border-top-left-radius:6px;border-top-right-radius:6px}.at4win.ats-dark .at4win-header .at4-close{background:url("data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAWdEVYdENyZWF0aW9uIFRpbWUAMTEvMTMvMTKswDp5AAAAd0lEQVQ4jb2VQRLAIAgDE///Z3qqY1FAhalHMCsCIkVEAIAkkVgvp2lDBgYAnAyHkWotLccNrEd4A7X2TqIdqLfnWBAdaF5rJdyJfjtPH5GT37CaGhoVq3nOm/XflUuLUto2pY1d+vRKh0Pp+MrAVtDe2JkvYNQ+jVSEEFmOkggAAAAASUVORK5CYII=") no-repeat center center;background-image:url(//s7.addthis.com/static/fb08f6d50887bd0caacc86a62bcdcf68.svg),none;border-color:#333}.at4win.ats-dark .at4win-header .at4-close:hover{background-color:#000}.at4win.ats-dark .at4win-header .at-h3,.at4win.ats-dark .at4win-header h3{color:#fff;text-shadow:0 1px #000}.at4win.ats-gray .at4win-header{background:#fff;border-color:#d2d2d1;-webkit-border-top-left-radius:6px;-webkit-border-top-right-radius:6px;-moz-border-radius-topleft:6px;-moz-border-radius-topright:6px;border-top-left-radius:6px;border-top-right-radius:6px}.at4win.ats-gray .at4win-header a.at4-close{border-color:#d2d2d1}.at4win.ats-gray .at4win-header a.at4-close:hover{background-color:#ebeced}.at4win.ats-gray #at4win-footer{border-color:#ebeced}.at4win .clear{clear:both}.at4win ::selection{background:#fe6d4c;color:#fff}.at4win ::-moz-selection{background:#fe6d4c;color:#fff}.at4-icon-fw{display:inline-block;background-repeat:no-repeat;background-position:0 0;margin:0 5px 0 0;overflow:hidden;text-indent:-9999em;cursor:pointer;padding:0;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%}.at44-follow-container a.aticon{height:2pc;margin:0 5px 5px 0}.at44-follow-container .at4-icon-fw{margin:0}</style><script type="text/javascript" charset="utf-8" async="" src="./物化视图的高级查询重写_files/14.e24bd776b1b9bc9a49f7.js.下载"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./物化视图的高级查询重写_files/translateelement.css"></head>
<body style="padding: 0px; border: 0px;">
<a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#BEGIN" class="accessibility-top skipto" tabindex="0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到主要内容</font></font></a><header><div class="w1024" style="min-height: 55px; display: block; margin: 0px; padding: 0px;"><div class="oracle-logo"><a href="https://docs.oracle.com/en/"><img border="0" width="236" height="22" alt="Oracle文档" src="./物化视图的高级查询重写_files/oracle-doc-logo.png"></a></div><div id="headernav" class="glyph"><ul><li id="login"><a href="http://www.oracle.com/webapps/redirect/signon?nexturl=https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36" id="signInLink"><img width="14" height="19" alt="图标" src="./物化视图的高级查询重写_files/sign-on.png" style="vertical-align: text-bottom; padding: 0px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 登入</font></font></a></li></ul></div></div></header><div style="position: relative; padding-top: 56px;"><div style="padding-top: 1.5em; padding-bottom: 0.5em; padding-left: 15px;"><a href="https://docs.oracle.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主页</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><a href="https://docs.oracle.com/database/121/index.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库在线文档库，12c第1版（12.1.0.2）</font></font></a></div><div class="titleDiv"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库数据仓库指南</font></font></div><div style="margin-left: -20px; height: 38px;"><div class="row" style="background: rgb(247, 247, 247); border-bottom: 1px solid rgb(232, 238, 243); border-top: 1px solid rgb(232, 238, 243); margin-left: 15px; height: 38px;"><div id="contnav" class="large-3 medium-4 columns" style="text-align: left; padding-left: 0px; border-right: 1px solid rgb(203, 203, 203); height: 38px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#" id="NAVSHOW"><img id="toctoggle" width="32" height="30" src="./物化视图的高级查询重写_files/hidetools.png" alt="内容"></a></div><div class="large-5 medium-4 columns" style="padding-left: 20px; border-left: 1px solid rgb(255, 255, 255);"><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm" id="previous"><img width="28" height="32" alt="以前" src="./物化视图的高级查询重写_files/prev.png" style="margin-bottom: 0px;"></a><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm" id="next"><img width="28" height="32" alt="下一个" src="./物化视图的高级查询重写_files/next.png" style="margin-bottom: 0px;"></a><a href="https://docs.oracle.com/database/121/index.htm" class="header-home-link"><img src="./物化视图的高级查询重写_files/home.gif" style="position: relative;"></a></div><span class="htmlpage"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17页，共32页</font></font></span></div></div></div>
<div class="row" id="CONTENT" style="padding-top: 56px;"><div id="NAV" class="large-3 medium-4 columns" style="top: 0px; bottom: 0px;"><div id="leftsidebar" style="position: fixed; top: 0px; overflow-y: auto; width: 302px; height: 100%;"><form action="https://docs.oracle.com/apps/search/search.jsp" method="get" style="margin-bottom: 0px;"><input id="searchField" type="text" name="word"><label for="searchField" style="position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></label> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><input type="submit" id="SEARCHBUTTON" value="搜索"></font></font><br><input type="hidden" name="product" id="searchpro" value="e50529-01"><input type="hidden" name="book" id="searchbook" value="DWHSG"></form><form style="margin-top: 0px;"><input id="searchBook" type="radio" name="searchby" checked="" value="DWHSG" style="margin-top: 0.5em;"><label for="searchBook" style="font-size: 12px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 这本书</font></font></label> <input id="searchLibrary" type="radio" name="searchby" value="library"><label for="searchLibrary" style="font-size: 12px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 此版本</font></font></label></form><div><p style="margin-bottom: 0px; border-bottom: 1px solid rgb(238, 238, 238);"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></p><ul id="tThisDocument" style="margin-right: 5px; margin-left: 24px; padding: 0px; text-indent: -14px; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/toc.htm" style="color: rgb(51, 51, 51); font-weight: bold;"><img src="./物化视图的高级查询重写_files/minus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/toc.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库数据仓库指南</font></font></a><ul id="DWHSGidm140179705281952" style="margin: 0px; display: block; text-indent: -14px; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/preface.htm#DWHSG8052" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前言</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/release_changes.htm#DWHSG9284" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此版本的Oracle数据库数据仓库指南中的更改</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/part1.htm#DWHSG8062" style="margin-left: -4px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库 - 基础知识</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG-GUID-452FBA23-6976-4590-AA41-1369647AD14D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库概念简介</font></font></a><ul id="DWHSGidm140179565419360" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG8063"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么是数据仓库？</font></font></a><ul id="DWHSGidm140179705372384" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG9288" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库的关键特征</font></font></a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG9282" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对比OLTP和数据仓库环境</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG9289" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用数据仓库任务</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG8070"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库架构</font></font></a><ul id="DWHSGidm140179706150448" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG8071" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库架构：基础</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG8073" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库架构：具有临时区域</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/concept.htm#DWHSG8075" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库架构：具有暂存区和数据集市</font></font></a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG-GUID-04B1A087-8893-43B6-ADB2-4E5E1CC2A6D3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库逻辑设计</font></font></a><ul id="DWHSGidm140179570292192" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9226" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逻辑与数据仓库中的物理设计</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9227">Creating a Logical Design</a><ul id="DWHSGidm140179667007552" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9290" style="margin-left: 14px;">What is a Schema?</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9229">About Third Normal Form Schemas</a><ul id="DWHSGidm140179569742528" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9231" style="margin-left: 14px;">About Normalization</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9311" style="margin-left: 14px;">Design Concepts for 3NF Schemas</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9233">About Star Schemas</a><ul id="DWHSGidm140179563337344" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9234" style="margin-left: 14px;">About Facts and Dimensions in Star Schemas</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9238" style="margin-left: 14px;">Design Concepts in Star Schemas</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9249" style="margin-left: 14px;">About Snowflake Schemas</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9315">About the Oracle In-Memory Column Store</a><ul id="DWHSGidm140179705455040" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9319" style="margin-left: 14px;">Benefits of Using the Oracle In-Memory Column Store</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9323" style="margin-left: 14px;">Using the Oracle In-Memory Column Store</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG-GUID-5FC74CA4-FD3E-4A17-A40D-9EE4EC61F355" style="margin-left: 14px;">Using Vector Joins to Enhance Join Performance</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9327" style="margin-left: 14px;">Automatic Big Table Caching to Improve the Performance of In-Memory Parallel Queries</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9328">About In-Memory Aggregation</a><ul id="DWHSGidm140179665377616" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9329" style="margin-left: 14px;">VECTOR GROUP BY Aggregation and the Oracle In-Memory Column Store</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9330" style="margin-left: 14px;">When to Use VECTOR GROUP BY Aggregation</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch2logdes.htm#DWHSG9333" style="margin-left: 14px;">When Is VECTOR GROUP BY Aggregation Used to Process Analytic Queries?</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG-GUID-442BF782-BE78-4D7A-A2D0-A9F4FA2B7ACD"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库物理设计</font></font></a><ul id="DWHSGidm140179716421968" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9259" style="margin-left: 14px;">Moving from Logical to Physical Design</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9260">About Physical Design</a><ul id="DWHSGidm140179704284064" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9262" style="margin-left: 14px;">Physical Design Structures</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9271" style="margin-left: 14px;">About Views in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9272" style="margin-left: 14px;">About Integrity Constraints in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9273" style="margin-left: 14px;">About Indexes and Partitioned Indexes in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9274" style="margin-left: 14px;">About Materialized Views in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ch3physdes.htm#DWHSG9275" style="margin-left: 14px;">About Dimensions in Data Warehouses</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG-GUID-79C29A60-3477-448D-835D-2940D060D050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库优化和技术</font></font></a><ul id="DWHSGidm140179566179744" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG8130">Using Indexes in Data Warehouses</a><ul id="DWHSGidm140179565126528" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9041" style="margin-left: 14px;">About Using Bitmap Indexes in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9042" style="margin-left: 14px;">Benefits of Indexes for Data Warehousing Applications</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9043" style="margin-left: 14px;">About Cardinality and Bitmap Indexes</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9044" style="margin-left: 14px;">How to Determine Candidates for Using a Bitmap Index</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9047" style="margin-left: 14px;">Using Bitmap Join Indexes in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9050" style="margin-left: 14px;">Using B-Tree Indexes in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9051" style="margin-left: 14px;">Using Index Compression</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9052" style="margin-left: 14px;">Choosing Between Local Indexes and Global Indexes</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG8151">Using Integrity Constraints in a Data Warehouse</a><ul id="DWHSGidm140179674054496" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9053" style="margin-left: 14px;">Overview of Constraint States</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9054" style="margin-left: 14px;">Typical Data Warehouse Integrity Constraints</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9062">About Parallel Execution in Data Warehouses</a><ul id="DWHSGidm140179568663376" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9063" style="margin-left: 14px;">Why Use Parallel Execution?</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9066" style="margin-left: 14px;">Automatic Degree of Parallelism and Statement Queuing</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9068" style="margin-left: 14px;">About In-Memory Parallel Execution in Data Warehouses</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG8912">About Optimizing Storage Requirements in Data Warehouses</a><ul id="DWHSGidm140179673364672" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG8913" style="margin-left: 14px;">Using Data Compression to Improve Storage in Data Warehouses</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG8591">Optimizing Star Queries and 3NF Schemas</a><ul id="DWHSGidm140179563673584" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9069" style="margin-left: 14px;">Optimizing Star Queries</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG8593" style="margin-left: 14px;">Using Star Transformation</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9071" style="margin-left: 14px;">Optimizing Third Normal Form Schemas</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/schemas.htm#DWHSG9334" style="margin-left: 14px;">Optimizing Star Queries Using VECTOR GROUP BY Aggregation</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/part3.htm#DWHSG8110" style="margin-left: -4px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化数据仓库</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG-GUID-A7AE8E5D-68A5-4519-81EB-252EAAF0ADFF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本物化观点</font></font></a><ul id="DWHSGidm140179706178544" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG0081">Overview of Data Warehousing with Materialized Views</a><ul id="DWHSGidm140179715511968" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8161" style="margin-left: 14px;">About Materialized Views for Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8162" style="margin-left: 14px;">About Materialized Views for Distributed Computing</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8163" style="margin-left: 14px;">About Materialized Views for Mobile Computing</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8164" style="margin-left: 14px;">The Need for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8166" style="margin-left: 14px;">Components of Summary Management</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8168" style="margin-left: 14px;">Data Warehousing Terminology</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8169" style="margin-left: 14px;">About Materialized View Schema Design</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8173" style="margin-left: 14px;">About Loading Data into Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8174" style="margin-left: 14px;">Overview of Materialized View Management Tasks</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG0082">Types of Materialized Views</a><ul id="DWHSGidm140179570947136" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8175" style="margin-left: 14px;">About Materialized Views with Aggregates</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8181" style="margin-left: 14px;">About Materialized Views Containing Only Joins</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8184" style="margin-left: 14px;">About Nested Materialized Views</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG0083">Creating Materialized Views</a><ul id="DWHSGidm140179667199648" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG00831" style="margin-left: 14px;">Creating Materialized Views with Column Alias Lists</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG00832" style="margin-left: 14px;">About Materialized Views Names</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG00833" style="margin-left: 14px;">About Storage And Table Compression for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8191" style="margin-left: 14px;">About Build Methods for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8193" style="margin-left: 14px;">About Enabling Query Rewrite for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8194" style="margin-left: 14px;">About Query Rewrite Restrictions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8197" style="margin-left: 14px;">About Refresh Options for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8208" style="margin-left: 14px;">ORDER BY Clause in Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8212" style="margin-left: 14px;">Using Oracle Enterprise Manager to Create Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8213" style="margin-left: 14px;">Using Materialized Views with NLS Parameters</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8214" style="margin-left: 14px;">Adding Comments to Materialized Views</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG9300">Creating Materialized View Logs</a><ul id="DWHSGidm140179570903200" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG9301" style="margin-left: 14px;">Using the FORCE Option With Materialized View Logs</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG9302" style="margin-left: 14px;">Purging Materialized View Logs</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8215" style="margin-left: 14px;">Registering Existing Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8216" style="margin-left: 14px;">Choosing Indexes for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8217" style="margin-left: 14px;">Dropping Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8218">Analyzing Materialized View Capabilities</a><ul id="DWHSGidm140179716120352" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#DWHSG8219" style="margin-left: 14px;">Using the DBMS_MVIEW.EXPLAIN_MVIEW Procedure</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG-GUID-F7394DFE-7CF6-401C-A312-C36603BEB01B"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级物化视图</font></font></a><ul id="DWHSGidm140179714383136" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8227">About Partitioning and Materialized Views</a><ul id="DWHSGidm140179567421040" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG00324" style="margin-left: 14px;">About Partition Change Tracking</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8235" style="margin-left: 14px;">Partitioning a Materialized View</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8236" style="margin-left: 14px;">Partitioning a Prebuilt Table</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8238" style="margin-left: 14px;">Rolling Materialized Views</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8239">About Materialized Views in Analytic Processing Environments</a><ul id="DWHSGidm140179574150544" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8240" style="margin-left: 14px;">About Materialized Views and Hierarchical Cubes</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8243" style="margin-left: 14px;">Benefits of Partitioning Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8244" style="margin-left: 14px;">About Compressing Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8245" style="margin-left: 14px;">About Materialized Views with Set Operators</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8249" style="margin-left: 14px;">About Materialized Views and Models</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8250" style="margin-left: 14px;">Invalidating Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8251">About Security Issues with Materialized Views</a><ul id="DWHSGidm140179570968496" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8252" style="margin-left: 14px;">Querying Materialized Views with Virtual Private Database (VPD)</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#DWHSG8255" style="margin-left: 14px;">Altering Materialized Views</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG-GUID-64068234-BDB0-4C12-AE70-75571046A586"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新物化视图</font></font></a><ul id="DWHSGidm140179706476592" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG03003">About Refreshing Materialized Views</a><ul id="DWHSGidm140179567378000" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8360" style="margin-left: 14px;">About Complete Refresh for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8361" style="margin-left: 14px;">About Fast Refresh for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8362" style="margin-left: 14px;">About Partition Change Tracking (PCT) Refresh for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG-GUID-51191C38-D52F-4A4D-B6FF-E631965AD69A" style="margin-left: 14px;">About the Out-of-Place Refresh Option</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8363" style="margin-left: 14px;">About ON COMMIT Refresh for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8364" style="margin-left: 14px;">About Manual Refresh Using the DBMS_MVIEW Package</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8366" style="margin-left: 14px;">Refreshing Specific Materialized Views with REFRESH</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8367" style="margin-left: 14px;">Refreshing All Materialized Views with REFRESH_ALL_MVIEWS</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8368" style="margin-left: 14px;">Refreshing Dependent Materialized Views with REFRESH_DEPENDENT</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8369" style="margin-left: 14px;">About Using Job Queues for Refresh</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8370" style="margin-left: 14px;">When Fast Refresh is Possible</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8371" style="margin-left: 14px;">Recommended Initialization Parameters for Parallelism</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8372" style="margin-left: 14px;">Monitoring a Refresh</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8373" style="margin-left: 14px;">Checking the Status of a Materialized View</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8381" style="margin-left: 14px;">Scheduling Refresh of Materialized Views</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG9417">Tips for Refreshing Materialized Views</a><ul id="DWHSGidm140179572174528" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8382" style="margin-left: 14px;">Tips for Refreshing Materialized Views with Aggregates</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8383" style="margin-left: 14px;">Tips for Refreshing Materialized Views Without Aggregates</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8384" style="margin-left: 14px;">Tips for Refreshing Nested Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8385" style="margin-left: 14px;">Tips for Fast Refresh with UNION ALL</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG0319" style="margin-left: 14px;">Tips for Fast Refresh with Commit SCN-Based Materialized View Logs</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8386" style="margin-left: 14px;">Tips After Refreshing Materialized Views</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG03009">Using Materialized Views with Partitioned Tables</a><ul id="DWHSGidm140179570985856" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8387" style="margin-left: 14px;">Materialized View Fast Refresh with Partition Change Tracking</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG03001">Using Partitioning to Improve Data Warehouse Refresh</a><ul id="DWHSGidm140179706244592" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8344" style="margin-left: 14px;">Data Warehouse Refresh Scenarios</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8345" style="margin-left: 14px;">Scenarios for Using Partitioning for Refreshing Data Warehouses</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG03002">Optimizing DML Operations During Refresh</a><ul id="DWHSGidm140179564304000" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8350" style="margin-left: 14px;">Implementing an Efficient MERGE Operation</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8358" style="margin-left: 14px;">Maintaining Referential Integrity in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#DWHSG8359" style="margin-left: 14px;">Purging Data from Data Warehouses</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG-GUID-14730F6C-D96D-4AA3-A91E-9FBF456EC889"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步刷新</font></font></a><ul id="DWHSGidm140179672648176" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9083">About Synchronous Refresh for Materialized Views</a><ul id="DWHSGidm140179715428656" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9283" style="margin-left: 14px;">What Is Synchronous Refresh?</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9085" style="margin-left: 14px;">Why Use Synchronous Refresh?</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9086" style="margin-left: 14px;">Registering Tables and Materialized Views for Synchronous Refresh</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9087" style="margin-left: 14px;">Specifying Change Data for Refresh</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9088" style="margin-left: 14px;">Synchronous Refresh Preparation and Execution</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9090" style="margin-left: 14px;">Materialized View Eligibility Rules and Restrictions for Synchronous Refresh</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9097">Using Synchronous Refresh for Materialized Views</a><ul id="DWHSGidm140179565141536" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9098" style="margin-left: 14px;">Synchronous Refresh Step 1: Registration Phase</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9102" style="margin-left: 14px;">Synchronous Refresh Step 2: Synchronous Refresh Phase</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9104" style="margin-left: 14px;">Synchronous Refresh Step 3: The Unregistration Phase</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9108">Using Synchronous Refresh Groups</a><ul id="DWHSGidm140179563380832" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9109" style="margin-left: 14px;">Examples of Common Actions with Synchronous Refresh Groups</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9113" style="margin-left: 14px;">Examples of Working with Multiple Synchronous Refresh Groups</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9116">Specifying and Preparing Change Data for Synchronous Refresh</a><ul id="DWHSGidm140179571028208" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9117" style="margin-left: 14px;">Working with Partition Operations While Capturing Change Data for Synchronous Refresh</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9119" style="margin-left: 14px;">Working with Staging Logs While Capturing Change Data for Synchronous Refresh</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9130">Troubleshooting Synchronous Refresh Operations</a><ul id="DWHSGidm140179666695360" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9131" style="margin-left: 14px;">Overview of the Status of Refresh Operations</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9132" style="margin-left: 14px;">How PREPARE_REFRESH Sets the STATUS Fields</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9133" style="margin-left: 14px;">Examples of Preparing for Synchronous Refresh Using PREPARE_REFRESH</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9138" style="margin-left: 14px;">How EXECUTE_REFRESH Sets the Status Fields During Synchronous Refresh</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9139" style="margin-left: 14px;">Examples of Executing Synchronous Refresh Using EXECUTE_REFRESH</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9144" style="margin-left: 14px;">Example of EXECUTE_REFRESH with Constraint Violations</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9146">Performing Synchronous Refresh Eligibility Analysis</a><ul id="DWHSGidm140179705079024" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9148" style="margin-left: 14px;">Using SYNCREF_TABLE to Store the Results of Synchronous Refresh Eligibility Analysis</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9149" style="margin-left: 14px;">Using a VARRAY to Store the Results of Synchronous Refresh Eligibility Analysis</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9150" style="margin-left: 14px;">Demo Scripts</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sync.htm#DWHSG9151" style="margin-left: 14px;">Overview of Synchronous Refresh Security Considerations</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG-GUID-106BE703-0D67-41F1-8CAC-6432B95FBF82"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外形尺寸</font></font></a><ul id="DWHSGidm140179705683008" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8256">What are Dimensions?</a><ul id="DWHSGidm140179716590240" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG-GUID-8E8F2F6E-24D2-4FBE-9A47-41DD71D2300D" style="margin-left: 14px;">Requirements for Dimensions in Data Warehouses</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8258">Creating Dimensions</a><ul id="DWHSGidm140179563608016" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8259" style="margin-left: 14px;">Dropping and Creating Attributes with Columns</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8260" style="margin-left: 14px;">Using Multiple Hierarchies While Creating Joins</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8262" style="margin-left: 14px;">Using Normalized Dimension Tables to Create Dimensions</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8263">Viewing Dimensions</a><ul id="DWHSGidm140179566031328" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8264" style="margin-left: 14px;">Viewing Dimensions With Oracle Enterprise Manager</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8265" style="margin-left: 14px;">Viewing Dimensions With the DESCRIBE_DIMENSION Procedure</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8266" style="margin-left: 14px;">Using Dimensions with Constraints</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8267" style="margin-left: 14px;">Validating Dimensions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8268" style="margin-left: 14px;">Altering Dimensions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/dimen.htm#DWHSG8269" style="margin-left: 14px;">Deleting Dimensions</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG-GUID-DB76286B-8557-446B-A6CC-BC987C378076"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图的基本查询重写</font></font></a><ul id="DWHSGidm140179567687344" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG0181">Overview of Query Rewrite</a><ul id="DWHSGidm140179570352496" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG-GUID-D43AE3AB-0778-49EA-9C8D-983F0910FE05" style="margin-left: 14px;">Query Rewrite and the Optimizer</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG8494" style="margin-left: 14px;">When Does Oracle Rewrite a Query?</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG0182">Ensuring that Query Rewrite Takes Effect</a><ul id="DWHSGidm140179665189840" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG-GUID-D4CD7FA7-7E59-4114-A8A7-941FD7F1C07E" style="margin-left: 14px;">Enabling Query Rewrite for Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG01821" style="margin-left: 14px;">Initialization Parameters for Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG8495" style="margin-left: 14px;">Controlling Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG8496" style="margin-left: 14px;">About Accuracy of Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG01813" style="margin-left: 14px;">About Privileges for Enabling Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG8497" style="margin-left: 14px;">Sample Schema and Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG8498" style="margin-left: 14px;">How to Verify if Query Rewrite Occurred</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#DWHSG0184" style="margin-left: 14px;">Example of Query Rewrite</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36" style="color: rgb(51, 51, 51); font-weight: bold;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图的高级查询重写</font></font></a><ul id="DWHSGidm140179563298336" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG0801" style="color: rgb(20, 92, 147); font-weight: normal;">How Oracle Rewrites Queries</a><ul id="DWHSGidm140179673027056" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08011" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Cost-Based Optimization and Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08012" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">General Query Rewrite Methods</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08013" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Checks Made by Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08014" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite Using Dimensions</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG0802" style="color: rgb(20, 92, 147); font-weight: normal;">Types of Query Rewrite</a><ul id="DWHSGidm140179572539872" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08021" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Method 1: Text Match Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08022" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Method 2: Join Back</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08023" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Method 3: Aggregate Computability</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08024" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Method 4: Aggregate Rollup</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08025" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Method 5: Rollup Using a Dimension</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8513" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Method 6: When Materialized Views Have Only a Subset of Data</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08026" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Partition Change Tracking (PCT) Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08027" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite Using Multiple Materialized Views</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG0803" style="color: rgb(20, 92, 147); font-weight: normal;">Other Query Rewrite Considerations</a><ul id="DWHSGidm140179565060032" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08031" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite Using Nested Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08032" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite in the Presence of Inline Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG00323" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite Using Remote Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08034" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite in the Presence of Duplicate Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08035" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite Using Date Folding</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08036" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite Using View Constraints</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08037" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Using Set Operator Materialized Views</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08038" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">About Query Rewrite in the Presence of Grouping Sets</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08039" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite in the Presence of Window Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08040" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite and Expression Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08041" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Cursor Sharing and Bind Variables During Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08042" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Handling Expressions in Query Rewrite</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG0804" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Advanced Query Rewrite Using Equivalences</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG0807" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Creating Result Cache Materialized Views with Equivalences</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG0805" style="color: rgb(20, 92, 147); font-weight: normal;">Verifying that Query Rewrite has Occurred</a><ul id="DWHSGidm140179567605760" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG08051" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Using EXPLAIN PLAN with Query Rewrite</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8559" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Using the EXPLAIN_REWRITE Procedure with Query Rewrite</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG0806" style="color: rgb(51, 51, 51); font-weight: bold;">Design Considerations for Improving Query Rewrite Capabilities</a><ul id="DWHSGidm140179666969136" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8569" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Constraints</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8570" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Dimensions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8571" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Outer Joins</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8572" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Text Match</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8573" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Aggregates</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8574" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Grouping Conditions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8575" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Expression Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8576" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Date Folding</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8577" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Statistics</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG8578" style="margin-left: 14px; color: rgb(20, 92, 147); font-weight: normal;">Query Rewrite Considerations: Hints</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG-GUID-7B007A3C-53C2-4437-9E71-9ECECF8B4FAB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性聚类</font></font></a><ul id="DWHSGidm140179563488016" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG8917">About Attribute Clustering</a><ul id="DWHSGidm140179569901632" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG-GUID-0655904B-79FF-409C-9AD9-C05F5E1010E1" style="margin-left: 14px;">Methods of Clustering Data</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9338" style="margin-left: 14px;">Types of Attribute Clustering</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9341" style="margin-left: 14px;">Example: Attribute Clustered Table</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9342" style="margin-left: 14px;">Guidelines for Using Attribute Clustering</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG8919" style="margin-left: 14px;">Advantages of Attribute-Clustered Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9343" style="margin-left: 14px;">About Defining Attribute Clustering for Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9344" style="margin-left: 14px;">About Specifying When Attribute Clustering Must be Performed</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG8922">Attribute Clustering Operations</a><ul id="DWHSGidm140179714274144" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9163" style="margin-left: 14px;">Privileges for Attribute-Clustered Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG8923" style="margin-left: 14px;">Creating Attribute-Clustered Tables with Linear Ordering</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG8927" style="margin-left: 14px;">Creating Attribute-Clustered Tables with Interleaved Ordering</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG8932" style="margin-left: 14px;">Maintaining Attribute Clustering</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9350">Viewing Attribute Clustering Information</a><ul id="DWHSGidm140179704916112" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9351" style="margin-left: 14px;">Determining if Attribute Clustering is Defined for Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9352" style="margin-left: 14px;">Viewing Attribute-Clustering Information for Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9353" style="margin-left: 14px;">Viewing Information About the Columns on Which Attribute Clustering is Performed</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm#DWHSG9354" style="margin-left: 14px;">Viewing Information About Dimensions and Joins on Which Attribute Clustering is Performed</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG-GUID-BEA5ACA1-6718-4948-AB38-1F2C0335FDE4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用区域地图</font></font></a><ul id="DWHSGidm140179666921200" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8935">About Zone Maps</a><ul id="DWHSGidm140179674104944" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9356" style="margin-left: 14px;">Difference Between Zone Maps and Indexes</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9357" style="margin-left: 14px;">Zone Maps and Attribute Clustering</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9358" style="margin-left: 14px;">Types of Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9359" style="margin-left: 14px;">Benefits of Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9360" style="margin-left: 14px;">Scenarios Which Benefit from Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9361" style="margin-left: 14px;">About Maintaining Zone Maps</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8938">Zone Map Operations</a><ul id="DWHSGidm140179567644144" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9364" style="margin-left: 14px;">Privileges Required for Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8939" style="margin-left: 14px;">Creating Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8941" style="margin-left: 14px;">Modifying Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8942" style="margin-left: 14px;">Dropping Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9171" style="margin-left: 14px;">Compiling Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9172" style="margin-left: 14px;">Controlling the Use of Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8947" style="margin-left: 14px;">Maintaining Zone Maps</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9165">Refresh and Staleness of Zone Maps</a><ul id="DWHSGidm140179568787888" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9386" style="margin-left: 14px;">About Staleness of Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9390" style="margin-left: 14px;">About Refreshing Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8943" style="margin-left: 14px;">Refreshing Zone Maps</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9164">Performing Pruning Using Zone Maps</a><ul id="DWHSGidm140179570129280" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9393" style="margin-left: 14px;">How Oracle Database Performs Pruning Using Zone Maps</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG8949" style="margin-left: 14px;">Examples: Performing Pruning with Zone Maps and Attribute Clustering</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9402">Viewing Zone Map Information</a><ul id="DWHSGidm140179666299984" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9403" style="margin-left: 14px;">Viewing Details of Zone Maps in the Database</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/zone_maps.htm#DWHSG9404" style="margin-left: 14px;">Viewing the Measures of a Zone Map</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/part4.htm#DWHSG8270" style="margin-left: -4px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据移动/ ETL</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ettover.htm#DWHSG-GUID-50E33D2C-6F47-4449-8E49-90E4D7974A08"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据移动/ ETL概述</font></font></a><ul id="DWHSGidm140179568248304" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ettover.htm#DWHSG8271">Overview of ETL in Data Warehouses</a><ul id="DWHSGidm140179567601264" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ettover.htm#DWHSG8272" style="margin-left: 14px;">ETL Basics in Data Warehousing</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/ettover.htm#DWHSG8275">ETL Tools for Data Warehouses</a><ul id="DWHSGidm140179567796784" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/ettover.htm#DWHSG8276" style="margin-left: 14px;">Daily Operations in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/ettover.htm#DWHSG8277" style="margin-left: 14px;">Evolution of the Data Warehouse</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG-GUID-7C9793D3-10E7-40BB-80FF-627C7160D044"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库中的提取</font></font></a><ul id="DWHSGidm140179564969024" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8278" style="margin-left: 14px;">Overview of Extraction in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8279">Introduction to Extraction Methods in Data Warehouses</a><ul id="DWHSGidm140179716471616" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8280" style="margin-left: 14px;">Logical Extraction Methods</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8283" style="margin-left: 14px;">Physical Extraction Methods</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8286" style="margin-left: 14px;">Change Tracking Methods</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8290">Data Warehousing Extraction Examples</a><ul id="DWHSGidm140179570456288" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8291" style="margin-left: 14px;">Extraction Using Data Files</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/extract.htm#DWHSG8296" style="margin-left: 14px;">Extraction Through Distributed Operations</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transport.htm#DWHSG-GUID-3CC5E89C-A354-4F58-BC2A-D9DF439357E5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库中的运输</font></font></a><ul id="DWHSGidm140179666368304" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/transport.htm#DWHSG8297" style="margin-left: 14px;">Overview of Transportation in Data Warehouses</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transport.htm#DWHSG8298">Introduction to Transportation Mechanisms in Data Warehouses</a><ul id="DWHSGidm140179716124880" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/transport.htm#DWHSG8299" style="margin-left: 14px;">Transportation Using Flat Files</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transport.htm#DWHSG8300" style="margin-left: 14px;">Transportation Through Distributed Operations</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transport.htm#DWHSG8301" style="margin-left: 14px;">Transportation Using Transportable Tablespaces</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG-GUID-5B2CC8B6-8503-4B41-A75E-79A4925FCE4B"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库中的加载和转换</font></font></a><ul id="DWHSGidm140179665318096" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8304">Overview of Loading and Transformation in Data Warehouses</a><ul id="DWHSGidm140179566282320" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8305" style="margin-left: 14px;">Data Warehouses: Transformation Flow</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8310">Loading Mechanisms for Data Warehouses</a><ul id="DWHSGidm140179666411888" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8311" style="margin-left: 14px;">Loading a Data Warehouse with SQL*Loader</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8312" style="margin-left: 14px;">Loading a Data Warehouse with External Tables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8313" style="margin-left: 14px;">Loading a Data Warehouse with OCI and Direct-Path APIs</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8314" style="margin-left: 14px;">Loading a Data Warehouse with Export/Import</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8315">Transformation Mechanisms in Data Warehouses</a><ul id="DWHSGidm140179673593136" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8316" style="margin-left: 14px;">Transforming Data Using SQL</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8327" style="margin-left: 14px;">Transforming Data Using PL/SQL</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8328" style="margin-left: 14px;">Transforming Data Using Table Functions</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8333">Error Logging and Handling Mechanisms</a><ul id="DWHSGidm140179704212672" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8334" style="margin-left: 14px;">Business Rule Violations</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8335" style="margin-left: 14px;">Data Rule Violations (Data Errors)</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8338">Loading and Transformation Scenarios</a><ul id="DWHSGidm140179574399184" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8339" style="margin-left: 14px;">Key Lookup Scenario</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8340" style="margin-left: 14px;">Business Rule Violation Scenario</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8341" style="margin-left: 14px;">Data Error Scenarios</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/transform.htm#DWHSG8342" style="margin-left: 14px;">Pivoting Scenarios</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/part5.htm#DWHSG8493" style="margin-left: -4px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关系分析</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG-GUID-20EFBF1E-F79D-4E4A-906C-6E496EECA684"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于分析和报告的SQL</font></font></a><ul id="DWHSGidm140179713990720" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8659" style="margin-left: 14px;">Overview of SQL for Analysis and Reporting</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0201">Ranking, Windowing, and Reporting Functions</a><ul id="DWHSGidm140179705907376" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8663" style="margin-left: 14px;">Ranking Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0202" style="margin-left: 14px;">Windowing Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0203" style="margin-left: 14px;">Reporting Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0204" style="margin-left: 14px;">LAG/LEAD Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8699" style="margin-left: 14px;">FIRST_VALUE, LAST_VALUE, and NTH_VALUE Functions</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG02015">Advanced Aggregates for Analysis</a><ul id="DWHSGidm140179564398528" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8702" style="margin-left: 14px;">LISTAGG Function</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0205" style="margin-left: 14px;">FIRST/LAST Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0206" style="margin-left: 14px;">Inverse Percentile Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0207" style="margin-left: 14px;">Hypothetical Rank Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0208" style="margin-left: 14px;">Linear Regression Functions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8723" style="margin-left: 14px;">About Statistical Aggregates</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG02011" style="margin-left: 14px;">About User-Defined Aggregates</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG0209">Pivoting Operations</a><ul id="DWHSGidm140179715866880" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG-GUID-72A2DEB6-003B-4235-9E9B-A4290BBE20A1" style="margin-left: 14px;">Creating the View Used for Pivoting Examples</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8729" style="margin-left: 14px;">Pivoting Example</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8730" style="margin-left: 14px;">Pivoting on Multiple Columns</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8731" style="margin-left: 14px;">Pivoting: Multiple Aggregates</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8732" style="margin-left: 14px;">Distinguishing PIVOT-Generated Nulls from Nulls in Source Data</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8734" style="margin-left: 14px;">Wildcard and Subquery Pivoting with XML Operations</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8733" style="margin-left: 14px;">Unpivoting Operations</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG02013">Data Densification for Reporting</a><ul id="DWHSGidm140179571066048" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8735" style="margin-left: 14px;">About Partition Join Syntax</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8736" style="margin-left: 14px;">Sample of Sparse Data</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8737" style="margin-left: 14px;">Filling Gaps in Data</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8738" style="margin-left: 14px;">Filling Gaps in Two Dimensions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8739" style="margin-left: 14px;">Filling Gaps in an Inventory Table</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8740" style="margin-left: 14px;">Computing Data Values to Fill Gaps</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8741">Time Series Calculations on Densified Data</a><ul id="DWHSGidm140179715567328" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8742" style="margin-left: 14px;">Period-to-Period Comparison for One Time Level: Example</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8743" style="margin-left: 14px;">Period-to-Period Comparison for Multiple Time Levels: Example</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8744" style="margin-left: 14px;">Creating a Custom Member in a Dimension: Example</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8745">Miscellaneous Analysis and Reporting Capabilities</a><ul id="DWHSGidm140179567874768" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG02010" style="margin-left: 14px;">WIDTH_BUCKET Function</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG02014" style="margin-left: 14px;">Linear Algebra</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG02012" style="margin-left: 14px;">CASE Expressions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG8755" style="margin-left: 14px;">Frequent Itemsets in SQL Analytics</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG9188">Limiting SQL Rows</a><ul id="DWHSGidm140179666547376" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/analysis.htm#DWHSG9191" style="margin-left: 14px;">SQL Row Limiting Restrictions and Considerations</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG-GUID-E051A04E-0C53-491D-9B16-B71BA00B80C2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于数据仓库中的聚合的SQL</font></font></a><ul id="DWHSGidm140179704477360" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8600">Overview of SQL for Aggregation in Data Warehouses</a><ul id="DWHSGidm140179563601680" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8601" style="margin-left: 14px;">About Analyzing Across Multiple Dimensions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8603" style="margin-left: 14px;">About Optimized Aggregation Performance</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8604" style="margin-left: 14px;">Data Warehousing: An Aggregate Scenario</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8608">ROLLUP Extension to GROUP BY</a><ul id="DWHSGidm140179666732576" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8609" style="margin-left: 14px;">When to Use ROLLUP</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8610" style="margin-left: 14px;">ROLLUP Syntax</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8612" style="margin-left: 14px;">Partial Rollup</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG-GUID-C5FDD050-DCE0-4FE1-9741-420E2F970A36">CUBE Extension to GROUP BY</a><ul id="DWHSGidm140179667110512" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8615" style="margin-left: 14px;">When to Use CUBE</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8616" style="margin-left: 14px;">CUBE Syntax</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8618" style="margin-left: 14px;">Partial CUBE</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8620" style="margin-left: 14px;">Calculating Subtotals Without CUBE</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8621">GROUPING Functions</a><ul id="DWHSGidm140179666128144" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8622" style="margin-left: 14px;">GROUPING Function</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8625" style="margin-left: 14px;">When to Use GROUPING</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8627" style="margin-left: 14px;">GROUPING_ID Function</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8629" style="margin-left: 14px;">GROUP_ID Function</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8631">GROUPING SETS Expression</a><ul id="DWHSGidm140179571023680" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8632" style="margin-left: 14px;">GROUPING SETS Syntax</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8634" style="margin-left: 14px;">About Composite Columns and Grouping</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8636">Concatenated Groupings and Data Aggregation</a><ul id="DWHSGidm140179565852912" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8639" style="margin-left: 14px;">Concatenated Groupings and Hierarchical Data Cubes</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8642">Considerations when Using Aggregation in Data Warehouses</a><ul id="DWHSGidm140179704120512" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8643" style="margin-left: 14px;">Hierarchy Handling in ROLLUP and CUBE</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8645" style="margin-left: 14px;">Column Capacity in ROLLUP and CUBE</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8646" style="margin-left: 14px;">HAVING Clause Used with GROUP BY Extensions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8647" style="margin-left: 14px;">ORDER BY Clause Used with GROUP BY Extensions</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8648" style="margin-left: 14px;">Using Other Aggregate Functions with ROLLUP and CUBE</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG9335" style="margin-left: 14px;">Using In-Memory Aggregation</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8649" style="margin-left: 14px;">Computation Using the WITH Clause</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8651">Working with Hierarchical Cubes in SQL</a><ul id="DWHSGidm140179562735360" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8652" style="margin-left: 14px;">Specifying Hierarchical Cubes in SQL</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/aggreg.htm#DWHSG8654" style="margin-left: 14px;">Querying Hierarchical Cubes in SQL</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8956"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于模式匹配的SQL</font></font></a><ul id="DWHSGidm140179569107536" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8957">Overview of Pattern Matching in Data Warehouses</a><ul id="DWHSGidm140179706384224" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8959" style="margin-left: 14px;">Why Use Pattern Matching?</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8963" style="margin-left: 14px;">How Data is Processed in Pattern Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8964" style="margin-left: 14px;">About Pattern Matching Special Capabilities</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8965">Basic Topics in Pattern Matching</a><ul id="DWHSGidm140179567987904" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8966" style="margin-left: 14px;">Basic Examples of Pattern Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8970" style="margin-left: 14px;">Tasks and Keywords in Pattern Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8980" style="margin-left: 14px;">Pattern Matching Syntax</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8981">Pattern Matching Details</a><ul id="DWHSGidm140179666086288" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8982" style="margin-left: 14px;">PARTITION BY: Logically Dividing the Rows into Groups</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8983" style="margin-left: 14px;">ORDER BY: Logically Ordering the Rows in a Partition</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8984" style="margin-left: 14px;">[ONE ROW | ALL ROWS] PER MATCH: Choosing Summaries or Details for Each Match</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8985" style="margin-left: 14px;">MEASURES: Defining Calculations for Use in the Query</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8986" style="margin-left: 14px;">PATTERN: Defining the Row Pattern to Be Matched</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8989" style="margin-left: 14px;">SUBSET: Defining Union Row Pattern Variables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8991" style="margin-left: 14px;">DEFINE: Defining Primary Pattern Variables</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8993" style="margin-left: 14px;">AFTER MATCH SKIP: Defining Where to Restart the Matching Process After a Match Is Found</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG8996" style="margin-left: 14px;">Expressions in MEASURES and DEFINE</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9003" style="margin-left: 14px;">Row Pattern Output</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9014">Advanced Topics in Pattern Matching</a><ul id="DWHSGidm140179568591536" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9015" style="margin-left: 14px;">Nesting FIRST and LAST Within PREV and NEXT in Pattern Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9017" style="margin-left: 14px;">Handling Empty Matches or Unmatched Rows in Pattern Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9020" style="margin-left: 14px;">How to Exclude Portions of the Pattern from the Output</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9022" style="margin-left: 14px;">How to Express All Permutations</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9023">Rules and Restrictions in Pattern Matching</a><ul id="DWHSGidm140179565267376" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9024" style="margin-left: 14px;">Input Table Requirements in Pattern Matching</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9025" style="margin-left: 14px;">Prohibited Nesting in the MATCH_RECOGNIZE Clause</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9026" style="margin-left: 14px;">Concatenated MATCH_RECOGNIZE Clause</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9027" style="margin-left: 14px;">Aggregate Restrictions</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9028">Examples of Pattern Matching</a><ul id="DWHSGidm140179672599632" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9029" style="margin-left: 14px;">Pattern Matching Examples: Stock Market</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9037" style="margin-left: 14px;">Pattern Matching Examples: Security Log Analysis</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9197" style="margin-left: 14px;">Pattern Matching Examples: Sessionization</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/pattern.htm#DWHSG9303" style="margin-left: 14px;">Pattern Matching Example: Financial Tracking</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG-GUID-538F78AA-9BF3-46F2-93D1-39A8739B3237"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于建模的SQL</font></font></a><ul id="DWHSGidm140179564843808" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8756">Overview of SQL Modeling in Data Warehouses</a><ul id="DWHSGidm140179666020704" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8758" style="margin-left: 14px;">How Data is Processed in a SQL Model</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8760" style="margin-left: 14px;">Why Use SQL Modeling in Data Warehouses?</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8761" style="margin-left: 14px;">About SQL Modeling Capabilities</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8762">Basic Topics in SQL Modeling</a><ul id="DWHSGidm140179672592736" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8763" style="margin-left: 14px;">Base Schema for SQL Modeling Examples</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8764" style="margin-left: 14px;">MODEL Clause Syntax</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG0221" style="margin-left: 14px;">Keywords in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8768" style="margin-left: 14px;">About Cell Referencing in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8771" style="margin-left: 14px;">About Rules for SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8778" style="margin-left: 14px;">Order of Evaluation of SQL Modeling Rules</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8779" style="margin-left: 14px;">Global and Local Keywords for SQL Modeling Rules</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG0222" style="margin-left: 14px;">UPDATE, UPSERT, and UPSERT ALL Behavior</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8783" style="margin-left: 14px;">Treatment of NULLs and Missing Cells in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8787" style="margin-left: 14px;">About Reference Models in SQL Modeling</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8788">Advanced Topics in SQL Modeling</a><ul id="DWHSGidm140179563509552" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG0223" style="margin-left: 14px;">FOR Loops in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8793" style="margin-left: 14px;">Iterative Models in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8794" style="margin-left: 14px;">Rule Dependency in AUTOMATIC ORDER Models</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8795" style="margin-left: 14px;">Ordered Rules in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG0224" style="margin-left: 14px;">Analytic Functions in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8797" style="margin-left: 14px;">Unique Dimensions Versus Unique Single References in SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG0225" style="margin-left: 14px;">Rules and Restrictions when Using SQL for Modeling</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG0226">Performance Considerations with SQL Modeling</a><ul id="DWHSGidm140179563122784" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8798" style="margin-left: 14px;">Parallel Execution and SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8799" style="margin-left: 14px;">Aggregate Computation and SQL Modeling</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8800" style="margin-left: 14px;">Using EXPLAIN PLAN to Understand Model Queries</a></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG8806">Examples of SQL Modeling</a><ul id="DWHSGidm140179666015152" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG9207" style="margin-left: 14px;">SQL Modeling Example 1: Calculating Sales Differences</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG9208" style="margin-left: 14px;">SQL Modeling Example 2: Calculating Percentage Change</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG9209" style="margin-left: 14px;">SQL Modeling Example 3: Calculating Net Present Value</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG9210" style="margin-left: 14px;">SQL Modeling Example 4: Calculating Using Simultaneous Equations</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG9211" style="margin-left: 14px;">SQL Modeling Example 5: Calculating Using Regression</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#DWHSG9212" style="margin-left: 14px;">SQL Modeling Example 6: Calculating Mortgage Amortization</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="打开" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/advbi.htm#DWHSG-GUID-9C65845E-BC8B-405D-B990-2A604D4DEE05"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级分析SQL</font></font></a><ul id="DWHSGidm140179563710880" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#"><img src="./物化视图的高级查询重写_files/plus.png" alt="open" width="14" height="14"></a><a href="https://docs.oracle.com/database/121/DWHSG/advbi.htm#DWHSG8818">Examples of Business Intelligence Queries</a><ul id="DWHSGidm140179716720832" style="margin: 0px; display: none; list-style: none;"><li><a href="https://docs.oracle.com/database/121/DWHSG/advbi.htm#DWHSG9213" style="margin-left: 14px;">Business Intelligence Query Example 1: Percent Change in Market Share of Products in a Calculated Set</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advbi.htm#DWHSG9214" style="margin-left: 14px;">Business Intelligence Query Example 2: Sales Projection that Fills in Missing Data</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advbi.htm#DWHSG9215" style="margin-left: 14px;">Business Intelligence Query Example 3: Customer Analysis by Grouping Customers into Buckets</a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/advbi.htm#DWHSG9216" style="margin-left: 14px;">Business Intelligence Query Example 4: Frequent Itemsets</a></li></ul></li></ul></li><li><a href="https://docs.oracle.com/database/121/DWHSG/glossary.htm#DWHSG8819" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">词汇表</font></font></a></li><li><a href="https://docs.oracle.com/database/121/DWHSG/index.htm" style="margin-left: 14px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指数</font></font></a></li></ul></li></ul></div><div style="text-align: center;"><button type="button" id="feedback"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反馈</font></font></button><div id="feedbackRating" style="position: fixed; width: 350px; height: 350px; top: 0px;"><div class="innerRating"><form method="post" style="margin-top: 1rem;"><div style="margin-top: 0px; margin-right: 0px;"><a class="closebutton">×</a><input type="hidden" id="path" name="path" value="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36"><input type="hidden" name="topictitle" id="topictitle" value="Advanced Query Rewrite for Materialized Views"><p style="margin-bottom: 0px;"><label for="userCommentsTitle" style="color: rgb(102, 102, 102);">Subject</label> <input type="text" name="title" id="userCommentsTitle" size="40"></p><textarea id="userCommentsBody" rows="5" cols="50" name="comment_text"></textarea><p style="margin: 0px 0px 1ex;"><label style="color: rgb(102, 102, 102); height: 2px; text-indent: -5900px;">From</label> &nbsp; &nbsp; <span style="display: none;"><input type="radio" name="submitter" value="" id="postPublic"><label for="postPublic"></label> <br></span><input type="radio" name="submitter" value="" id="postAnonymous" checked=""> <label for="postAnonymous">Anonymous</label><span style="display: inline;"> (or <a href="http://www.oracle.com/webapps/redirect/signon?nexturl=https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36">Sign In</a>)</span><input type="submit" value="Submit" class="submit" id="submitajax" style="margin-right: 0px; float: right; display: block;"></p><br><p style="color: rgb(51, 51, 51); margin-top: 0px; margin-bottom: 0.75rem;">Comments, corrections, and suggestions are forwarded to authors every week. By submitting, you confirm you agree to the <a href="http://docs.oracle.com/cd/E23003_01/html/en/comment_disclaimer.htm" style="font-size: 12px;">terms and conditions</a>. Use the <a href="https://community.oracle.com/" style="font-size: 12px;">OTN forums</a> for product questions. For support or consulting, file a service request through <a href="https://support.oracle.com/" style="font-size: 12px;">My Oracle Support</a>.</p></div></form></div><div id="loadImage"><img src="./物化视图的高级查询重写_files/ajax-loader.gif" alt="Submitting..">Thank you for your feedback!</div></div><button id="download" type="button"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载</font></font></button><div class="download" id="downloadsect" style="position: fixed; color: rgb(112, 112, 112); width: 286.156px;"><a class="closebutton">×</a><div><a href="https://docs.oracle.com/database/121/DWHSG/E41670-11.pdf">PDF</a> - best for offline viewing and printing</div></div></div><div class="addthis_sharing_toolbox" data-url="https://docs.oracle.com/database/121/DWHSG/qradv.htm#DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36" data-title="Advanced Query Rewrite for Materialized Views" style="clear: both;"><span class="shareto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享给：</font></font></span><div id="atstbx" class="at-share-tbx-element addthis-smartlayers addthis-animated at4-show" aria-labelledby="at-688a6ed1-2654-4e92-a9a1-589c78bf4bb2" role="region"><span id="at-688a6ed1-2654-4e92-a9a1-589c78bf4bb2" class="at4-visually-hidden"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AddThis共享按钮</font></font></span><div class="at-share-btn-elements"><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-facebook" style="background-color: rgb(59, 89, 152); border-radius: 0%;"><span class="at4-visually-hidden"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享到Facebook </font></font></span><span class="at-icon-wrapper" style="line-height: 20px; height: 20px; width: 20px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-facebook-1" class="at-icon at-icon-facebook" style="width: 20px; height: 20px;"><title id="at-svg-facebook-1">Facebook</title><g><path d="M22 5.16c-.406-.054-1.806-.16-3.43-.16-3.4 0-5.733 1.825-5.733 5.17v2.882H9v3.913h3.837V27h4.604V16.965h3.823l.587-3.913h-4.41v-2.5c0-1.123.347-1.903 2.198-1.903H22V5.16z" fill-rule="evenodd"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-twitter" style="background-color: rgb(29, 161, 242); border-radius: 0%;"><span class="at4-visually-hidden"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享到Twitter </font></font></span><span class="at-icon-wrapper" style="line-height: 20px; height: 20px; width: 20px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-twitter-2" class="at-icon at-icon-twitter" style="width: 20px; height: 20px;"><title id="at-svg-twitter-2">Twitter</title><g><path d="M27.996 10.116c-.81.36-1.68.602-2.592.71a4.526 4.526 0 0 0 1.984-2.496 9.037 9.037 0 0 1-2.866 1.095 4.513 4.513 0 0 0-7.69 4.116 12.81 12.81 0 0 1-9.3-4.715 4.49 4.49 0 0 0-.612 2.27 4.51 4.51 0 0 0 2.008 3.755 4.495 4.495 0 0 1-2.044-.564v.057a4.515 4.515 0 0 0 3.62 4.425 4.52 4.52 0 0 1-2.04.077 4.517 4.517 0 0 0 4.217 3.134 9.055 9.055 0 0 1-5.604 1.93A9.18 9.18 0 0 1 6 23.85a12.773 12.773 0 0 0 6.918 2.027c8.3 0 12.84-6.876 12.84-12.84 0-.195-.005-.39-.014-.583a9.172 9.172 0 0 0 2.252-2.336" fill-rule="evenodd"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-email" style="background-color: rgb(132, 132, 132); border-radius: 0%;"><span class="at4-visually-hidden"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享到电子邮件</font></font></span><span class="at-icon-wrapper" style="line-height: 20px; height: 20px; width: 20px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-email-3" class="at-icon at-icon-email" style="width: 20px; height: 20px;"><title id="at-svg-email-3">Email</title><g><g fill-rule="evenodd"></g><path d="M27 22.757c0 1.24-.988 2.243-2.19 2.243H7.19C5.98 25 5 23.994 5 22.757V13.67c0-.556.39-.773.855-.496l8.78 5.238c.782.467 1.95.467 2.73 0l8.78-5.238c.472-.28.855-.063.855.495v9.087z"></path><path d="M27 9.243C27 8.006 26.02 7 24.81 7H7.19C5.988 7 5 8.004 5 9.243v.465c0 .554.385 1.232.857 1.514l9.61 5.733c.267.16.8.16 1.067 0l9.61-5.733c.473-.283.856-.96.856-1.514v-.465z"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-print" style="background-color: rgb(115, 138, 141); border-radius: 0%;"><span class="at4-visually-hidden"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享到打印</font></font></span><span class="at-icon-wrapper" style="line-height: 20px; height: 20px; width: 20px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-print-4" class="at-icon at-icon-print" style="width: 20px; height: 20px;"><title id="at-svg-print-4">Print</title><g><path d="M24.67 10.62h-2.86V7.49H10.82v3.12H7.95c-.5 0-.9.4-.9.9v7.66h3.77v1.31L15 24.66h6.81v-5.44h3.77v-7.7c-.01-.5-.41-.9-.91-.9zM11.88 8.56h8.86v2.06h-8.86V8.56zm10.98 9.18h-1.05v-2.1h-1.06v7.96H16.4c-1.58 0-.82-3.74-.82-3.74s-3.65.89-3.69-.78v-3.43h-1.06v2.06H9.77v-3.58h13.09v3.61zm.75-4.91c-.4 0-.72-.32-.72-.72s.32-.72.72-.72c.4 0 .72.32.72.72s-.32.72-.72.72zm-4.12 2.96h-6.1v1.06h6.1v-1.06zm-6.11 3.15h6.1v-1.06h-6.1v1.06z"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-gmail" style="background-color: rgb(219, 68, 55); border-radius: 0%;"><span class="at4-visually-hidden"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享到Gmail </font></font></span><span class="at-icon-wrapper" style="line-height: 20px; height: 20px; width: 20px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-gmail-5" class="at-icon at-icon-gmail" style="width: 20px; height: 20px;"><title id="at-svg-gmail-5">Gmail</title><g><g fill-rule="evenodd"></g><path opacity=".3" d="M7.03 8h17.94v17H7.03z"></path><path d="M7.225 8h-.41C5.815 8 5 8.84 5 9.876v13.248C5 24.16 5.812 25 6.815 25h.962V12.714L16 19.26l8.223-6.546V25h.962C26.188 25 27 24.16 27 23.124V9.876C27 8.84 26.186 8 25.185 8h-.41L16 15.506 7.225 8z"></path></g></svg></span></a><a role="button" tabindex="1" class="at-icon-wrapper at-share-btn at-svc-compact" style="background-color: rgb(255, 101, 80); border-radius: 0%;"><span class="at4-visually-hidden"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享到更多</font></font></span><span class="at-icon-wrapper" style="line-height: 20px; height: 20px; width: 20px;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" version="1.1" role="img" aria-labelledby="at-svg-addthis-6" class="at-icon at-icon-addthis" style="width: 20px; height: 20px;"><title id="at-svg-addthis-6">AddThis</title><g><path d="M18 14V8h-4v6H8v4h6v6h4v-6h6v-4h-6z" fill-rule="evenodd"></path></g></svg></span></a></div></div></div><div><p style="margin-bottom: 0px; border-bottom: 1px solid rgb(238, 238, 238);"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分类</font></font></p><ul id="tMainCategories" style="margin: 0px; padding: 0px 0px 0px 1.5em; text-indent: -0.25em; font-size: 10px; color: rgb(153, 153, 153);"><li><a href="https://docs.oracle.com/database/121/index.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家</font></font></a></li><li><a href="https://docs.oracle.com/database/121/nav/mindx.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主索引</font></font></a></li><li><a href="https://docs.oracle.com/database/121/nav/mgloss.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主词汇表</font></font></a></li><li><a href="https://docs.oracle.com/database/121/nav/catalog_views.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据字典</font></font></a></li><li><a href="https://docs.oracle.com/database/121/nav/sql_keywords.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL关键字</font></font></a></li><li><a href="https://docs.oracle.com/database/121/nav/initora.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化参数</font></font></a></li><li><a href="https://docs.oracle.com/database/121/nav/lookup.htm?id=ERRMG"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误消息</font></font></a></li></ul></div></div></div>
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<a id="GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36"></a> <span id="PAGE" style="display:none;">17/32</span> <!-- End Header -->
<h1 id="DWHSG-GUID-0906CA6B-7EE3-42E1-A598-C6541BCD9B36" class="sect1"><span class="enumeration_chapter"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图的高级查询重写</font></font></h1>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本章讨论Oracle中的高级查询重写主题，并包含：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-A8988A2F-DA65-4AB6-86ED-6C838B84DCE9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle如何重写查询</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5297DA70-0064-4EA4-B492-E45089E5074F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写的类型</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-96BFEEAA-1C8A-4F8A-9EAF-6CDD9B148EA6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他查询重写注意事项</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-94D148DC-1E2A-4791-A7B6-28F9BF0306C1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用等效性重写高级查询</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-71197259-E8A4-45E5-A462-A9ADF6517CD6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用等效项创建结果缓存物化视图</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-3AB77341-BDA9-4F84-9691-EB79E4C8B832"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证是否已发生查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-098C13EA-774C-49D9-8199-A8092BA7D437"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提高查询重写能力的设计考虑因素</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG0801"></a>
<div class="props_rev_3"><a id="GUID-A8988A2F-DA65-4AB6-86ED-6C838B84DCE9"></a>
<h2 id="DWHSG-GUID-A8988A2F-DA65-4AB6-86ED-6C838B84DCE9" class="sect2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle如何重写查询</font></font></h2>
<div>
<p><a id="d39287e76" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器使用许多不同的方法来重写查询。</font><font style="vertical-align: inherit;">确定查询重写是否可行的第一步是查看查询是否满足以下先决条件：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例化视图中存在的联接存在于SQL中。</font></font></p>
</li>
<li>
<p style="margin: 0px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图中有足够的数据来回答查询。</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后，它必须确定它将如何重写查询。</font><font style="vertical-align: inherit;">当存储在物化视图中的结果与查询请求的结果完全匹配时，会出现最简单的情况。</font><font style="vertical-align: inherit;">优化程序通过将查询文本与实例化视图定义的文本进行比较来进行此类确定。</font><font style="vertical-align: inherit;">此文本匹配方法最直接，但符合此类查询重写条件的查询数量最少。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当文本比较测试失败时，优化器会根据提取的连接，选择，分组，聚合和列数据执行一系列通用检查。</font><font style="vertical-align: inherit;">这是通过单独地比较不同条款（完成</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与这些物化视图的查询的）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用以下类型的查询重写：</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-A95A5C58-B011-44FF-B5CB-EE4FDEE032D5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法1：文本匹配重写</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-14503E5A-F841-4568-B1E7-79ED1C3718A2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常规查询重写方法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下主题更详细地讨论了优化器：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5780D6A4-2675-4C4B-9DE9-80A3FE89BC1B"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于基于成本的优化和查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-14503E5A-F841-4568-B1E7-79ED1C3718A2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般查询重写方法</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-AF8326B6-DADD-4893-85DB-7456A3DC2756"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写的检查</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-9279E302-ECD5-4316-B0AC-493507C7F7F2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用维度重写查询</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8499"></a><a id="DWHSG08011"></a>
<div class="props_rev_3"><a id="GUID-5780D6A4-2675-4C4B-9DE9-80A3FE89BC1B"></a>
<h3 id="DWHSG-GUID-5780D6A4-2675-4C4B-9DE9-80A3FE89BC1B" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于基于成本的优化和查询重写</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在重写查询时，Oracle基于成本的优化器会比较重写查询和原始查询的成本，并选择更便宜的执行计划。</font></font></p>
<p><a id="d39287e168" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写可通过基于成本的优化获得。</font><font style="vertical-align: inherit;">Oracle数据库在重写和不重写的情况下优化输入查询，并选择成本最低的替代方案。</font><font style="vertical-align: inherit;">优化器通过一次一个地重写一个或多个查询块来重写查询。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询重写可以在多个物化视图之间进行选择以重写查询块，则会选择可以导致读取数据量最少的查询块。</font><font style="vertical-align: inherit;">在为重写选择了物化视图之后，优化器然后测试是否可以使用其他物化视图进一步重写重写的查询。</font><font style="vertical-align: inherit;">此过程继续，直到无法进一步重写为止。</font><font style="vertical-align: inherit;">然后优化重写的查询并优化原始查询。</font><font style="vertical-align: inherit;">优化器会比较这两个优化并选择成本最低的替代方案。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于优化基于成本，因此收集查询中涉及的表和表示物化视图的表的统计信息非常重要。</font><font style="vertical-align: inherit;">统计信息是用于计算重写查询成本的基本度量，例如表中的行数。</font><font style="vertical-align: inherit;">它们是使用</font></font><code class="codeph">DBMS_STATS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包</font><font style="vertical-align: inherit;">创建的</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含内联视图或命名视图的查询也是查询重写的候选者。</font><font style="vertical-align: inherit;">当查询包含命名视图时，视图名称用于在物化视图和查询之间进行匹配。</font><font style="vertical-align: inherit;">当查询包含内联视图时，可以在实体化视图与查询之间进行匹配之前将内联视图合并到查询中。</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5780D6A4-2675-4C4B-9DE9-80A3FE89BC1B__i1006234"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了重写过程中使用的基于成本的方法的图形视图。</font></font></p>
<div class="figure" id="GUID-5780D6A4-2675-4C4B-9DE9-80A3FE89BC1B__i1006234">
<p class="titleinfigure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-1查询重写过程</font></font></p>
<img width="281" height="473" src="./物化视图的高级查询重写_files/GUID-816B7889-2575-46E7-A037-8463AF51E2C6-default.gif" alt="下面是图11-1的描述" title="下面是图11-1的描述"><br>
<a href="https://docs.oracle.com/database/121/DWHSG/img_text/GUID-816B7889-2575-46E7-A037-8463AF51E2C6-print.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图11-1查询重写过程”的描述</font></font></a></div>
<!-- class="figure" --></div>
</div>
<a id="DWHSG08012"></a>
<div class="props_rev_3"><a id="GUID-14503E5A-F841-4568-B1E7-79ED1C3718A2"></a>
<h3 id="DWHSG-GUID-14503E5A-F841-4568-B1E7-79ED1C3718A2" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般查询重写方法</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器有许多不同类型的查询重写方法，可以从中选择回答查询。</font><font style="vertical-align: inherit;">当文本匹配重写不可能时，这组重写方法称为通用查询重写。</font><font style="vertical-align: inherit;">使用这些更高级技术的优点是可以使用一个或多个物化视图来回答许多不同的查询，并且查询并不总是必须完全匹配物化视图才能进行查询重写。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用常规查询重写方法时，优化程序使用它可以依赖的数据关系，例如主键和外键约束和维对象。</font><font style="vertical-align: inherit;">例如，主键和外键关系告诉优化器外键表中的每一行最多与主键表中的一行连接。</font><font style="vertical-align: inherit;">此外，如果</font></font><code class="codeph">NOT</code> <code class="codeph">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对外键</font><font style="vertical-align: inherit;">存在</font><font style="vertical-align: inherit;">约束，则表示外键表中的每一行必须正好连接到主键表中的一行。</font><font style="vertical-align: inherit;">维度对象描述日，月和年之间的关系，可用于将数据从白天汇总到月级。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些数据关系对于查询重写非常重要，因为它们告诉我们通过连接，分组或聚合数据产生什么类型的结果。</font><font style="vertical-align: inherit;">因此，为了在数据库中存在此类数据关系时最大化大量查询的可重写性，您应该声明约束和维度。</font></font></p>
<div class="infoboxnotealso" id="GUID-14503E5A-F841-4568-B1E7-79ED1C3718A2__GUID-5E753C50-9979-4D16-B304-1EDFEB937903">
<p class="notep1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以看看：</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-00BE44C0-6DC0-4C74-B50D-B5C67E8170BB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时查询重写需要约束和维度？</font></font></a></p>
</div>
</div>
<a id="DWHSG8501"></a><a id="DWHSG8500"></a>
<div class="props_rev_3"><a id="GUID-00BE44C0-6DC0-4C74-B50D-B5C67E8170BB"></a>
<h4 id="DWHSG-GUID-00BE44C0-6DC0-4C74-B50D-B5C67E8170BB" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时查询重写需要约束和维度？</font></font></h4>
<div>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-00BE44C0-6DC0-4C74-B50D-B5C67E8170BB__g1021681" title="查询重写的维度和约束要求"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表11-1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明了不同类型的查询重写所需的维度和约束。</font><font style="vertical-align: inherit;">本章将介绍这些类型的查询重写。</font></font></p>
<div class="tblformal" id="GUID-00BE44C0-6DC0-4C74-B50D-B5C67E8170BB__g1021681">
<p class="titleintable"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表11-1查询重写的维度和约束要求</font></font></p>
<table class="cellalignment1516" title="查询重写的维度和约束要求" summary="Dimension and Constraint Requirements for Query Rewrite">
<thead>
<tr class="cellalignment1507">
<th class="cellalignment1523" id="d39287e263"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写类型</font></font></th>
<th class="cellalignment1548" id="d39287e266"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外形尺寸</font></font></th>
<th class="cellalignment1549" id="d39287e269"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主键/外键/非空约束</font></font></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e274" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配SQL文本</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e274 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e274 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e284" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入吧</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e284 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必需的OR</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e284 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e294" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚合可计算性</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e294 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e294 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e304" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇总汇总</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e304 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e304 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e314" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇总使用维度</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e314 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e314 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e324" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过滤数据</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e324 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e324 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e334" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT重写</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e334 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e334 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1526" id="d39287e344" headers="d39287e263">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个物化视图</font></font></p>
</td>
<td class="cellalignment1550" headers="d39287e344 d39287e266">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
<td class="cellalignment1551" headers="d39287e344 d39287e269">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要</font></font></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" --></div>
</div>
</div>
<a id="DWHSG08013"></a>
<div class="props_rev_3"><a id="GUID-AF8326B6-DADD-4893-85DB-7456A3DC2756"></a>
<h3 id="DWHSG-GUID-AF8326B6-DADD-4893-85DB-7456A3DC2756" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写的检查</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于查询</font></font><a id="d39287e376" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写要发生，有一些数据必须通过的检查。</font><font style="vertical-align: inherit;">这些检查是：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-CDDBBA45-FB35-481B-9CC9-8E049B40B8AB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入兼容性检查查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5D05C98E-4020-4634-AC3E-9B24AF38893E"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写的数据充足性检查</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-9A52FD90-681E-40B6-9DBE-F0D338380BE4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组兼容性检查查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-E0156059-DF92-4302-80D3-C6C066130B3E"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写的聚合可计算性检查</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8503"></a><a id="DWHSG8502"></a>
<div class="props_rev_3"><a id="GUID-CDDBBA45-FB35-481B-9CC9-8E049B40B8AB"></a>
<h4 id="DWHSG-GUID-CDDBBA45-FB35-481B-9CC9-8E049B40B8AB" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入兼容性检查查询重写</font></font></h4>
<div>
<p><a id="d39287e424" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此检查中，将查询中的联接与实例化视图中的联接进行比较。</font><font style="vertical-align: inherit;">通常，此比较会将联接分类分为三类：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询和物化视图中出现的公共连接。</font><font style="vertical-align: inherit;">这些连接形成了共同的子图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参见</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C4AA632B-09EE-4A67-95B4-D6DD7B18950A"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Common Joins</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta连接在查询中发生但不在实体化视图中。</font><font style="vertical-align: inherit;">这些连接形成查询delta子图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-B8FC3ACE-11D3-404D-9C32-FFF9AEC945A7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询增量连接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delta连接发生在物化视图中但不在查询中。</font><font style="vertical-align: inherit;">这些连接形成物化视图delta子图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参见</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-FB70D563-A1E9-4B15-B9AF-AAE736DAD8CD"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图Delta连接</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些可以看到，</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-CDDBBA45-FB35-481B-9CC9-8E049B40B8AB__CHDDIIEJ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图11-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示</font><font style="vertical-align: inherit;">。</font></font></p>
<div class="figure" id="GUID-CDDBBA45-FB35-481B-9CC9-8E049B40B8AB__CHDDIIEJ">
<p class="titleinfigure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-2查询重写子图</font></font></p>
<img width="472" height="355" src="./物化视图的高级查询重写_files/GUID-380D12BC-1308-4A92-A4D7-C606DB59622A-default.gif" alt="下面是图11-2的描述" title="下面是图11-2的描述"><br>
<a href="https://docs.oracle.com/database/121/DWHSG/img_text/GUID-380D12BC-1308-4A92-A4D7-C606DB59622A-print.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图11-2查询重写子图”的说明</font></font></a></div>
<!-- class="figure" -->
<div class="infoboxnotealso" id="GUID-CDDBBA45-FB35-481B-9CC9-8E049B40B8AB__GUID-4AC10C11-EB92-4E60-BF1B-914CEEF4F289">
<p class="notep1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以看看：</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-AF8326B6-DADD-4893-85DB-7456A3DC2756"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写的检查</font></font></a></p>
</div>
</div>
<div class="props_rev_3"><a id="GUID-C4AA632B-09EE-4A67-95B4-D6DD7B18950A"></a>
<h5 id="DWHSG-GUID-C4AA632B-09EE-4A67-95B4-D6DD7B18950A" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常见的联接</font></font></h5>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该 </font></font><a id="d39287e490" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两者之间的公共连接对必须是相同类型，或者查询中的连接必须可以从物化视图中的连接派生。</font><font style="vertical-align: inherit;">例如，如果实例化视图包含表</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与表</font><font style="vertical-align: inherit;">的外部</font><font style="vertical-align: inherit;">联接</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且查询包含表</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与表</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的内部联接，则可以通过从外部联接的结果中过滤反连接行来派生内部联接的结果。</font><font style="vertical-align: inherit;">例如，请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_name，t.week_ending_day，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND mv.week_ending_day BETWEEN TO_DATE（'01 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                          和到_DATE（'10 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_name，mv.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询与物化视图之间的公共连接</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font>
 <font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们完全匹配，查询可以重写如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_name，mv.week_ending_day，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHVE mv.week_ending_day BETWEEN TO_DATE（'01 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                         和到_DATE（'10 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv.prod_name，mv.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用</font></font><code class="codeph">join_sales_time_product_oj_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font><font style="vertical-align: inherit;">来回答</font><font style="vertical-align: inherit;">查询，其中查询中的内部联接可以从物化视图中的外部联接派生。</font><font style="vertical-align: inherit;">重写版本（对用户透明）过滤掉反连接行。</font><font style="vertical-align: inherit;">重写的查询具有以下结构：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_name，mv.week_ending_day，SUM（mv.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_oj_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHVE mv.week_ending_day BETWEEN TO_DATE（'01 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND TO_DATE（'10 -AUG-1999'，'DD-MON-YYYY'）和mv.prod_id IS NOT NULL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv.prod_name，mv.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，如果在仅包含连接的实例化视图中使用外部联接，则应在实例化视图中放置外部联接右侧的主键或rowid。</font><font style="vertical-align: inherit;">例如，在前面的例子中，</font></font><code class="codeph">join_sales_time_product_oj_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，对两个主键</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用仅包含连接的物化视图的另一个示例是半连接重写的情况。</font><font style="vertical-align: inherit;">也就是说，查询包含</font><font style="vertical-align: inherit;">带有单个表</font></font><code class="codeph">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子查询</font><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">子查询。</font><font style="vertical-align: inherit;">请考虑以下查询，该报告会报告销售额超过1,000美元的产品：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT DISTINCT p.prod_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE EXISTS（SELECT p.prod_id，SUM（s.amount_sold）FROM sales s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              WHERE p.prod_id = s.prod_id具有SUM（s.amount_sold）&gt; 1000）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              GROUP BY p.prod_id）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询也可以表示为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT DISTINCT p.prod_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM products p WHERE p.prod_id IN（SELECT s.prod_id FROM sales s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                    WHERE s.amount_sold&gt; 1000）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询包含</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">表</font></font><code class="codeph">s.prod_id = p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之间的</font><font style="vertical-align: inherit;">semijoin（</font><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">。</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"></font><code class="codeph">sales</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果主键是活动的，则</font><font style="vertical-align: inherit;">可以重写此查询以使用</font><font style="vertical-align: inherit;">物化视图，如果主键是活动的，则</font><font style="vertical-align: inherit;">可以使用</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font></font><code class="codeph">join_sales_time_product_oj_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">观察两个物化视图都包含</font></font><code class="codeph">s.prod_id=p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可用于在查询中派生半连接。</font><font style="vertical-align: inherit;">查询重写</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM（SELECT DISTINCT mv.prod_name FROM join_sales_time_product_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在哪里mv.amount_sold&gt; 1000）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被分割</font></font><code class="codeph">time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则该查询可能比原来的查询更有效，因为原来的之间的连接</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经避免。</font><font style="vertical-align: inherit;">可以使用</font></font><code class="codeph">join_sales_time_product_oj_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下</font><font style="vertical-align: inherit;">方法重写查询</font><font style="vertical-align: inherit;">。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_name </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM（SELECT DISTINCT mv.prod_name FROM join_sales_time_product_oj_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      在哪里mv.amount_sold&gt; 1000和mv.prod_id IS NOT NULL）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有半连接的重写仅限于仅具有连接的实体化视图，并且对于具有连接和聚合的实例化视图是不可能的。</font></font></p>
<div class="infoboxnotealso" id="GUID-C4AA632B-09EE-4A67-95B4-D6DD7B18950A__GUID-6BD3E1F2-1383-4F1A-BF69-FEB38F308745">
<p class="notep1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以看看：</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-AF8326B6-DADD-4893-85DB-7456A3DC2756"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写的检查</font></font></a></p>
</div>
</div>
</div>
<a id="DWHSG8505"></a>
<div class="props_rev_3"><a id="GUID-B8FC3ACE-11D3-404D-9C32-FFF9AEC945A7"></a>
<h5 id="DWHSG-GUID-B8FC3ACE-11D3-404D-9C32-FFF9AEC945A7" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询Delta连接</font></font></h5>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font></font></span> <span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">增量</font></font></span> <span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个连接出现在查询，但不能在物化视图。</font><font style="vertical-align: inherit;">允许在查询中使用任何数量和类型的delta连接，并且在使用实例化视图重写查询时，只需保留它们。</font><font style="vertical-align: inherit;">为了使保留的连接起作用，实例化视图必须包含连接键。</font><font style="vertical-align: inherit;">重写后，实例化视图将连接到查询增量中的相应表。</font><font style="vertical-align: inherit;">例如，请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_name，t.week_ending_day，c.cust_city，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，时间t，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_name，t.week_ending_day，c.cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用物化视图</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，常见的连接是：</font></font><code class="codeph">s.time_id=t.time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">s.prod_id=p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">查询中的增量连接是</font></font><code class="codeph">s.cust_id=c.cust_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，重写的表单将</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图与</font></font><code class="codeph">customers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">连接</font><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_name，mv.week_ending_day，c.cust_city，SUM（mv.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自join_sales_time_product_mv mv，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里mv.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv.prod_name，mv.week_ending_day，c.cust_city;</font></font><font></font>
</pre>
<div class="infoboxnotealso" id="GUID-B8FC3ACE-11D3-404D-9C32-FFF9AEC945A7__GUID-C7B41779-AF2C-476C-85F4-3C6C4D8BD55D">
<p class="notep1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以看看：</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-AF8326B6-DADD-4893-85DB-7456A3DC2756"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写的检查</font></font></a></p>
</div>
</div>
</div>
<a id="DWHSG8506"></a>
<div class="props_rev_3"><a id="GUID-FB70D563-A1E9-4B15-B9AF-AAE736DAD8CD"></a>
<h5 id="DWHSG-GUID-FB70D563-A1E9-4B15-B9AF-AAE736DAD8CD" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图Delta加入</font></font></h5>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化</font></font></span> <span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图</font></font></span> <span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">增量</font></font></span> <span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个连接出现在物化视图，但没有查询。</font><font style="vertical-align: inherit;">所有德</font></font><a id="d39287e704" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于常见连接的结果，在物化视图中的lta连接必须是无损的。</font><font style="vertical-align: inherit;">无损连接可确保公共连接的结果不受限制。</font><font style="vertical-align: inherit;">一个</font></font><span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无损</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接是一个地方，如果两个表叫</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接在一起，在表中的行</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会一直匹配的表行</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，没有数据会丢失，因此，长期无损连接。</font><font style="vertical-align: inherit;">例如，具有外键的每一行都匹配具有主键的行，前提是外键中不允许空值。</font><font style="vertical-align: inherit;">因此，要保证无损连接，就必须有</font></font><code class="codeph">FOREIGN</code> <code class="codeph">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">PRIMARY</code> <code class="codeph">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="codeph">NOT</code> <code class="codeph">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在适当的约束联接键。</font><font style="vertical-align: inherit;">或者，如果表之间的连接</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为外连接（</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为外表），它是无损的，因为它保留了所有表的行</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图中的所有delta连接都需要相对于公共连接的结果不重复。</font><font style="vertical-align: inherit;">非重复连接可确保不重复公共连接的结果。</font><font style="vertical-align: inherit;">例如，非重复连接是指如果表</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和表</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接在一起，</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">中的行将与表</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的最多一行匹配，</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且不会发生重复。</font><font style="vertical-align: inherit;">要保证非重复连接，</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须使用主键或唯一约束将</font><font style="vertical-align: inherit;">表中的键</font><font style="vertical-align: inherit;">约束为唯一值。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑以下连接的查询</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">times</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT t.week_ending_day，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND t.week_ending_day BETWEEN TO_DATE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 （'01 -AUG-1999'，'DD-MON-YYYY'）和到_DATE（'10 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">之间</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有一个额外的连接（</font></font><code class="codeph">s.prod_id=p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是delta连接</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果此连接是无损且非重复的，则可以重写查询。</font><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">是外键</font><font style="vertical-align: inherit;">并且不是null，</font><font style="vertical-align: inherit;">则会出现这种情况</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，查询被重写为：</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"></font><code class="codeph">products</code><font style="vertical-align: inherit;"></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"></font><code class="codeph">s.prod_id</code><font style="vertical-align: inherit;"></font><code class="codeph">p.prod_id</code><font style="vertical-align: inherit;"></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT week_ending_day，SUM（amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
星期几到星期日（'01 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                       和到_DATE（'10 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用</font></font><code class="codeph">join_sales_time_product_mv_oj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要外键约束</font><font style="vertical-align: inherit;">的物化视图重写查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此视图包含（一个外部联接</font></font><code class="codeph">s.prod_id=p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（+））之间</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这使得连接无损。</font><font style="vertical-align: inherit;">如果</font></font><code class="codeph">p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是主键，则也满足非重复条件，优化器重写查询，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT week_ending_day，SUM（amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_oj_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
星期几到星期日（'01 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和到_DATE（'10 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用</font></font><code class="codeph">join_sales_time_product_mv_oj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要外键约束</font><font style="vertical-align: inherit;">的物化视图重写查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此视图包含（一个外部联接</font></font><code class="codeph">s.prod_id=p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（+））之间</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这使得连接无损。</font><font style="vertical-align: inherit;">如果</font></font><code class="codeph">p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是主键，则也满足非重复条件，优化器重写查询，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT week_ending_day，SUM（amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_oj_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
星期几到星期日（'01 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  和到_DATE（'10 -AUG-1999'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意外的定义加入的</font></font><code class="codeph">join_sales_time_product_mv_oj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为主键是没有必要的-之间的外键关系</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="codeph">sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构已经是无损的。</font><font style="vertical-align: inherit;">它仅用于演示目的，如果可以</font></font><code class="codeph">sales.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为空</font><font style="vertical-align: inherit;">则是必要的</font><font style="vertical-align: inherit;">，因此违反了连接条件的无损</font></font><code class="codeph">sales.prod_id = products.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前限制将大多数带有外连接的重写限制为仅具有连接的实体化视图。</font><font style="vertical-align: inherit;">对具有外部联接的物化聚合视图的重写的支持有限，因此这些物化视图应该依赖外键约束来确保物化视图增量连接的无损。</font></font></p>
<div class="infoboxnotealso" id="GUID-FB70D563-A1E9-4B15-B9AF-AAE736DAD8CD__GUID-BA16C43C-DDF5-4E96-99E5-30DDEC22E93D">
<p class="notep1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以看看：</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-AF8326B6-DADD-4893-85DB-7456A3DC2756"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写的检查</font></font></a></p>
</div>
</div>
</div>
<a id="DWHSG8507"></a>
<div class="props_rev_3"><a id="GUID-A931828B-F676-427C-9170-8CF5AB5FAA1C"></a>
<h5 id="DWHSG-GUID-A931828B-F676-427C-9170-8CF5AB5FAA1C" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入等价识别</font></font></h5>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写能够基于等效连接的识别进行许多转换。</font><font style="vertical-align: inherit;">查询重写将以下构造识别为等同于连接：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE table1.column1 = F（args）/ *子表达式A * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND table2.column2 = F（args）/ *子表达式B * /</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code class="codeph">F(args)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是被宣布为一个确定性PL / SQL功能和参数的两个调用</font></font><code class="codeph">F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是相同的，那么子表达式的组合</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与子表达式</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以可以被识别为之间的连接</font></font><code class="codeph">table1.column1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">table2.column2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，以下表达式等同于前一个表达式：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE table1.column1 = F（args）/ *子表达式A * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND table2.column2 = F（args）/ *子表达式B * /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND table1.column1 = table2.column2 / * join-expression J * /</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为</font></font><code class="codeph">J</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以从子表达式</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和子表达式</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推断join </font><font style="vertical-align: inherit;">-expression </font><font style="vertical-align: inherit;">，所以推断的连接可用于匹配实例</font></font><code class="codeph">table1.column1 = table2.column2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">化视图</font><font style="vertical-align: inherit;">中的相应连接</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<a id="DWHSG8504"></a><a id="DWHSG8508"></a>
<div class="props_rev_3"><a id="GUID-5D05C98E-4020-4634-AC3E-9B24AF38893E"></a>
<h4 id="DWHSG-GUID-5D05C98E-4020-4634-AC3E-9B24AF38893E" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写的数据充足性检查</font></font></h4>
<div>
<p><a id="d39287e960" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此检查中，优化程序确定是否可以从实例化视图获取查询所请求的必要列数据。</font><font style="vertical-align: inherit;">为此，使用一列与另一列的等价。</font><font style="vertical-align: inherit;">例如，如果表</font></font><code class="codeph">A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和表</font><font style="vertical-align: inherit;">之间的内部联接</font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于连接谓词</font></font><code class="codeph">A.X = B.X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则列中</font></font><code class="codeph">A.X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数据等于</font></font><code class="codeph">B.X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接结果中的</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此数据属性用于将</font></font><code class="codeph">A.X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中的列与实例</font></font><code class="codeph">B.X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">化视图中的</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">匹配</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">反之亦然。</font><font style="vertical-align: inherit;">例如，请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_name，s.time_id，t.week_ending_day，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_name，s.time_id，t.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使物化视图没有，</font><font style="vertical-align: inherit;">也可以回答此查询</font></font><code class="codeph">s.time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相反，它具有</font></font><code class="codeph">t.time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，通过连接条件</font></font><code class="codeph">s.time_id=t.time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，相当于</font></font><code class="codeph">s.time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，优化器可能会选择以下重写：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_name，time_id，week_ending_day，SUM（amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_name，time_id，week_ending_day;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG8509"></a>
<div class="props_rev_3"><a id="GUID-9A52FD90-681E-40B6-9DBE-F0D338380BE4"></a>
<h4 id="DWHSG-GUID-9A52FD90-681E-40B6-9DBE-F0D338380BE4" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组兼容性检查查询重写</font></font></h4>
<div>
<p><a id="d39287e1030" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当物化视图和查询都包含</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">时，才需要进行此检查</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化器首先确定查询所请求的数据分组是否与存储在物化视图中的数据分组完全相同。</font><font style="vertical-align: inherit;">换句话说，查询和物化视图中的分组级别相同。</font><font style="vertical-align: inherit;">如果实体化视图对查询中的所有列和表达式进行分组，并且还对其他列或表达式进行分组，则查询重写可以在分组列和查询表达式上重新聚合实体化视图，以获得查询请求的相同结果。</font></font></p>
</div>
</div>
<a id="DWHSG8510"></a>
<div class="props_rev_3"><a id="GUID-E0156059-DF92-4302-80D3-C6C066130B3E"></a>
<h4 id="DWHSG-GUID-E0156059-DF92-4302-80D3-C6C066130B3E" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写的聚合可计算性检查</font></font></h4>
<div>
<p><a id="d39287e1062" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当查询和物化视图都包含聚合时，才需要进行此检查。</font><font style="vertical-align: inherit;">这里，优化器确定查询所请求的聚合是否可以从存储在物化视图中的一个或多个聚合中派生或计算。</font><font style="vertical-align: inherit;">例如，如果查询请求</font></font><code class="codeph">AVG(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和物化视图包含</font></font><code class="codeph">SUM(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">COUNT(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><code class="codeph">AVG(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以计算为</font></font><code class="codeph">SUM(X)/COUNT(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果分组兼容性检查确定需要存储在实例化视图中的聚合的汇总，则聚合可计算性检查将确定是否可以使用实例化视图中的聚合来汇总查询所请求的每个聚合。</font></font></p>
</div>
</div>
</div>
<a id="DWHSG08014"></a>
<div class="props_rev_3"><a id="GUID-9279E302-ECD5-4316-B0AC-493507C7F7F2"></a>
<h3 id="DWHSG-GUID-9279E302-ECD5-4316-B0AC-493507C7F7F2" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用维度重写查询</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论在重写环境中使用维度的以下方面：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-2F32D121-29DA-42C6-A155-C8A52472CDD5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询重写环境中使用维度的好处</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何定义查询重写的维度</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8511"></a>
<div class="props_rev_3"><a id="GUID-2F32D121-29DA-42C6-A155-C8A52472CDD5"></a>
<h4 id="DWHSG-GUID-2F32D121-29DA-42C6-A155-C8A52472CDD5" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询重写环境中使用维度的好处</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维度定义列之间的分层（父/子）关系，其中所有列不必来自同一个表。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维度定义增加了查询重写的可能性，因为它们有助于在列之间建立功能依赖性。</font><font style="vertical-align: inherit;">此外，维度可以表示不能由约束表达的表内关系。</font><font style="vertical-align: inherit;">维度定义不占用额外的存储空间。</font><font style="vertical-align: inherit;">相反，维度定义会建立描述架构内部和维度间关系的元数据。</font><font style="vertical-align: inherit;">在创建实体化视图之前，第一步是检查模式并定义维度，因为这可以显着提高重写查询的机会。</font></font></p>
</div>
</div>
<a id="DWHSG8512"></a>
<div class="props_rev_3"><a id="GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA"></a>
<h4 id="DWHSG-GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何定义查询重写的维度</font></font></h4>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于任何给定的架构，请使用以下步骤创建维度：</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<ol>
<li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACCBIDA"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别架构中的所有维度和维度表</font></font></a></li>
<li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACJGGBJ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定每个维度中的层次结构</font></font></a></li>
<li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACIBIHJ"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定层次结构的每个级别中的属性依赖性</font></font></a></li>
<li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACCIIHG"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别数据仓库中事实表到每个维度的连接</font></font></a></li>
</ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住将参数设置</font></font><code class="codeph">QUERY_REWRITE_INTEGRITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">STALE_TOLERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于查询重写，以利用维度中声明的关系。</font></font></p>
</div>
<!-- class="section" -->
<div class="section" id="GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACCBIDA">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别架构中的所有维度和维度表</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果维度已规范化，即存储在多个表中，则检查维度表之间的连接是否保证每个子端行与一个且仅一个父端行连接。</font><font style="vertical-align: inherit;">在非规范化维度的情况下，检查子端列是否唯一地确定父端（或属性）列。</font><font style="vertical-align: inherit;">不遵守这些规则可能会导致查询返回不正确的结果。</font></font></p>
</div>
<!-- class="section" -->
<div class="section" id="GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACJGGBJ">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定每个维度中的层次结构</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，日是一个月的孩子（您可以将日级别数据汇总到一个月），而季度是一年中的孩子。</font></font></p>
</div>
<!-- class="section" -->
<div class="section" id="GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACIBIHJ">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定层次结构的每个级别中的属性依赖性</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，标识这</font></font><code class="codeph">calendar_month_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是月份的属性。</font></font></p>
</div>
<!-- class="section" -->
<div class="section" id="GUID-C0BDF64C-8D46-4928-BFAF-200761ED5ECA__CACCIIHG">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别数据仓库中事实表到每个维度的连接</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后检查每个连接是否可以保证每个事实行与一个且仅一个维度行连接。</font><font style="vertical-align: inherit;">必须通过</font><font style="vertical-align: inherit;">在父端连接键上</font><font style="vertical-align: inherit;">添加</font></font><code class="codeph">FOREIGN</code> <code class="codeph">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">NOT</code> <code class="codeph">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束事实键列和</font></font><code class="codeph">PRIMARY</code> <code class="codeph">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束</font><font style="vertical-align: inherit;">来声明并可选地强制执行此条件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果其他数据处理过程（例如，您的加载过程）可以保证这些关系，则可以使用该</font></font><code class="codeph">NOVALIDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启用这些约束，</font><font style="vertical-align: inherit;">以避免验证表中的每一行符合约束所需的时间。</font></font><code class="codeph">RELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有未经验证的约束也需要</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">子句，以使它们有资格在查询重写中使用。</font></font></p>
</div>
<!-- class="section" --></div>
<a id="DWHSG9412"></a>
<div class="props_rev_3"><a id="GUID-7D334590-98DE-475F-A815-1F36934B7ADA"></a>
<h5 id="DWHSG-GUID-7D334590-98DE-475F-A815-1F36934B7ADA" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于创建时间维度的示例SQL语句</font></font></h5>
<div>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE DIMENSION times_dim</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LEVEL日是TIMES.TIME_ID</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LEVEL月份是TIMES.CALENDAR_MONTH_DESC</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LEVEL季度IS TIMES.CALENDAR_QUARTER_DESC</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LEVEL年份是TIMES.CALENDAR_YEAR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
等级fis_week是TIMES.WEEK_ENDING_DAY</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LEVEL fis_month是TIMES.FISCAL_MONTH_DESC</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
LEVEL fis_quarter是TIMES.FISCAL_QUARTER_DESC</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
等级fis_year是TIMES.FISCAL_YEAR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        HIERARCHY cal_rollup</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （每年四分之一儿童的儿童日）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        HIERARCHY fis_rollup    </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （fis_week孩子的fis_week孩子的日子） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        fis_year的孩子）</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        属性日确定</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （day_number_in_week，day_name，day_number_in_month，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         calendar_week_number）</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ATTRIBUTE月决定</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （calendar_month_desc，calendar_month_number，calendar_month_name， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         days_in_cal_month，end_of_cal_month）</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        属性四分之一决定 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （calendar_quarter_desc，calendar_quarter_number，days_in_cal_quarter，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         end_of_cal_quarter）</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ATTRIBUTE年份确定</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （calendar_year，days_in_cal_year，end_of_cal_year）</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ATTRIBUTE fis_week确定</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        （week_ending_day，fiscal_week_number）;</font></font><font></font>
</pre></div>
</div>
</div>
</div>
</div>
<a id="DWHSG0802"></a>
<div class="props_rev_3"><a id="GUID-5297DA70-0064-4EA4-B492-E45089E5074F"></a>
<h2 id="DWHSG-GUID-5297DA70-0064-4EA4-B492-E45089E5074F" class="sect2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写的类型</font></font></h2>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有需要通过大量行进行计算或在非常大的表之间进行连接的聚合的查询可能很昂贵，因此返回结果可能需要很长时间。</font><font style="vertical-align: inherit;">查询重写使用具有预先计算结果的物化视图透明地重写此类查询，以便几乎可以即时回答查询。</font><font style="vertical-align: inherit;">这些物化视图可以大致分为两组，即物化聚合视图和物化连接视图。</font><font style="vertical-align: inherit;">物化聚合视图是具有预先计算的原始表中列的聚合值的表。</font><font style="vertical-align: inherit;">类似地，物化连接视图是在原始表的列之间具有预先计算的连接的表。</font><font style="vertical-align: inherit;">查询重写转换传入查询以从实例化视图列中获取结果。</font><font style="vertical-align: inherit;">由于这些列包含已预先计算的结果，因此几乎可以即时回答传入的查询。</font><font style="vertical-align: inherit;">有关多维数据集组织的物化视图的查询重写的注意事项，请参阅</font></font><a class="olink OLAUG700" target="_blank" href="https://docs.oracle.com/database/121/OLAUG/admin.htm#OLAUG700"><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle OLAP用户指南</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论可用于重写查询的以下方法：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-A95A5C58-B011-44FF-B5CB-EE4FDEE032D5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法1：文本匹配重写</font></font></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-512B09CD-D2C3-4FA9-BC7C-0A4EF6A4B74F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法2：加入返回</font></font></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-4682B101-191E-4C39-B90D-E927D84123DA"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法3：聚合可计算性</font></font></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-34D5394E-9267-4785-8737-0DA0D35E4849"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法4：聚合汇总</font></font></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5CE61CCA-6A0A-4FB4-8F77-1A405AFC142F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法5：使用维度汇总</font></font></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-D8D9019B-EF84-408E-9DB8-75EAD33A3A9D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法6：物化视图只有一个数据子集</font></font></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-A32547B4-7E20-4EAB-B3B7-A7DBC1E5B4D8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区更改跟踪（PCT）重写</font></font></a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用多个物化视图重写查询</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG08021"></a>
<div class="props_rev_3"><a id="GUID-A95A5C58-B011-44FF-B5CB-EE4FDEE032D5"></a>
<h3 id="DWHSG-GUID-A95A5C58-B011-44FF-B5CB-EE4FDEE032D5" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法1：文本匹配重写</font></font></h3>
<div>
<p><a id="d39287e1354" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写引擎始终首先尝试将传入查询的文本与任何潜在物化视图的定义文本进行比较，以重写查询。</font><font style="vertical-align: inherit;">这是因为与进行一般重写所需的复杂分析的成本相比，进行简单文本比较的开销通常可以忽略不计。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写引擎使用两种文本匹配方法，全文匹配重写和部分文本匹配重写。</font><font style="vertical-align: inherit;">在全文匹配中，将查询的整个文本与实体化视图定义的整个文本（即整个</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式）进行比较，忽略文本比较期间的空白。</font><font style="vertical-align: inherit;">例如，假设您具有以下物化视图</font></font><code class="codeph">sum_sales_pscat_month_city_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_sales_pscat_month_city_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SELECT p.prod_subcategory，t.calendar_month_desc，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SUM（s.amount_sold）AS sum_amount_sold，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   COUNT（s.amount_sold）AS count_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   从销售s，产品p，时间t，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   WHERE.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUP BY p.prod_subcategory，t.calendar_month_desc，c.cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_subcategory，t.calendar_month_desc，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       COUNT（s.amount_sold）AS count_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       从销售s，产品p，时间t，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       WHERE.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       GROUP BY p.prod_subcategory，t.calendar_month_desc，c.cust_city;</font></font><font></font>
 <font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询匹配</font></font><code class="codeph">sum_sales_pscat_month_city_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（排除了空格）并重写为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_subcategory，mv.calendar_month_desc，mv.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       mv.sum_amount_sold，mv.count_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sum_sales_pscat_month_city_mv;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当全文匹配失败时，优化程序将尝试部分文本匹配。</font><font style="vertical-align: inherit;">在此方法中，将从</font></font><code class="codeph">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font></font><code class="codeph">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">开始的文本与</font><font style="vertical-align: inherit;">以物化视图定义</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">开头的文本进行比较</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，可以重写以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_subcategory，t.calendar_month_desc，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       AVG（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，时间t，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory，t.calendar_month_desc，c.cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询被重写为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_subcategory，mv.calendar_month_desc，mv.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       mv.sum_amount_sold / mv.count_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sum_sales_pscat_month_city_mv mv;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在部分文本匹配重写方法下，查询所需的销售总计的平均值是使用物化视图中存储的销售总额和销售总计数计算的。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当文本匹配都不成功时，优化程序使用常规查询重写方法。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本匹配重写可以区分大写和小写之间的差异很大而不是大写的区别。</font><font style="vertical-align: inherit;">例如，以下语句是等效的：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择X，'aBc'来自Y.</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从y选择x，'aBc'</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG08022"></a>
<div class="props_rev_3"><a id="GUID-512B09CD-D2C3-4FA9-BC7C-0A4EF6A4B74F"></a>
<h3 id="DWHSG-GUID-512B09CD-D2C3-4FA9-BC7C-0A4EF6A4B74F" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法2：加入返回</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果无法从物化视图获得查询请求的某些列数据，则优化器还基于称为功能依赖性的数据关系来确定是否可以获得它。</font><font style="vertical-align: inherit;">当列中的数据可以确定另一列中的数据时，这种关系称为功能依赖性或功能确定性。</font><font style="vertical-align: inherit;">例如，如果一个表包含一个被调用的主键列</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而另一个被调用的列</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么，给定一个</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值，就可以查找相应的列</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">相反的情况并非如此，这意味着</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值不必与唯一相关</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询所需的列数据在物化视图中不可用时，仍然可以通过将物化视图连接回包含所需列数据的表来获得此类列数据，前提是物化视图包含在功能上确定所需列的键数据。</font><font style="vertical-align: inherit;">例如，请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，t.week_ending_day，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id AND p.prod_category ='CD'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category，t.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font></font><code class="codeph">sum_sales_prod_week_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font></font><code class="codeph">p.prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但不</font><font style="vertical-align: inherit;">包含</font></font><code class="codeph">p.prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，您可以联接</font></font><code class="codeph">sum_sales_prod_week_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回来</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行检索，</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能确定</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化程序使用</font></font><code class="codeph">sum_sales_prod_week_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下方法</font><font style="vertical-align: inherit;">重写此查询</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，mv.week_ending_day，SUM（mv.sum_amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_prod_week_mv mv，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里mv.prod_id = p.prod_id AND p.prod_category ='CD'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category，mv.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里的</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表称为连接表，因为它最初在物化视图中连接，但在重写的查询中再次连接。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过两种方式声明函数依赖：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用主键约束（如上例所示）</font></font></p>
</li>
<li>
<p style="margin: 0px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="codeph">DETERMINES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维度</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"></font><code class="codeph">DETERMINES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当确定另一列的列不能是主键时，维度定义</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句可能是声明功能依赖性的唯一方法。</font><font style="vertical-align: inherit;">例如，该</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表是一个具有列的非规范化的维度表</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在功能上确定</font></font><code class="codeph">prod_subcat_desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定</font></font><code class="codeph">prod_cat_desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个函数依赖关系可以通过声明</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为主键而不是第二个函数依赖</font><font style="vertical-align: inherit;">关系来建立，</font><font style="vertical-align: inherit;">因为该</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列包含重复值。</font><font style="vertical-align: inherit;">在这种情况下，您可以使用</font></font><code class="codeph">DETERMINES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句来声明第二个函数依赖项。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下维度定义说明了如何声明功能依赖性：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE DIMENSION products_dim </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        LEVEL产品IS（products.prod_id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        LEVEL子类别IS（products.prod_subcategory） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        LEVEL类别IS（products.prod_category） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        HIERARCHY prod_rollup（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                产品儿童 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                子类儿童 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                类别</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ATTRIBUTE产品DETERMINES products.prod_name </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ATTRIBUTE产品DETERMINES products.prod_desc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ATTRIBUTE子类别确定products.prod_subcat_desc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        ATTRIBUTE类别DETERMINES products.prod_cat_desc;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">层次结构</font></font><code class="codeph">prod_rollup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明了层次关系，它们也是</font></font><code class="codeph">1:n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能依赖关系。</font><font style="vertical-align: inherit;">该</font></font><code class="codeph">1:1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数依赖所使用的声明</font></font><code class="codeph">DETERMINES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，当所看到</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能上确定</font></font><code class="codeph">prod_subcat_desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果创建了以下物化视图：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_sales_pscat_week_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_subcategory，t.week_ending_day，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sole</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory，t.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_subcategory_desc，t.week_ending_day，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND p.prod_subcat_desc LIKE'％Men'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcat_desc，t.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可以通过连接</font></font><code class="codeph">sum_sales_pscat_week_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">来重写，</font><font style="vertical-align: inherit;">以便</font></font><code class="codeph">prod_subcat_desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以评估谓词。</font><font style="vertical-align: inherit;">但是，连接基于</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列，该列不是</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的主键</font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">因此，它允许重复。</font><font style="vertical-align: inherit;">这是通过使用选择不同值的内联视图来完成的，并且此视图将连接到实例化视图，如重写查询中所示。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT iv.prod_subcat_desc，mv.week_ending_day，SUM（mv.sum_amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_pscat_week_mv mv， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     （SELECT DISTINCT prod_subcategory，prod_subcat_desc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      来自产品）iv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE mv.prod_subcategory = iv.prod_subcategory </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND iv.prod_subcat_desc LIKE'％Men'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY iv.prod_subcat_desc，mv.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种类型的重写是可能的，因为在</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能上确定</font></font><code class="codeph">prod_subcategory_desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在维度中声明。</font></font></p>
</div>
</div>
<a id="DWHSG08023"></a>
<div class="props_rev_3"><a id="GUID-4682B101-191E-4C39-B90D-E927D84123DA"></a>
<h3 id="DWHSG-GUID-4682B101-191E-4C39-B90D-E927D84123DA" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法3：聚合可计算性</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当优化程序确定查询所请求的聚合是否可以从存储在实例化视图中的一个或多个聚合中派生或计算时，也可能发生查询重写。</font><font style="vertical-align: inherit;">例如，如果查询请求</font></font><code class="codeph">AVG(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和物化视图包含</font></font><code class="codeph">SUM(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">COUNT(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><code class="codeph">AVG(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以计算为</font></font><code class="codeph">SUM(X)/COUNT(X)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，如果确定需要存储在物化视图中的聚合的汇总，则如果可能，查询重写还会使用物化视图中的聚合汇总查询所请求的每个聚合。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，</font><font style="vertical-align: inherit;">通过将</font><font style="vertical-align: inherit;">具有相同状态值的组中的</font><font style="vertical-align: inherit;">所有</font><font style="vertical-align: inherit;">聚合</font><font style="vertical-align: inherit;">相加，</font></font><code class="codeph">SUM(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将城市级别汇总到</font></font><code class="codeph">SUM(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">州级别</font></font><code class="codeph">SUM(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，</font></font><code class="codeph">AVG(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能卷起粗糙的水平，除非</font></font><code class="codeph">COUNT(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">SUM(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是在物化视图中可用。</font><font style="vertical-align: inherit;">类似地，</font></font><code class="codeph">VARIANCE(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">STDDEV(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能被卷起，除非两个</font></font><code class="codeph">COUNT(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">SUM(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也是在物化视图中可用。</font><font style="vertical-align: inherit;">例如，请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE时间MODIFY CONSTRAINT time_pk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE客户MODIFY CONSTRAINT customers_pk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE销售MODIFY CONSTRAINT sales_time_pk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE销售MODIFY CONSTRAINT sales_customer_fk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_subcategory，AVG（s.amount_sold）AS avg_sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，products p WHERE s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个语句可以改写与物化视图</font></font><code class="codeph">sum_sales_pscat_month_city_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供之间的连接</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">times</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">customers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的无损和非复制。</font><font style="vertical-align: inherit;">此外，查询分组，</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而物化视图分组依次</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">calendar_month_desc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="codeph">cust_city</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着必须汇总存储在物化视图中的聚合。</font><font style="vertical-align: inherit;">优化程序将重写查询，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_subcategory，SUM（mv.sum_amount_sold）/ COUNT（mv.count_amount_sold） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   AS avg_sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_pscat_month_city_mv mv </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv.prod_subcategory;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诸如聚合的参数</font></font><code class="codeph">SUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以是诸如的算术表达式</font></font><code class="codeph">A+B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">优化程序尝试将</font></font><code class="codeph">SUM(A+B)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中的聚合与聚合</font><font style="vertical-align: inherit;">匹配</font></font><code class="codeph">SUM(A+B)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">SUM(B+A)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在实例化视图中。</font><font style="vertical-align: inherit;">换句话说，在将查询中的聚合的参数与实例化视图中的类似聚合的参数进行匹配时，将使用表达式等效。</font><font style="vertical-align: inherit;">为此，Oracle将聚合参数表达式转换为规范形式，以便两个不同但等效的表达式转换为相同的规范形式。</font><font style="vertical-align: inherit;">例如</font></font><code class="codeph">A*(B-C)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">A*B-C*A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">(B-C)*A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="codeph">-A*C+A*B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有转换成相同的规范形式，因此，它们匹配成功。</font></font></p>
</div>
</div>
<a id="DWHSG08024"></a>
<div class="props_rev_3"><a id="GUID-34D5394E-9267-4785-8737-0DA0D35E4849"></a>
<h3 id="DWHSG-GUID-34D5394E-9267-4785-8737-0DA0D35E4849" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法4：聚合汇总</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询请求的数据分组比物化视图中存储的数据分组更粗略，则优化程序仍然可以使用物化视图来重写查询。</font><font style="vertical-align: inherit;">例如，物化视图</font></font><code class="codeph">sum_sales_pscat_week_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">week_ending_day</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此查询分组</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，更粗略的分组粒度：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE时间MODIFY CONSTRAINT time_pk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE销售MODIFY CONSTRAINT sales_time_fk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_subcategory，SUM（s.amount_sold）AS sum_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，products pWHERE s.prod_id = p.prod_id </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，优化程序将此查询重写为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_subcategory，SUM（mv.sum_amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_pscat_week_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv.prod_subcategory;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG08025"></a>
<div class="props_rev_3"><a id="GUID-5CE61CCA-6A0A-4FB4-8F77-1A405AFC142F"></a>
<h3 id="DWHSG-GUID-5CE61CCA-6A0A-4FB4-8F77-1A405AFC142F" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法5：使用维度汇总</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当层次结构中的不同级别需要报告时，如果已定义维度，则不必在层次结构中的每个级别创建实例化视图。</font><font style="vertical-align: inherit;">这是因为查询重写可以使用维度中的关系信息将物化视图中的数据汇总到层次结构中的所需级别。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下示例中，查询请求按实体</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">化视图存储按组分组的数据分组的数据</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是a </font></font><code class="codeph">CHILD</code> <code class="codeph">OF</code> <code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（参见前面的维度示例），则可以在</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写查询时</font><font style="vertical-align: inherit;">进一步对存储在物化视图中的分组数据进行分组</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">换句话说，</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在物化视图中的</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别（更细粒度）的</font><font style="vertical-align: inherit;">聚合可以在</font><font style="vertical-align: inherit;">级别（更粗粒度）上卷积</font><font style="vertical-align: inherit;">成聚合</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，t.week_ending_day，SUM（s.amount_sold）AS sum_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category，t.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为在</font></font><code class="codeph">prod_subcategory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能上确定</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">sum_sales_pscat_week_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以与joinback一起使用</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来检索</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列数据，然后聚合可以汇总到</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT pv.prod_category，mv.week_ending_day，SUM（mv.sum_amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_pscat_week_mv mv，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       （SELECT DISTINCT prod_subcategory，prod_category</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        来自产品）pv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里mv.prod_subcategory = pv.prod_subcategory</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY pv.prod_category，mv.week_ending_day;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG8513"></a>
<div class="props_rev_3"><a id="GUID-D8D9019B-EF84-408E-9DB8-75EAD33A3A9D"></a>
<h3 id="DWHSG-GUID-D8D9019B-EF84-408E-9DB8-75EAD33A3A9D" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写方法6：物化视图只有一个数据子集</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle支持重写查询，以便它们使用物化视图，其中物化视图的</font></font><code class="codeph">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句包含一个或多个表中数据子集的选择。</font><font style="vertical-align: inherit;">例如，只有住在新罕布什尔州的客户。</font><font style="vertical-align: inherit;">换句话说，</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句将是</font></font><code class="codeph">WHERE state = 'New Hampshire'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要执行此类查询重写，Oracle必须确定查询中请求的数据是否包含在物化视图中存储的数据中，或者是其中的子集。</font><font style="vertical-align: inherit;">以下部分详细介绍了Oracle可以解决此问题的条件，从而重写查询以使用包含详细信息表中数据的已过滤部分的实体化视图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要确定是否可以对筛选数据进行查询重写，当查询和物化视图都包含选择（非连接）并且</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对该</font></font><code class="codeph">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">以及</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">进行检查时，将执行选择可计算性检查</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果物化视图包含选择而查询不包含，则选择兼容性检查将失败，因为物化视图比查询更具限制性。</font><font style="vertical-align: inherit;">如果查询有选择而物化视图没有，则不需要选择兼容性检查。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句可以包含连接，选择或两者，并且仍可用于重写查询。</font><font style="vertical-align: inherit;">包含表达式的谓词子句或基于特定列的值选择行是非连接谓词的示例。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节包含以下主题：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-8461E26C-8B80-4432-B7AE-F135003A3671"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当物化视图只有一个数据子集时，查询重写定义</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-A606CB4D-1B46-411B-B166-9E1D688D0F1C"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图仅具有数据子集时的选择类别</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写选择的示例</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-8B6C8FC5-BDEB-4FEB-878B-03CA337E48B8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写中HAVING子句的处理</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-191815BB-D689-4A2F-B1AD-32B88BC5CF44"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于实体化视图具有IN列表时的查询重写</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8514"></a>
<div class="props_rev_3"><a id="GUID-8461E26C-8B80-4432-B7AE-F135003A3671"></a>
<h4 id="DWHSG-GUID-8461E26C-8B80-4432-B7AE-F135003A3671" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当物化视图只有一个数据子集时，查询重写定义</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在描述查询重写仅与数据的子集一起使用时可能的情况之前，以下定义很有用：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入relop</font></font></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是以下之一 </font></font><code class="codeph">(=, &lt;, &lt;=, &gt;, &gt;=)</code></p>
</li>
<li>
<p><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择重新安置</font></font></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是以下之一 </font></font><code class="codeph">(=, &lt;, &lt;=, &gt;, &gt;=, !=, [NOT] BETWEEN | IN| LIKE |NULL)</code></p>
</li>
<li>
<p><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入谓词</font></font></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其形式为</font></font><code class="codeph">(</code><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column1 </font></font></span> <span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">join </font></font></span> <span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">relop </font></font></span> <span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column2</font></font></span><code class="codeph">)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中列来自</font></font><code class="codeph">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前查询块中</font><font style="vertical-align: inherit;">同一</font><font style="vertical-align: inherit;">子句中的</font><font style="vertical-align: inherit;">不同表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，例如，外部参考是不可能的。</font></font></p>
</li>
<li>
<p><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择谓词</font></font></span></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式</font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为左手侧表达式</font></font></span> <span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">relop </font></font></span> <span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右手侧表达式</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">所有非连接谓词都是选择谓词。</font><font style="vertical-align: inherit;">左侧通常包含一列，右侧包含值。</font><font style="vertical-align: inherit;">例如，</font></font><code class="codeph">color='red'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示左侧是</font></font><code class="codeph">color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右侧，而右侧是</font></font><code class="codeph">'red'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关系运算符</font></font><code class="codeph">(=)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
</div>
</div>
<a id="DWHSG8515"></a>
<div class="props_rev_3"><a id="GUID-A606CB4D-1B46-411B-B166-9E1D688D0F1C"></a>
<h4 id="DWHSG-GUID-A606CB4D-1B46-411B-B166-9E1D688D0F1C" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图仅具有数据子集时的选择类别</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择分为以下几种情况：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的选择是</font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式表达式relop常量</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复杂</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复杂的选择具有</font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式relop表达式</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围选择的形式如</font></font><code class="codeph">WHERE (cust_last_name BETWEEN 'abacrombe' AND 'anakin')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，使用关系运算符的简单选择</font></font><code class="codeph">(&lt;,&lt;=,&gt;,&gt;=)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也被视为范围选择。</font></font></p>
</li>
<li>
<p><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 列出</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单列和多列</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表等</font></font><code class="codeph">WHERE(prod_id) IN (102, 233, ....)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，表单的选择</font></font><code class="codeph">(column1='v1' OR column1='v2' OR column1='v3' OR ....)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被视为一个组并归类为</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-list。</font></font></p>
</li>
<li>
<p><code class="codeph">IS [NOT] NULL</code></p>
</li>
<li>
<p><code class="codeph">[NOT] LIKE</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他选择是它无法确定数据的边界。</font><font style="vertical-align: inherit;">例如，</font></font><code class="codeph">EXISTS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查询中的选择与实体化视图中的选择进行比较时，将比较两个选择的左侧。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果左侧选择匹配，则检查右侧值是否包含。</font><font style="vertical-align: inherit;">也就是说，查询选择的右侧值必须包含在物化视图选择的右侧值中。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以在选择谓词中使用表达式。</font><font style="vertical-align: inherit;">此过程类似于以下内容：</font></font></p>
<pre dir="ltr"><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式关系运算符常量</font></font></span>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过Oracle数据库允许任意算术表达式。</font><font style="vertical-align: inherit;">物化视图和查询中的表达式必须匹配。</font><font style="vertical-align: inherit;">Oracle尝试识别逻辑上等效的表达式，例如</font></font><code class="codeph">A+B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">B+A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并始终将相同的表达式视为等效。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您还可以将运算符两侧的表达式或用户定义的函数用作运算符。</font><font style="vertical-align: inherit;">当物化视图中的复杂谓词和查询在逻辑上等效时，会发生查询重写。</font><font style="vertical-align: inherit;">这意味着，与完全文本匹配不同，术语可以采用不同的顺序，只要表达式是等效的，重写仍然可以发生。</font></font></p>
</div>
</div>
<a id="DWHSG8517"></a><a id="DWHSG8518"></a><a id="DWHSG8519"></a><a id="DWHSG8520"></a><a id="DWHSG8521"></a><a id="DWHSG8522"></a><a id="DWHSG8523"></a><a id="DWHSG8524"></a><a id="DWHSG8525"></a><a id="DWHSG8516"></a>
<div class="props_rev_3"><a id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5"></a>
<h4 id="DWHSG-GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写选择的示例</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是一些示例，说明了在过滤数据时如何仍然可以进行查询重写。</font></font></p>
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-167F7ABB-1E3F-4864-9F32-66EA692A8BF8">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-1单值选择</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里prod_id = 102
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且，如果物化视图包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里prod_id在0和200之间
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，左侧选择匹配</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且查询的右侧值</font></font><code class="codeph">102</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在物化视图的范围内，因此可以进行查询重写。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-925A8856-54C4-4A3A-8513-3202B3E1D8A7">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-2有界范围选择</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择可以是有界范围（具有上限值和下限值的范围）。</font><font style="vertical-align: inherit;">例如，如果查询包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里prod_id&gt; 10 AND prod_id &lt;50
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里prod_id在0和200之间
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，匹配选择</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且查询范围在物化视图范围内。</font><font style="vertical-align: inherit;">在此示例中，请注意两个查询选择都基于同一列。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-6BD15933-8F86-4E11-8385-C3C5AF3396C6">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-3用表达式选择</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（sales.amount_sold * .07）介于1.00和100.00之间
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（sales.amount_sold * .07）BETWEEN 0.0和200.00
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，匹配选择</font></font><code class="codeph">(sales.amount_sold *.07)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且查询的右侧值在物化视图的范围内，因此可以进行查询重写。</font><font style="vertical-align: inherit;">诸如此类的复杂选择要求左侧和右侧在物化视图的范围内匹配。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-46199516-033E-4449-B5E3-3E2DC5766105">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-4完全匹配选择</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（cost.unit_price * 0.95）&gt;（cost_unit_cost * 1.25）
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下内容：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（cost.unit_price * 0.95）&gt;（cost_unit_cost * 1.25）
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果左侧和右侧与物化视图匹配且</font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selection_relop</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同，则通常可以从重写的查询中删除选择。</font><font style="vertical-align: inherit;">否则，必须保留选择以从物化视图中过滤掉额外数据。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询重写可以从重写的查询中删除选择，则选择中的所有列可能不必在物化视图中，因此可以进行更多的重写。</font><font style="vertical-align: inherit;">这可确保物化视图数据不会比查询更具限制性。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-E3FD30AD-7B01-4966-89F7-225DAD7986A8">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例11-5查询中的更多选择</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中的选择不必与实体化视图中的任何选择匹配，但如果是，则实体化视图必须包含右侧值。</font><font style="vertical-align: inherit;">例如，如果查询包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE prod_name ='短裤'和'prod_category ='男士'
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里prod_category ='男人'
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，在此示例中，仅</font></font><code class="codeph">prod_category</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配</font><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该查询具有一个不匹配的额外选择，但这是可以接受的，因为如果物化视图选择</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或选择可以连接回详细信息表的列，则可以进行</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写。</font><font style="vertical-align: inherit;">唯一的要求是查询重写必须有一种方法将</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择应用于物化视图。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-FE4FAE82-3025-4353-AB8D-7B425C5B5142">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例11-6由于查询中的选择较少而无法重写</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在哪里prod_category ='男人'
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE prod_name ='短裤'和'prod_category ='男士'
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，物化视图选择与</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不匹配。</font><font style="vertical-align: inherit;">物化视图比查询更具限制性，因为它只包含产品Shorts，因此，不会发生查询重写。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-2B0951D2-B40A-4A91-A0C3-2727B4E1C530">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-7多列IN列表选择</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写还会检查查询是否具有多列</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-list的情况，其中列与</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">化视图单列列表中的各列完全匹配</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果查询包含以下内容：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（prod_id，cust_id）IN（（1022,1000），（1033,2000））
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下内容：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE prod_id IN（1022,1033）AND cust_id IN（1000,2000）
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，物化视图</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表由查询多列列表中的列匹配</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，查询选择的右侧值包含在物化视图中，以便进行重写。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-9B9F38F2-1D15-4673-9AF3-860499AC9800">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-8使用IN列表进行选择</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择兼容性还会检查实例化视图是否具有多列</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-list的情况，其中列</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与查询中的-lists </font><font style="vertical-align: inherit;">的各列或列完全匹配</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果查询包含以下内容：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE prod_id = 1022 AND cust_id IN（1000,2000）
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下内容：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（prod_id，cust_id）IN（（1022,1000），（1022,2000））
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，物化视图列表</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列与查询选择中的列完全匹配。</font><font style="vertical-align: inherit;">此外，查询选择的右侧值包含在物化视图中。</font><font style="vertical-align: inherit;">所以重写成功。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-4408FEDB-09D9-4EA8-A5F0-A3ADE7FC6AE5__GUID-2ECFD81D-E65D-42D5-AD1E-AFFE0B80530E">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-9多个选择或表达式</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（city_population&gt; 15000 AND city_population &lt;25000 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   AND state_name ='新罕布什尔州'）</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含以下子句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE（city_population &lt;5000 AND state_name ='New York'）或 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （city_population BETWEEN 10000和50000 AND state_name ='New Hampshire'）</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，该查询被称为具有单个析取（由选择的组分隔</font></font><code class="codeph">AND</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并且物化视图具有由两个分隔的两个析取</font></font><code class="codeph">OR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">单个查询析取包含在第二个物化视图析取中，因此选择兼容性成功。</font><font style="vertical-align: inherit;">很明显，物化视图包含的查询数据多于查询所需的数据，因此可以重写查询。</font></font></p>
</div>
<!-- class="example" --></div>
</div>
<a id="DWHSG8526"></a>
<div class="props_rev_3"><a id="GUID-8B6C8FC5-BDEB-4FEB-878B-03CA337E48B8"></a>
<h4 id="DWHSG-GUID-8B6C8FC5-BDEB-4FEB-878B-03CA337E48B8" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于查询重写中HAVING子句的处理</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询为</font></font><code class="codeph">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">的聚合指定一系列值时，也可能发生查询重写</font><font style="vertical-align: inherit;">，例如</font></font><code class="codeph">SUM(s.amount_sold)</code> <code class="codeph">BETWEEN</code> <code class="codeph">10000</code> <code class="codeph">AND</code> <code class="codeph">20000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只要指定的范围在实例化视图中指定的范围内。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW product_sales_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
刷新力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_name，SUM（s.amount_sold）AS dollar_sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从产品p，销售s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用SUM（s.amount_sold）在5000和50000之间;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，可以重写以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_name，SUM（s.amount_sold）AS dollar_sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM products p，sales s WHERE p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用SUM（s.amount_sold）在10000和20000之间;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询将重写如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_name，mv.dollar_sales FROM product_sales_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mv.dollar_sales在10000和20000之间;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG8527"></a>
<div class="props_rev_3"><a id="GUID-191815BB-D689-4A2F-B1AD-32B88BC5CF44"></a>
<h4 id="DWHSG-GUID-191815BB-D689-4A2F-B1AD-32B88BC5CF44" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于实体化视图具有IN列表时的查询重写</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当物化视图包含</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-list </font><font style="vertical-align: inherit;">时，您可以使用查询重写</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，给定以下物化视图定义：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW popular_promo_sales_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
刷新力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.promo_name，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从促销p，销售s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.promo_id = p.promo_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND p.promo_name IN（'优惠券'，'高级'，'赠品'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY promo_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以重写以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.promo_name，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从促销p，销售s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.promo_id = p.promo_id AND p.promo_name IN（'coupon'，'premium'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.promo_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询将重写如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM popular_promo_sales_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里mv.promo_name IN（'coupon'，'premium'）;</font></font><font></font>
</pre></div>
</div>
</div>
<a id="DWHSG08026"></a>
<div class="props_rev_3"><a id="GUID-A32547B4-7E20-4EAB-B3B7-A7DBC1E5B4D8"></a>
<h3 id="DWHSG-GUID-A32547B4-7E20-4EAB-B3B7-A7DBC1E5B4D8" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区更改跟踪（PCT）重写</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT重写使优化器能够使用仅部分新鲜的物化视图准确地使用新数据重写查询。</font><font style="vertical-align: inherit;">为此，Oracle数据库会跟踪详细信息表中的哪些分区已更新。</font><font style="vertical-align: inherit;">然后，Oracle数据库跟踪实例化视图中的哪些行来自详细信息表中受影响的分区。</font><font style="vertical-align: inherit;">然后，优化器能够使用已知为新鲜的物化视图的那些部分。</font><font style="vertical-align: inherit;">您可以查看与新鲜的细节</font></font><code class="codeph">DBA_MVIEWS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">DBA_DETAIL_RELATIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">DBA_MVIEW_DETAIL_PARTITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意见。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">使用这些视图的示例，</font><font style="vertical-align: inherit;">请参阅</font></font><span class="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.oracle.com/database/121/DWHSG/refresh.htm#GUID-5B145F5C-C368-450D-8768-22D138A2ED39"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看分区新鲜度</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化器使用PCT重写</font></font><code class="codeph">QUERY_REWRITE_INTEGRITY = ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式。</font><font style="vertical-align: inherit;">优化程序在</font></font><code class="codeph">STALE_TOLERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式下</font><font style="vertical-align: inherit;">不使用PCT重写，</font><font style="vertical-align: inherit;">因为在该模式下不考虑数据新鲜度。</font><font style="vertical-align: inherit;">此外，要进行PCT重写，</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font><font style="vertical-align: inherit;">一个</font><font style="vertical-align: inherit;">条款。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用</font></font><a id="d39287e2488" class="indexterm-anchor"></a><a id="d39287e2490" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT使用分区重写，但不支持散列分区。</font><font style="vertical-align: inherit;">以下主题讨论了使用PCT的各个方面：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-4C807F5F-B382-406B-A9AE-4E480BD002C3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于范围分区表的PCT重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-DBF2A861-38DE-428F-8626-C158CB8D4DC8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于范围列表分区表的PCT重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-6E5FEC09-4F3B-477A-A106-02E86112F8F5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于列表分区表的PCT重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-DE6C1BA0-9FC5-416B-9743-F3F15BB45EBC"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT重写和PMARKER</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-2AC7AFAB-F76C-4B97-9C5D-0A401336E89F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT使用Rowid重写为PMARKER</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8528"></a>
<div class="props_rev_3"><a id="GUID-4C807F5F-B382-406B-A9AE-4E480BD002C3"></a>
<h4 id="DWHSG-GUID-4C807F5F-B382-406B-A9AE-4E480BD002C3" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于范围分区表的PCT重写</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例说明了PCT重写示例，其中物化视图通过分区键启用PCT，而基础基表在时间键上进行范围分区。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE part_sales_by_time（time_id，prod_id，amount_sold，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       quantity_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  按范围划分（time_id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION old_data</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值低于（7月1日（'01 -01-1999'，'DD-MM-YYYY'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      PCTFREE 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储（初始8M），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区第1季</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值不到（截止日期（'01 -04-1999'，'DD-MM-YYYY'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      PCTFREE 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储（初始8M），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区第2季</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值低于（7月12日（'01 -07-1999'，'DD-MM-YYYY'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      PCTFREE 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储（初始8M），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区第3季</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值低于（7月10日（'01 -10-1999'，'DD-MM-YYYY'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      PCTFREE 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储（初始8M），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    分区第四季</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值低于（7月1日（'01 -01-2000'，'DD-MM-YYYY'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      PCTFREE 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储（初始8M），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    PARTITION max_partition</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值低于（MAXVALUE）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      PCTFREE 0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      存储（初始8M）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  ）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  如</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT s.time_id，s.prod_id，s.amount_sold，s.quantity_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  来自销售;</font></font><font></font>
 <font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后创建一个物化视图，其中包含按日期销售的产品总数。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sales_in_1999_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  对需求的清醒力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  如</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT s.time_id，s.prod_id，p.prod_name，SUM（quantity_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM part_sales_by_time s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    AND s.time_id BETWEEN TO_DATE（'01 -01-1999'，'DD-MM-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    和到_DATE（'31 -12-1999'，'DD-MM-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUP BY s.time_id，s.prod_id，p.prod_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，以下查询将使用物化视图重写</font></font><code class="codeph">sales_in_1999_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.time_id，p.prod_name，SUM（quantity_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM part_sales_by_time s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    AND s.time_id &lt;TO_DATE（''01-02-1999''，''DD-MM-YYYY''）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    AND s.time_id&gt; = TO_DATE（''01-01-1999''，''DD-MM-YYYY''）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUP BY s.time_id，p.prod_name'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果添加了行</font></font><code class="codeph">quarter4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font></font><code class="codeph">part_sales_by_time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO part_sales_by_time </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  价值（去年12月（'26 -12-1999'，'DD-MM-YYYY'），38920,2500,20）;</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
承诺;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后物化视图</font></font><code class="codeph">sales_in_1999_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变得陈旧。</font><font style="vertical-align: inherit;">使用PCT重写，您可以重写仅从物化视图的新部分请求数据的查询。</font><font style="vertical-align: inherit;">请注意，因为物化视图</font></font><code class="codeph">sales_in_1999_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有其</font></font><code class="codeph">time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in </font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，所以它已启用PCT，因此以下查询将成功重写，因为没有</font></font><code class="codeph">quarter4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求</font><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.time_id，p.prod_name，SUM（quantity_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM part_sales_by_time s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND s.time_id &lt;TO_DATE（''01-07-1999''，''DD-MM-YYYY''）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND s.time_id&gt; = TO_DATE（''01-03-1999''，''DD-MM-YYYY''）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUP BY s.time_id，p.prod_name'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果将多个物化视图重写设置为关闭，则无法重写以下查询。</font><font style="vertical-align: inherit;">由于默认情况下启用了多个物化视图重写，因此使用物化视图和基表重写以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.time_id，p.prod_name，SUM（quantity_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM part_sales_by_time s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在哪里p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND s.time_id &lt;TO_DATE（''31-10-1999''，''DD-MM-YYYY''）和</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       s.time_id&gt; TO_DATE（''01-07-1999''，''DD-MM-YYYY''）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUP BY s.time_id，p.prod_name'）;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG8530"></a><a id="DWHSG8529"></a>
<div class="props_rev_3"><a id="GUID-DBF2A861-38DE-428F-8626-C158CB8D4DC8"></a>
<h4 id="DWHSG-GUID-DBF2A861-38DE-428F-8626-C158CB8D4DC8" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于范围列表分区表的PCT重写</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果详细信息表是范围列表分区，则依赖于此详细信息表的物化视图可以在分区和子分区级别支持PCT。</font><font style="vertical-align: inherit;">如果物化视图中存在分区和子分区键，则PCT可以以更精细的粒度完成; </font><font style="vertical-align: inherit;">物化视图刷新可以对物化视图的较小部分进行，并且可以使用陈旧的物化视图重写更多查询。</font><font style="vertical-align: inherit;">或者，如果在物化视图中仅存在分区键，则可以使用courser粒度来完成PCT。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下范围列表分区表：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE sales_par_range_list</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 （calendar_year，calendar_month_number，day_number_in_month，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  country_name，prod_id，prod_name，quantity_sold，amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按范围划分（calendar_month_number）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
按列表提交的子目录（country_name）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 （分数q1值小于（4）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 （提交q1_America VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 （'美利坚合众国'，'阿根廷'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   消费q1_Asia VALUES（'日本'，'印度'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SUBPARTITION q1_Europe VALUES（'France'，'Spain'，'Ireland'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   分区q2值小于（7）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （提交q2_America VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （'美利坚合众国'，'阿根廷'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   消费q2_Asia VALUES（'日本'，'印度'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   提升q2_Europe VALUES（'法国'，'西班牙'，'爱尔兰'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     分区q3值小于（10）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （提交q3_America VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （'美利坚合众国'，'阿根廷'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   消费q3_Asia VALUES（'日本'，'印度'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SUBPARTITION q3_Europe VALUES（'France'，'Spain'，'Ireland'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     分区q4值低于（13）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （提交q4_America VALUES</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （'美利坚合众国'，'阿根廷'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   消费q4_Asia VALUES（'日本'，'印度'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SUBPARTITION q4_Europe VALUES（'France'，'Spain'，'Ireland'）））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS SELECT t.calendar_year，t.calendar_month_number，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     t.day_number_in_month，c1.country_name，s.prod_id，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     p.prod_name，s.quantity_sold，s.amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  从时间t开始，国家c1，产品p，销售s，客户c2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE.time_id = t.time_id AND s.prod_id = p.prod_id AND</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        s.cust_id = c2.cust_id AND c2.country_id = c1.country_id AND</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        c1.country_name IN（'United States of America'，'Argentina'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
          '日本'，'印度'，'法国'，'西班牙'，'爱尔兰'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后考虑以下物化视图</font></font><code class="codeph">sum_sales_per_year_month_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含每年每月销售的产品总量：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_sales_per_year_month_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对需求的清醒力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT s.calendar_year，s.calendar_month_number，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_par_range_list s WHERE s.calendar_year&gt; 1990</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY s.calendar_year，s.calendar_month_number;</font></font><font></font>
</pre>
<p><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持针对PCT </font></font><code class="codeph">sales_par_range_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在作为其范围分区键范围划分级别</font></font><code class="codeph">calendar_month_number</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在其</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO sales_par_range_list</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   VALUES（2001,3,25，'Spain'，20，'PROD20'，300,20.50）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此语句使用</font></font><code class="codeph">calendar_month_number = 3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">插入一行</font></font><code class="codeph">country_name = 'Spain'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此行将插入分区</font></font><code class="codeph">q1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子分区</font></font><code class="codeph">Europe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在此</font></font><code class="codeph">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">之后</font></font><code class="codeph">sum_sales_per_year_month_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对于分区来说是陈旧</font></font><code class="codeph">q1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="codeph">sales_par_range_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，</font></font><code class="codeph">sales_par_range_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法重写</font><font style="vertical-align: inherit;">从此分区访问数据的任何传入查询，</font><font style="vertical-align: inherit;">例如，以下语句：</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，以下查询访问分区</font></font><code class="codeph">q1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和中的</font><font style="vertical-align: inherit;">数据</font></font><code class="codeph">q2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于q1已更新，因此物化视图相对于</font></font><code class="codeph">q1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT重写不可用</font><font style="vertical-align: inherit;">而过时</font><font style="vertical-align: inherit;">。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.calendar_year，SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sales_par_range_list s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里s.calendar_year = 2000 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND s.calendar_month_number BETWEEN 2和6</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY s.calendar_year;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在语句之后重写的</font></font><code class="codeph">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font><font style="vertical-align: inherit;">的示例</font><font style="vertical-align: inherit;">如下，因为它访问新材料：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.calendar_year，SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sales_par_range_list s</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.calendar_year = 2000 AND s.calendar_month_number BETWEEN 5和9</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY s.calendar_year;</font></font><font></font>
</pre>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-DBF2A861-38DE-428F-8626-C158CB8D4DC8__CHDFDGCC"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了陈旧和新鲜的图解说明。</font></font></p>
<div class="figure" id="GUID-DBF2A861-38DE-428F-8626-C158CB8D4DC8__CHDFDGCC">
<p class="titleinfigure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-3 PCT重写和范围列表分区</font></font></p>
<img width="618" height="321" src="./物化视图的高级查询重写_files/GUID-06E4E482-0C88-403C-BD76-824D35BDF23F-default.gif" alt="下面是图11-3的描述" title="下面是图11-3的描述"><br>
<a href="https://docs.oracle.com/database/121/DWHSG/img_text/GUID-06E4E482-0C88-403C-BD76-824D35BDF23F-print.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图11-3 PCT重写和范围列表分区”的说明</font></font></a></div>
<!-- class="figure" --></div>
</div>
<a id="DWHSG8532"></a><a id="DWHSG8531"></a>
<div class="props_rev_3"><a id="GUID-6E5FEC09-4F3B-477A-A106-02E86112F8F5"></a>
<h4 id="DWHSG-GUID-6E5FEC09-4F3B-477A-A106-02E86112F8F5" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于列表分区表的PCT重写</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code class="codeph">LIST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区键出现在物化视图的</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么PCT将被物化视图的支持。</font><font style="vertical-align: inherit;">无论支持的分区类型如何，如果详细信息表的分区标记或rowid存在于实例化视图中，则PCT将由该特定详细信息表上的实例化视图支持。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE sales_par_list</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（calendar_year，calendar_month_number，day_number_in_month，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 country_name，prod_id，quantity_sold，amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 按列表分区（country_name）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 （PARTITION America</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      VALUES（'美利坚合众国'，'阿根廷'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  分区亚洲</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      VALUES（'日本'，'印度'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  分区欧洲</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值观（'法国'，'西班牙'，'爱尔兰'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AS SELECT t.calendar_year，t.calendar_month_number， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         t.day_number_in_month，c1.country_name，s.prod_id， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         s.quantity_sold，s.amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  从时间t开始，国家c1，销售s，客户c2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE.time_id = t.time_id和s.cust_id = c2.cust_id和 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        c2.country_id = c1.country_id和</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
        c1.country_name IN（'United States of America'，'Argentina'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       '日本'，'印度'，'法国'，'西班牙'，'爱尔兰'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果在</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有列表分区键</font><font style="vertical-align: inherit;">的表上创建物化视图</font><font style="vertical-align: inherit;">，PCT重写将使用该物化视图进行潜在的重写。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了说明此功能，以下示例创建一个物化视图，其中包含每个国家/地区每个产品的销售总量。</font><font style="vertical-align: inherit;">视图取决于详细信息表</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sales_per_country_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对需求的清醒力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT s.calendar_year AS calendar_year，s.country_name AS country_name，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 p.prod_name AS prod_name，SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sales_par_list s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.calendar_year &lt;= 2000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY s.calendar_year，s.country_name，prod_name;</font></font><font></font>
</pre>
<p><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持对PCT </font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其列表分区键</font></font><code class="codeph">country_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表。</font><font style="vertical-align: inherit;">表</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未分区，因此</font></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持PCT对此表。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果传入查询仅访问物化视图的新部分，则</font><font style="vertical-align: inherit;">即使</font><font style="vertical-align: inherit;">过时，</font><font style="vertical-align: inherit;">也可以重写（在</font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式中）</font><font style="vertical-align: inherit;">查询。</font><font style="vertical-align: inherit;">只有</font><font style="vertical-align: inherit;">在物化视图中</font><font style="vertical-align: inherit;">更新的表已启用PCT时，</font><font style="vertical-align: inherit;">才能确定物化视图的哪些部分</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果已更新非PCT启用表，则无法使用该特定物化视图中的新数据进行重写，因为您无法识别</font><font style="vertical-align: inherit;">物化视图的</font><font style="vertical-align: inherit;">各个</font><font style="vertical-align: inherit;">部分。</font></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"></font></p>
<p><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在表产品</font><font style="vertical-align: inherit;">上支持PCT </font><font style="vertical-align: inherit;">并且不支持PCT。</font><font style="vertical-align: inherit;">如果</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新了</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">，则无法进行PCT重写，</font></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为您无法分辨物化视图的哪些部分</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下更新</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INSERT INTO sales_par_list VALUES（2000,10,22，'France'，900,20,200.99）;
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此语句在表中的分区Europe中插入一行</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在</font></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是陈旧的，但PCT重写（in </font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modes）是可能的，因为这个物化视图支持PCT对表</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">物化视图的新鲜和陈旧区域基于分区详细信息表进行标识</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-6E5FEC09-4F3B-477A-A106-02E86112F8F5__i1015969"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明了此示例中的新鲜内容和过时内容。</font></font></p>
<div class="figure" id="GUID-6E5FEC09-4F3B-477A-A106-02E86112F8F5__i1015969">
<p class="titleinfigure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-4 PCT重写和列表分区</font></font></p>
<img width="448" height="297" src="./物化视图的高级查询重写_files/GUID-1713D2A4-B204-4C78-8979-167E72DA6964-default.gif" alt="下面是图11-4的描述" title="下面是图11-4的描述"><br>
<a href="https://docs.oracle.com/database/121/DWHSG/img_text/GUID-1713D2A4-B204-4C78-8979-167E72DA6964-print.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图11-4 PCT重写和列表分区”的说明</font></font></a></div>
<!-- class="figure" -->
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.country_name，p.prod_name，SUM（s.amount_sold）AS sum_sales， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sales_par_list s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.calendar_year = 2000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND s.country_name IN（'美利坚合众国'，'日本'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY s.country_name，p.prod_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询访问分区</font></font><code class="codeph">America</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="codeph">Asia</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">这些分区尚未更新，因此可以使用陈旧的物化视图进行重写，</font></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为此查询只能访问</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图的部分内容。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将按以下</font><font style="vertical-align: inherit;">方式重写</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT country_name，prod_name，SUM（sum_sales）AS sum_slaes，SUM（cnt）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_per_country_mv WHERE calendar_year = 2000 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND country_name IN（'美利坚合众国'，'日本'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY country_name，prod_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.country_name，p.prod_name，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sales_par_list s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.calendar_year = 1999</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND s.country_name IN（'日本'，'印度'，'西班牙'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY s.country_name，p.prod_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询访问的分区</font></font><code class="codeph">Europe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="codeph">Asia</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">分区</font></font><code class="codeph">Europe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已更新，因此无法重写此查询，</font></font><code class="codeph">sales_per_country_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为物化视图中所需的数据已过时。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果传入的查询访问实体</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">化视图的某些部分，</font><font style="vertical-align: inherit;">您将能够在任何类型的更新</font><font style="vertical-align: inherit;">（即DML，直接加载和分区维护操作（PMOP））</font><font style="vertical-align: inherit;">之后重写</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG8534"></a><a id="DWHSG8533"></a>
<div class="props_rev_3"><a id="GUID-DE6C1BA0-9FC5-416B-9743-F3F15BB45EBC"></a>
<h4 id="DWHSG-GUID-DE6C1BA0-9FC5-416B-9743-F3F15BB45EBC" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT重写和PMARKER</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHE</font></font><a id="d39287e2944" class="indexterm-anchor"></a><a id="d39287e2948" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了na分区标记，查询重写功能仅限于重写访问整个详细信息表分区的查询，因为来自特定分区的所有行具有相同的pmarker值。</font><font style="vertical-align: inherit;">也就是说，如果查询访问详细信息表分区的一部分，则即使该数据对应于</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">一部分</font><font style="vertical-align: inherit;">，也不会重写该查询</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，物化视图的部分由pmarker值确定。</font><font style="vertical-align: inherit;">要确定物化视图的哪些行是新鲜的，请将新鲜度与标记值相关联，因此具有特定pmarker值的物化视图中的所有行都是</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者是</font></font><code class="codeph">STALE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下创建物化视图，其中包含每年每个详细信息表分区中每个产品的总销售量</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此物化视图还将依赖于详细信息表</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sales_per_dt_partition_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对需求的清醒力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT s.calendar_year AS calendar_year，p.prod_name AS prod_name，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       DBMS_MVIEW.PMARKER（s.rowid）pmarker，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sales_par_list s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.calendar_year&gt; 2000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY s.calendar_year，DBMS_MVIEW.PMARKER（s.rowid），p.prod_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font></font><code class="codeph">sales_per_dt_partition_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供每个明细表分区的销售总和。</font><font style="vertical-align: inherit;">此物化视图支持针对表PCT重写</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为分区标记是在其</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款。</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-DE6C1BA0-9FC5-416B-9743-F3F15BB45EBC__g1021737" title="分区名称及其Pmarkers"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表11-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出了此示例的分区名称及其标记。</font></font></p>
<div class="tblformal" id="GUID-DE6C1BA0-9FC5-416B-9743-F3F15BB45EBC__g1021737">
<p class="titleintable"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表11-2分区名称及其Pmarkers</font></font></p>
<table class="cellalignment1516" title="分区名称及其Pmarkers" summary="Partition Names and Their Pmarkers">
<thead>
<tr class="cellalignment1507">
<th class="cellalignment1552" id="d39287e3008"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分区名称</font></font></th>
<th class="cellalignment1553" id="d39287e3011"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pmarker</font></font></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1507">
<td class="cellalignment1554" id="d39287e3016" headers="d39287e3008">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">美国</font></font></p>
</td>
<td class="cellalignment1555" headers="d39287e3016 d39287e3011">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1000</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1554" id="d39287e3023" headers="d39287e3008">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">亚洲</font></font></p>
</td>
<td class="cellalignment1555" headers="d39287e3023 d39287e3011">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1001</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1554" id="d39287e3030" headers="d39287e3008">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欧洲</font></font></p>
</td>
<td class="cellalignment1555" headers="d39287e3030 d39287e3011">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1002</font></font></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按如下方式</font><font style="vertical-align: inherit;">更新表</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DELETE FROM sales_par_list WHERE country_name ='India';
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您已从</font></font><code class="codeph">Asia</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">分区</font><font style="vertical-align: inherit;">中</font><font style="vertical-align: inherit;">删除了行</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在</font></font><code class="codeph">sales_per_dt_partition_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是陈旧的，但PCT重写（in </font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modes）是可能的，因为这个物化视图支持PCT（基于pmarker）对表</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_name，SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sales_par_list s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.calendar_year = 2001 AND</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       s.country_name IN（'美利坚合众国'，'阿根廷'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以根据</font></font><code class="codeph">sales_per_dt_partition_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问对应于详细信息表分区的所有数据</font><font style="vertical-align: inherit;">来重写该查询</font><font style="vertical-align: inherit;">，并且物化视图是</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于该数据的。</font><font style="vertical-align: inherit;">此查询访问分区中</font></font><code class="codeph">America</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尚未更新的</font><font style="vertical-align: inherit;">所有数据</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font></font><code class="codeph">sales_per_dt_partition_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将按以下</font><font style="vertical-align: inherit;">方式重写</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_name，SUM（sum_sales）AS sum_sales，SUM（cnt）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_per_dt_partition_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE calendar_year = 2001 AND pmarker = 1000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_name;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG8535"></a>
<div class="props_rev_3"><a id="GUID-2AC7AFAB-F76C-4B97-9C5D-0A401336E89F"></a>
<h4 id="DWHSG-GUID-2AC7AFAB-F76C-4B97-9C5D-0A401336E89F" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PCT使用Rowid重写为PMARKER</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图支持PCT重写提供的分区键或分区标记其在提供</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款，如果有一个</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句。</font><font style="vertical-align: inherit;">您可以使用分区表的rowid而不是pmarker或分区键。</font><font style="vertical-align: inherit;">请注意，Oracle会在内部将rowid转换为pmarkers。</font><font style="vertical-align: inherit;">请考虑下表：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE product_par_list</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（prod_id，prod_name，prod_category，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 prod_subcategory，prod_list_price）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 按列表划分（prod_category）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 （PARTITION prod_cat1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      VALUES（'男孩'，'男'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PARTITION prod_cat2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      价值观（'女孩'，'女'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 如</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SELECT prod_id，prod_name，prod_category， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      prod_subcategory，prod_list_price</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   来自产品;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们在表上创建以下物化视图，</font></font><code class="codeph">sales_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font><code class="codeph">product_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_sales_per_category_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
对需求的清醒力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.rowid prid，p.prod_category， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）sum_sales，COUNT（*）cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_par_list s，product_par_list p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id和s.calendar_year &lt;= 2000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.rowid，p.prod_category;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于pmarker重写的所有限制也适用于此处。</font><font style="vertical-align: inherit;">传入的查询应该访问整个分区以便重写查询。</font><font style="vertical-align: inherit;">在这种情况下使用以下pmarker表：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">product_par_list pmarker值</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
---------------- -------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
prod_cat1 1000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
prod_cat2 1001</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
prod_cat3 1002</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后更新表</font></font><code class="codeph">product_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DELETE FROM product_par_list WHERE prod_name ='MEN';
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所以</font></font><code class="codeph">sum_sales_per_category_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是陈旧相对于分区</font></font><code class="codeph">prod_list1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="codeph">product_par_list</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，SUM（s.amount_sold）AS sum_sales，COUNT（*）AS cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_par_list s，product_par_list p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.prod_id = p.prod_id AND p.prod_category IN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       （'女孩'，'女'）和s.calendar_year &lt;= 2000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以根据</font></font><code class="codeph">sum_sales_per_category_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问对应于详细信息表分区的所有数据</font><font style="vertical-align: inherit;">来重写该查询</font><font style="vertical-align: inherit;">，并且物化视图是</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于该数据的。</font><font style="vertical-align: inherit;">此查询访问分区中</font></font><code class="codeph">prod_cat2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尚未更新的</font><font style="vertical-align: inherit;">所有数据</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下是重写的查询</font></font><code class="codeph">sum_sales_per_category_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_category，sum_sales，cnt</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sum_sales_per_category_mv WHERE DBMS_MVIEW.PMARKER（srid）IN（1000）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_category;</font></font><font></font>
</pre></div>
</div>
</div>
<a id="DWHSG8536"></a><a id="DWHSG8537"></a><a id="DWHSG8538"></a><a id="DWHSG8539"></a><a id="DWHSG8540"></a><a id="DWHSG8541"></a><a id="DWHSG8542"></a><a id="DWHSG8543"></a><a id="DWHSG8544"></a><a id="DWHSG8545"></a><a id="DWHSG08027"></a>
<div class="props_rev_3"><a id="GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08"></a>
<h3 id="DWHSG-GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用多个物化视图重写查询</font></font></h3>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阙</font></font><a id="d39287e3213" class="indexterm-anchor"></a><a id="d39287e3217" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ry rewrite已经扩展，可以使用多个物化视图重写查询。</font><font style="vertical-align: inherit;">如果查询重写确定没有返回所有数据的实例化视图集，则查询重写将从基表中检索剩余数据。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用多个物化视图的查询重写可以利用许多不同类型和重写的组合，例如使用PCT和</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表。</font><font style="vertical-align: inherit;">以下示例说明了现在可以进行查询重写的一些查询。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑以下两个物化视图，</font></font><code class="codeph">cust_avg_credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="codeph">cust_avg_credit_mv2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="codeph">cust_avg_credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问所有客户在1940年至1950年之间出生的每个邮政编码的平均信用额度。</font></font><code class="codeph">cust_avg_credit_mv2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问客户在1950年之后以及1970年之前或之后出生的每个邮政编码的平均信用额度。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图对此示例的定义如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW cust_avg_credit_mv1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_postal_code，cust_year_of_birth， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（cust_credit_limit）AS sum_credit，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       COUNT（cust_credit_limit）AS count_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在1940年和1950年之间的cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_postal_code，cust_year_of_birth;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW cust_avg_credit_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_postal_code，cust_year_of_birth，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（cust_credit_limit）AS sum_credit， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       COUNT（cust_credit_limit）AS count_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_year_of_birth&gt; 1950和cust_year_of_birth &lt;= 1970</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_postal_code，cust_year_of_birth;</font></font><font></font>
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询1：物化视图和查询中的一个匹配间隔</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑一个查询，询问所有客户在1940年至1970年之间出生的每个邮政编码的平均信用额度。此查询与间隔</font></font><code class="codeph">BETWEEN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开启</font><font style="vertical-align: inherit;">匹配</font></font><code class="codeph">cust_year_of_birth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_postal_code，AVG（cust_credit_limit）AS avg_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在1940年和1970年之间的cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_postal_code;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以根据这两个物化视图重写上述查询，以获得如下所有数据：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT v1.cust_postal_code， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SUM（v1.sum_credit）/ SUM（v1.count_credit）AS avg_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM（SELECT cust_postal_code，sum_credit，count_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 FROM </font></font><span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cust_avg_credit_mv1</font></font></span> <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 GROUP BY cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 SELECT cust_postal_code，sum_credit，count_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 FROM </font></font><span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cust_avg_credit_mv2</font></font></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 GROUP BY cust_postal_code）v1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 GROUP BY v1.cust_postal_code;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于需要进行重新聚合</font><font style="vertical-align: inherit;">，因此</font><font style="vertical-align: inherit;">查询将在内联视图中使用。</font><font style="vertical-align: inherit;">另请注意查询重写是计数聚合如何执行此汇总。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询2：在物化视图中包含的数据之外查询</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当物化视图超出查询所要求的范围时，会在重写的查询中添加一个过滤器（也称为选择），以删除物化视图返回的不需要的行。</font><font style="vertical-align: inherit;">以下查询说明了这种情况：</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_postal_code，SUM（cust_credit_limit）AS sum_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在1945年和1955年之间的cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_postal_code;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询2被重写为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT v1.cust_postal_code，SUM（v1.sum_credit）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（SELECT cust_postal_code，SUM（sum_credit）AS sum_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_avg_credit_mv1 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在1945年和1950年之间的cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_postal_code，SUM（sum_credit）AS sum_credit</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自cust_birth_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_year_of_birth&gt; 1950和cust_year_of_birth &lt;= 1955</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_postal_code）v1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY v1.cust_postal_code;</font></font><font></font>
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询3：请求比物化视图中的数据更多的数据</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询要求的数据多于两个物化视图中包含的数据，该怎么办？</font><font style="vertical-align: inherit;">它仍然使用物化视图和基表中的数据重写。</font><font style="vertical-align: inherit;">在以下示例中，定义了一组没有聚合的新物化视图。它仍将使用物化视图和基表中的数据进行重写。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW cust_birth_mv1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_last_name，cust_first_name，cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户WHERE cust_year_of_birth介于1940年和1950年之间;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW cust_avg_credit_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_last_name，cust_first_name，cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_year_of_birth&gt; 1950和cust_year_of_birth &lt;= 1970;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的查询现在要求所有在1940年至1990年之间出生的客户。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c其中cust_year_of_birth介于1940年和1990年之间;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写需要访问基表以访问1970年以后以及1990年之前或之后出生的客户。因此，查询3被重写为以下内容：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自cust_birth_mv1 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自cust_birth_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_year_of_birth&gt; 1970 AND cust_year_of_birth &lt;= 1990;</font></font><font></font>
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询4：在多个选择列上请求数据</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下查询，该查询要求所有信用额度介于1,000和10,000之间且出生于1945年至1960年之间的客户。此查询是多选查询，因为它要求多个选择列上的数据。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户WHERE cust_year_of_birth介于1945年和1960年之间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   cust_credit_limit BETWEEN 1000和10000;</font></font><font></font>
</pre>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08__BABJABEH"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-5</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示了一个双选查询，可以使用下一节中描述的双选实体化视图重写。</font></font></p>
<div class="figure" id="GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08__BABJABEH">
<p class="titleinfigure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-5使用多个物化视图重写查询</font></font></p>
<img width="351" height="285" src="./物化视图的高级查询重写_files/GUID-091F02EB-6551-4B0F-AD6A-B9CE600F82E2-default.gif" alt="下面是图11-5的描述" title="下面是图11-5的描述"><br>
<a href="https://docs.oracle.com/database/121/DWHSG/img_text/GUID-091F02EB-6551-4B0F-AD6A-B9CE600F82E2-print.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图11-5使用多个物化视图重写查询”的说明</font></font></a></div>
<!-- class="figure" -->
<p><font style="vertical-align: inherit;"></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08__BABJABEH"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-5中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的图表</font><font style="vertical-align: inherit;">说明了可用于满足此查询的物化视图。</font></font><code class="codeph">credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求信用额度在1,000到5,000之间且出生于1945年至1950年之间</font></font><code class="codeph">credit_mv2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的客户</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要求信用额度&gt; 5,000且&lt;= 10,000且出生于1945年至1960年之间</font></font><code class="codeph">credit_mv3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的客户</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">要求信用额度在1,000和之间的客户5,000并且在1950年之后以及1955年之前或之后出生。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图对此案例的定义如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW credit_mv1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_last_name，cust_first_name， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    cust_credit_limit，cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_credit_limit介于1000和5000之间 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和cust_year_of_birth在1945年和1950年之间;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW credit_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_last_name，cust_first_name， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   cust_credit_limit，cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE cust_credit_limit&gt; 5000 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   AND cust_credit_limit &lt;= 10000 AND cust_year_of_birth </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   在1945年和1960年之间;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW credit_mv3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   cust_credit_limit，cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_credit_limit介于1000和5000之间 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND cust_year_of_birth&gt; 1950 AND cust_year_of_birth &lt;= 1955;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用所有三个物化视图来重写查询4以访问大多数数据。</font><font style="vertical-align: inherit;">但是，由于并非所有数据都可以从这三个物化视图中获取，因此查询重写还可以访问基表，以便为信用限额在1,000到5,000之间且出生于1955年到1960年之间的客户检索数据。它被重写如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自credit_mv1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自credit_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自credit_mv3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_credit_limit介于1000和5000之间 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND cust_year_of_birth&gt; 1955 AND cust_year_of_birth &lt;= 1960;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例说明了如何使用多个物化视图重写多选查询。</font><font style="vertical-align: inherit;">简化示例以显示三个物化视图之间没有重叠数据。</font><font style="vertical-align: inherit;">但是，查询重写可以执行类似的重写。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询5：间隔和约束间隔</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例说明如何使用单个选择实体化视图重写多选查询。</font><font style="vertical-align: inherit;">在此示例中，查询中有两个间隔，物化视图中有一个约束间隔。</font><font style="vertical-align: inherit;">它要求信用额度在1,000到10,000之间并且在1945年到1960年之间出生的</font></font><code class="codeph">credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户</font><font style="vertical-align: inherit;">。但是假设</font><font style="vertical-align: inherit;">要求信用额度在1,000到5,000之间的客户。</font></font><code class="codeph">credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不受选择约束</font></font><code class="codeph">cust_year_of_birth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此覆盖查询的整个出生年份值范围。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<div class="figure" id="GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08__BABCIEFD">
<p class="titleinfigure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-6约束的物化视图选择</font></font></p>
<img width="242" height="282" src="./物化视图的高级查询重写_files/GUID-0435D5DB-F306-4416-A8BA-35A7CC3DB03B-default.gif" alt="下面是图11-6的描述" title="下面是图11-6的描述"><br>
<a href="https://docs.oracle.com/database/121/DWHSG/img_text/GUID-0435D5DB-F306-4416-A8BA-35A7CC3DB03B-print.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图11-6约束物化视图选择”的说明</font></font></a></div>
<!-- class="figure" -->
<p><font style="vertical-align: inherit;"></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08__BABCIEFD"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-6中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的线之间的区域</font><font style="vertical-align: inherit;">表示数据</font></font><code class="codeph">credit1_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新</font></font><code class="codeph">credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的定义如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW credit_mv1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_last_name，cust_first_name， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   cust_credit_limit，cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户WHERE cust_credit_limit BETWEEN 1000和5000;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户WHERE cust_year_of_birth介于1945年和1960年之间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND cust_credit_limit BETWEEN 1000和10000;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后重写的查询如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM credit_mv1在1945年和1960年之间的cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户WHERE cust_year_of_brith介于1945年和1960年之间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND cust_credit_limit&gt; 5000 AND cust_credit_limit &lt;= 10000;</font></font><font></font>
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询6：查询具有单列IN列表，物化视图具有单列间隔</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个物化视图查询重写可以处理</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传入查询</font><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">-list，并根据在同一选择列上具有间隔的物化视图重写查询。</font><font style="vertical-align: inherit;">假定</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-list表示间隔中的离散值，则此重写功能是前面描述的仅间隔场景的自然扩展。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中的一列列表选择和物化视图中的一个列间隔选择</font><font style="vertical-align: inherit;">的示例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">考虑一个查询，询问下一年出生的每个国家的客户数量：1945年，1950年，1955年，1960年，1965年，1970年或1975年。此查询受</font></font><code class="codeph">IN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-list on </font><font style="vertical-align: inherit;">约束</font></font><code class="codeph">cust_year_of_birth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c2.country_name，count（c1.country_id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c1，国家c2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE c1.country_id = c2.country_id AND </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   c1.cust_year_of_birth IN（1945,1950,1955,1960,1965,1970,1975）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY c2.country_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下两个物化视图。</font></font><code class="codeph">cust_country_birth_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问1940年至1950年之间出生的每个国家的客户数量。</font></font><code class="codeph">cust_country_birth_mv2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问1950年之后以及1970年之前或之后出生的每个国家的客户数量。前面的查询可以用这两个来重写物化视图，以获得1945年，1950年，1955年，1960年，1965年和1970年出生的每个国家的客户总数。需要基准表访问才能获得1975年出生的客户数量。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图对此示例的定义如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW cust_country_birth_mv1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT c2.country_name，c1.cust_year_of_birth，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 COUNT（c1.country_id）AS count_customers</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c1，国家c2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE c1.country_id = c2.country_id AND </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      cust_year_of_birth介于1940年和1950年之间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY c2.country_name，c1.cust_year_of_birth;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW cust_country_birth_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT c2.country_name，c1.cust_year_of_birth， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 COUNT（c1.country_id）AS count_customers</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c1，国家c2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE c1.country_id = c2.country_id AND cust_year_of_birth&gt; 1950 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND cust_year_of_birth &lt;= 1970</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY c2.country_name，c1.cust_year_of_birth;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，查询6被重写为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT v1.country_name，SUM（v1.count_customers）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM（SELECT country_name，SUM（count_customers）AS count_customers</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_country_birth_mv1 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_year_of_birth IN（1945,1950）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY country_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT country_name，SUM（count_customers）AS count_customers</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_country_birth_mv2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_year_of_birth IN（1955,1960,1965,1970）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY country_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c2.country_name，COUNT（c1.country_id）AS count_customers</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c1，国家c2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE c1.country_id = c2.country_id AND cust_year_of_birth IN（1975）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY c2.country_name）v1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY v1.country_name;</font></font><font></font>
</pre></div>
<!-- class="section" -->
<div class="section">
<p class="subhead3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询7：使用多个物化视图重写PCT</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用多个物化视图重写也可以利用PCT重写。</font><font style="vertical-align: inherit;">PCT重写是指在物化视图过时时仅使用物化视图的新鲜部分重写查询的功能。</font><font style="vertical-align: inherit;">此功能用于</font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整性模式，并且通过多个物化视图重写，它可以使用物化视图的新鲜部分从中获取新数据，并转到基表以获取过时数据。</font><font style="vertical-align: inherit;">所以重写的查询会</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅来自一个或多个物化视图的新数据，并从基表中获取其余数据以回答查询。</font><font style="vertical-align: inherit;">因此，所有PCT规则和条件也适用于此。</font><font style="vertical-align: inherit;">物化视图应该是PCT启用的，并且对基表的更改应该能够清楚地识别物化视图的新鲜和陈旧部分。</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例假设您有一个查询，要求信用额度介于1,000和10,000之间且出生于1945年至1964年之间的客户。此外，客户表格被分区，</font></font><code class="codeph">cust_date_of_birth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且有一个启用PCT的物化视图</font></font><code class="codeph">credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，也会询问客户信用额度在1,000到10,000之间，出生于1945年至1964年之间。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户WHERE cust_credit_limit BETWEEN 1000和10000;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08__BABEFEFH"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中，图说明了物化视图是新鲜（暗）和陈旧（光）的那些区域相对于所述底座表分区</font></font><code class="codeph">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code class="codeph">p6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="figure" id="GUID-CECD1B60-A092-4AA7-AE32-B2DD97EBDD08__BABEFEFH">
<p class="titleinfigure"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图11-7 PCT和多个物化视图重写</font></font></p>
<img width="341" height="282" src="./物化视图的高级查询重写_files/GUID-939657F2-699B-4EED-8A9F-53A4EA9CEEEB-default.gif" alt="下面是图11-7的描述" title="下面是图11-7的描述"><br>
<a href="https://docs.oracle.com/database/121/DWHSG/img_text/GUID-939657F2-699B-4EED-8A9F-53A4EA9CEEEB-print.htm"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“图11-7 PCT和多个物化视图重写”的描述</font></font></a></div>
<!-- class="figure" -->
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们说，你是在</font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式，并且</font></font><code class="codeph">p1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">p2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">p3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">p5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="codeph">p6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户表的是新鲜和分区</font></font><code class="codeph">p4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是陈旧的。</font><font style="vertical-align: inherit;">这意味着所有分区</font></font><code class="codeph">credit_mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都不能用于回答查询。</font><font style="vertical-align: inherit;">重写的查询必须</font></font><code class="codeph">p4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从其他实体化视图</font><font style="vertical-align: inherit;">获取客户分区的结果，</font><font style="vertical-align: inherit;">或者如本例所示，从基表获取结果。</font><font style="vertical-align: inherit;">下面，您可以看到该表的部分表定义，该</font></font><code class="codeph">customers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表显示了表的分区方式：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE客户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（按范围划分（cust_year_of_birth）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 分区p1值不到（1945），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 分区p2值低于（1950）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 分区p3值不到（1955），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 分区p4价值低于（1960年），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 分区p5值不到（1965），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 分区p6的价值低于（1970年）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面示例的物化视图定义如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW credit_mv1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT cust_last_name，cust_first_name， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   cust_credit_limit，cust_year_of_birth</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_credit_limit介于1000和10000之间 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和cust_year_of_birth在1945年和1964年之间;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，此实例化视图是针对表格启用PCT的</font></font><code class="codeph">customers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写的查询如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_last_name，cust_first_name FROM </font></font><span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">credit_mv1</font></font></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cust_credit_limit介于1000和10000之间</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （cust_year_of_birth&gt; = 1945 AND cust_year_of_birth &lt;1955 OR</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    cust_year_of_birth介于1945年和1964年之间）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_last_name，cust_first_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户WHERE cust_credit_limit BETWEEN 1000和10000 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND cust_year_of_birth &lt;1960 AND cust_year_of_birth&gt; = 1955;</font></font><font></font>
</pre></div>
<!-- class="section" --></div>
</div>
</div>
<a id="DWHSG0803"></a>
<div class="props_rev_3"><a id="GUID-96BFEEAA-1C8A-4F8A-9EAF-6CDD9B148EA6"></a>
<h2 id="DWHSG-GUID-96BFEEAA-1C8A-4F8A-9EAF-6CDD9B148EA6" class="sect2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他查询重写注意事项</font></font></h2>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下主题讨论了可以进行查询重写时的一些其他情况：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-515C1FF2-E32D-40A8-8138-CD31DFC85568"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用嵌套的物化视图重写查询</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-ED5B6A2D-BAF9-41BD-B075-008D8BD26AF3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于内联视图存在时的查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-6767990B-C315-4C89-BF67-1069DADC373C"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用远程表重写查询</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-52DB7F2B-6A39-43F9-9DA5-65892266D48D"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于在重复表存在的情况下重写查询</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-81BA0698-1E21-4301-B4DE-CD0E727213C6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用日期折叠重写查询</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用视图约束重写查询</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-F9ED3594-159E-451C-AABC-F74FB89B6C94"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用集合运算符物化视图查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-FF240F3F-2EF8-4D46-8FAE-2B6C57FBA749"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于在分组集存在下的查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-1BA3AB83-5155-47A5-90DA-1D8AEA8E8CC6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在窗口函数存在的情况下查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-E0B7B0AB-6D13-4AA4-BFCE-119B5834AAAF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写和表达式匹配</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5C3DD547-5E57-40CE-9AC9-770214718949"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写期间的游标共享和绑定变量</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-3FD90BE4-F577-4AB9-8762-2701C8B60193"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询重写中处理表达式</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG08031"></a>
<div class="props_rev_3"><a id="GUID-515C1FF2-E32D-40A8-8138-CD31DFC85568"></a>
<h3 id="DWHSG-GUID-515C1FF2-E32D-40A8-8138-CD31DFC85568" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用嵌套的物化视图重写查询</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问</font></font><a id="d39287e3627" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写尝试迭代利用嵌套的物化视图。</font><font style="vertical-align: inherit;">Oracle数据库首先尝试使用具有聚合和连接的实体化视图重写查询，然后使用仅包含连接的实体化视图。</font><font style="vertical-align: inherit;">如果任何重写成功，Oracle将再次重复该过程，直到找不到重写。</font><font style="vertical-align: inherit;">例如，假设您已创建物化视图</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">sum_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW join_sales_time_product_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_id，p.prod_name，t.time_id，t.week_ending_day，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       s.channel_id，s.promo_id，s.cust_id，s.amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW sum_sales_time_product_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT mv.prod_name，mv.week_ending_day，COUNT（*）cnt_all， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（mv.amount_sold）sum_amount_sold， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       COUNT（mv.amount_sold）cnt_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv.prod_name，mv.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_name，t.week_ending_day，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，product p，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_name，t.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle发现</font></font><code class="codeph">join_sales_time_product_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有资格进行重写。</font><font style="vertical-align: inherit;">重写的查询具有以下形式：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_name，mv.week_ending_day，SUM（mv.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM join_sales_time_product_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv.prod_name，mv.week_ending_day;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于发生了重写，Oracle再次尝试该过程。</font><font style="vertical-align: inherit;">这次，可以使用单表聚合物化视图将查询重写</font></font><code class="codeph">sum_sales_store_time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为以下形式：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_name，mv.week_ending_day，mv.sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sum_sales_time_product_mv mv;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG08032"></a>
<div class="props_rev_3"><a id="GUID-ED5B6A2D-BAF9-41BD-B075-008D8BD26AF3"></a>
<h3 id="DWHSG-GUID-ED5B6A2D-BAF9-41BD-B075-008D8BD26AF3" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于内联视图存在时的查询重写</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø</font></font><a id="d39287e3680" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">racle Database以两种方式支持使用内联视图进行查询重写：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当物化视图中的内联视图中的文本与请求查询中的文本完全匹配时</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当请求查询包含与实例化视图中的内联视图等效的内联视图时</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果两个内联视图的</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表和</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表是等效的，</font><font style="vertical-align: inherit;">则它们被认为</font><font style="vertical-align: inherit;">是等效的，</font></font><code class="codeph">FROM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句包含相同或等效的对象，它们的连接图，包括</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中的</font><font style="vertical-align: inherit;">所有选择</font><font style="vertical-align: inherit;">都是等效的，它们的</font></font><code class="codeph">HAVING</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句是等价的。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例说明了如何使用文本匹配和常规内联视图重写，使用内联视图的查询可以使用实例化视图进行重写。</font><font style="vertical-align: inherit;">请考虑以下包含内联视图的物化视图：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建物化视图SUM_SALES_MV</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT mv_iv.prod_id，mv_iv.cust_id，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sum（mv_iv.amount_sold）sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM（SELECT prod_id，cust_id，amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售，产品</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里sales.prod_id = products.prod_id）MV_IV</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY mv_iv.prod_id，mv_iv.cust_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下查询具有内联视图，其文本与实例化视图的内联视图的文本完全匹配。</font><font style="vertical-align: inherit;">因此，查询内联视图在内部被物化视图的内联视图替换，以便可以重写查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT iv.prod_id，iv.cust_id，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SUM（iv.amount_sold）sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM（SELECT prod_id，cust_id，amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售，产品</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里sales.prod_id = products.prod_id）四</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY iv.prod_id，iv.cust_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下查询的内联视图与前面的物化视图中的内联视图没有完全匹配的文本。</font><font style="vertical-align: inherit;">请注意，切换查询内联视图中的连接谓词。</font><font style="vertical-align: inherit;">即使此查询在文本上与实体化视图的内联视图的查询不匹配，查询重写也会将查询的内联视图标识为与实体化视图的内联视图等效。</font><font style="vertical-align: inherit;">和以前一样，查询内联视图将在内部替换为实体化视图的内联视图，以便可以重写查询。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT iv.prod_id，iv.cust_id，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SUM（iv.amount_sold）sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM（SELECT prod_id，cust_id，amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售，产品</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
产品.prod_id = sales.prod_id）四</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY iv.prod_id，iv.cust_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这两个查询都重写</font></font><code class="codeph">SUM_SALES_MV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_id，cust_id，sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM SUM_SALES_MV;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于包含set运算符，</font></font><code class="codeph">GROUPING</code> <code class="codeph">SET</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，嵌套子查询，嵌套内联视图和远程表的</font><font style="vertical-align: inherit;">查询，不支持常规内联视图重写</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG00323"></a>
<div class="props_rev_3"><a id="GUID-6767990B-C315-4C89-BF67-1069DADC373C"></a>
<h3 id="DWHSG-GUID-6767990B-C315-4C89-BF67-1069DADC373C" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用远程表重写查询</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库支持使用在单个远程数据库站点引用表的物化视图进行查询重写。</font><font style="vertical-align: inherit;">请注意，实例化视图应出现在发出查询的站点上。</font><font style="vertical-align: inherit;">由于任何远程表更新都无法同时传播到本地站点，因此查询重写仅适用于该</font></font><code class="codeph">stale_tolerated</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式。</font><font style="vertical-align: inherit;">只要查询包含在实例化视图中找不到的列，它就会使用一种名为join back的技术来重写查询。</font><font style="vertical-align: inherit;">但是，如果在本地站点上找不到联接回表，则不会进行查询重写。</font><font style="vertical-align: inherit;">此外，由于远程站点的约束信息在远程站点不可用，因此查询重写不会使用任何约束信息。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下查询包含在单个远程站点上找到的表：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_id，t.week_ending_day，s.cust_id，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales @ remotedbl s，products @ remotedbl p，times @ remotedbl t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_id，t.week_ending_day，s.cust_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下物化视图存在于本地站点，但它引用了在远程站点上找到的表：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_sales_prod_week_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_id，t.week_ending_day，s.cust_id，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales @ remotedbl s，products @ remotedbl p，times @ remotedbl t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_id，t.week_ending_day，s.cust_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使查询引用了远程表，也会使用以前的物化视图重写它，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_id，week_ending_day，cust_id，sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sum_sales_prod_week_mv;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG08034"></a>
<div class="props_rev_3"><a id="GUID-52DB7F2B-6A39-43F9-9DA5-65892266D48D"></a>
<h3 id="DWHSG-GUID-52DB7F2B-6A39-43F9-9DA5-65892266D48D" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于在重复表存在的情况下重写查询</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库 </font></font><a id="d39287e3801" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成查询重写包含对同一个表的多个引用的查询，或通过采用两种不同的策略进行自联接。</font><font style="vertical-align: inherit;">使用第一个策略，您需要确保查询和物化视图定义对表的多个引用具有相同的别名。</font><font style="vertical-align: inherit;">如果您不提供匹配的别名，Oracle会尝试第二种策略，其中比较查询和物化视图中的联接，以将查询中的多个引用与实例化视图中的多个引用相匹配。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是物化视图和查询的示例。</font><font style="vertical-align: inherit;">在此示例中，查询缺少对表中列的引用，因此精确的文本匹配不起作用。</font><font style="vertical-align: inherit;">但是，可以进行常规查询重写，因为表引用的别名匹配。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示</font></font><code class="codeph">sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">样本模式</font><font style="vertical-align: inherit;">的自联接重写可能性，</font><font style="vertical-align: inherit;">假设以下添加内容包括事实表中的实际发货和付款日期，引用相同的维度表时间。</font><font style="vertical-align: inherit;">这仅用于演示目的，不会返回任何结果：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE销售额ADD（time_id_ship DATE）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE sales ADD（CONSTRAINT time_id_book_fk FOREIGN key（time_id_ship）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REFERENCES次数（time_id）ENABLE NOVALIDATE）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE销售MODIFY CONSTRAINT time_id_book_fk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE销售额ADD（time_id_paid DATE）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE sales ADD（CONSTRAINT time_id_paid_fk FOREIGN KEY（time_id_paid）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REFERENCES次数（time_id）ENABLE NOVALIDATE）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE销售MODIFY CONSTRAINT time_id_paid_fk RELY;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，您可以按如下方式定义物化视图：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sales_shipping_lag_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT t1.fiscal_week_number，s.prod_id，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         t2.fiscal_week_number  -  t1.fiscal_week_number AS滞后</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从时间t1开始，销售额s，时间t2 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里t1.time_id = s.time_id AND t2.time_id = s.time_id_ship;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下查询未通过完全文本匹配测试但由于表引用的别名匹配而被重写：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.prod_id，t2.fiscal_week_number  -  t1.fiscal_week_number AS lag</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从时间t1开始，销售额s，时间t2 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里t1.time_id = s.time_id AND t2.time_id = s.time_id_ship;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，Oracle数据库执行其他检查以确保请求查询中的乘法实例表的实例与实例化视图中的相应表实例的正确匹配。</font><font style="vertical-align: inherit;">例如，在以下示例中，Oracle正确确定用于表的多个实例的匹配别名</font></font><code class="codeph">times</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会在实例</font></font><code class="codeph">times</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">化视图中</font><font style="vertical-align: inherit;">的表的多个实例之间建立匹配</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的查询可以不使用被改写</font></font><code class="codeph">sales_shipping_lag_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即使多次实例化表的别名</font></font><code class="codeph">time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配，因为连接是没有的实例之间的兼容</font></font><code class="codeph">time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名通过</font></font><code class="codeph">t2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.prod_id，t2.fiscal_week_number  -  t1.fiscal_week_number AS lag</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从时间t1开始，销售额s，时间t2 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE_1.time_id = s.time_id AND t2.time_id = s.time_id_paid;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此请求查询连接</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">上</font></font><code class="codeph">time</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">表</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">，而实例化视图连接</font><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">上的别</font><font style="vertical-align: inherit;">名表</font><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于连接条件不同，Oracle正确地确定不能进行重写。</font></font><code class="codeph">t2</code><font style="vertical-align: inherit;"></font><code class="codeph">s.time_id_paid</code><font style="vertical-align: inherit;"></font><code class="codeph">times</code><font style="vertical-align: inherit;"></font><code class="codeph">t2</code><font style="vertical-align: inherit;"></font><code class="codeph">s.time_id_ship</code><font style="vertical-align: inherit;"></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下查询在物化视图中没有任何匹配别名</font></font><code class="codeph">sales_shipping_lag_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，对于表，时间。</font><font style="vertical-align: inherit;">但是查询重写现在比较查询和物化视图之间的连接，并正确匹配多个时间实例。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.prod_id，x2.fiscal_week_number  -  x1.fiscal_week_number AS lag</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从次数x1，销售额s，乘以x2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE x1.time_id = s.time_id AND x2.time_id = s.time_id_ship;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG08035"></a>
<div class="props_rev_3"><a id="GUID-81BA0698-1E21-4301-B4DE-CD0E727213C6"></a>
<h3 id="DWHSG-GUID-81BA0698-1E21-4301-B4DE-CD0E727213C6" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用日期折叠重写查询</font></font></h3>
<div>
<p><a id="d39287e3897" class="indexterm-anchor"></a><a id="d39287e3901" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期折叠重写是表达匹配重写的特定形式。</font><font style="vertical-align: inherit;">在这种类型的重写中，查询中的日期范围被折叠到表示更高日期粒度的等效日期范围中。</font><font style="vertical-align: inherit;">表示折叠日期范围中较高日期粒度的结果表达式与物化视图中的等效表达式匹配。</font><font style="vertical-align: inherit;">当列的基础数据类型是Oracle时，将日期范围折叠为更高的日期粒度（例如月，季度或年）</font></font><code class="codeph">DATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">表达式匹配是基于表达式的规范形式的使用来完成的。</font></font></p>
<p><code class="codeph">DATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种内置数据类型，表示有序时间单位，如秒，天和月，并包含时间层次结构（第二 - &gt;分钟 - &gt;小时 - &gt;日 - &gt;月 - &gt;季度 - &gt;年）。</font><font style="vertical-align: inherit;">这种硬编码知识</font></font><code class="codeph">DATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于折叠日期范围，从较低日期颗粒到较高日期颗粒。</font><font style="vertical-align: inherit;">具体而言，支持将日期值折叠到月，季，年或月末，季度，年的开头。</font><font style="vertical-align: inherit;">例如，日期值</font></font><code class="codeph">1-jan-1999</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以折叠到年</font></font><code class="codeph">1999</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，季度</font></font><code class="codeph">1999-1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或月</font><font style="vertical-align: inherit;">的开头</font></font><code class="codeph">1999-01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">并且，日期值</font></font><code class="codeph">30-sep-1999</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以折叠到季度</font></font><code class="codeph">1999-03</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或月份</font><font style="vertical-align: inherit;">的末尾</font></font><code class="codeph">1999-09</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="infobox-note" id="GUID-81BA0698-1E21-4301-B4DE-CD0E727213C6__GUID-49A7F06C-8E9E-45FF-91D4-96E2D3A8532F">
<p class="notep1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于日期折叠的工作方式，在使用</font></font><code class="codeph">BETWEEN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和日期列</font><font style="vertical-align: inherit;">时应该小心</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用</font></font><code class="codeph">BETWEEN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和日期列</font><font style="vertical-align: inherit;">的最佳方法</font><font style="vertical-align: inherit;">是将更晚的日期增加1.换句话说</font></font><code class="codeph">date_col BETWEEN '1-jan-1999' AND '30-jun-1999'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您应该使用</font><font style="vertical-align: inherit;">，而不是</font><font style="vertical-align: inherit;">使用</font></font><code class="codeph">date_col</code> <code class="codeph">BETWEEN '1-jan-1999' AND '1-jul-1999'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您也可以使用该</font></font><code class="codeph">TRUNC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数来获得等效结果，如</font></font><code class="codeph">TRUNC(date_col)</code> <code class="codeph">BETWEEN '1-jan-1999' AND '30-jun-1999'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="codeph">TRUNC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，会删除时间值。</font></font></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于日期值是有序的，因此日期列中指定的任何范围谓词都可以从较低级别的颗粒折叠成较高级别的颗粒，前提是日期范围表示较高级别颗粒的整数。</font><font style="vertical-align: inherit;">例如，范围谓词</font></font><code class="codeph">date_col &gt;= '1-jan-1999'</code> <code class="codeph">AND</code> <code class="codeph">date_col</code> <code class="codeph">&lt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'30 -jun-1999'可以使用</font></font><code class="codeph">TO_CHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">折叠到月份范围或四分之一范围，该</font><font style="vertical-align: inherit;">函数从日期值中提取特定日期组件。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过折叠日期值聚合数据的优点是实现的数据压缩。</font><font style="vertical-align: inherit;">如果没有日期折叠，则会以最低粒度级别聚合数据，从而增加存储空间并增加I / O以扫描实例化视图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑一个询问1998年产品类型的销售总额的查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.time_id&gt; = TO_DATE（'01 -jan-1998'，'dd-mon-yyyy'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND s.time_id &lt;TO_DATE（'01 -jan-1999'，'dd-mon-yyyy'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW sum_sales_pcat_monthly_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_category，TO_CHAR（s.time_id，'YYYY-MM'）AS月， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category，TO_CHAR（s.time_id，'YYYY-MM'）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_category，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND TO_CHAR（s.time_id，'YYYY-MM'）&gt; = '01 -jan-1998'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND TO_CHAR（s.time_id，'YYYY-MM'）&lt;'01 -jan-1999'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择mv.prod_category，mv.sum_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_pcat_monthly_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
月份&gt; = '01 -jan-1998'和月份&lt;'01 -jan-1999';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中指定的范围表示整数年，季度或月。</font><font style="vertical-align: inherit;">假设有一个物化视图</font></font><code class="codeph">mv3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包含预先汇总的销售额，</font></font><code class="codeph">prod_type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建物化视图mv3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT prod_name，TO_CHAR（sales.time_id，'yyyy-mm'） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   AS月份，SUM（amount_sold）AS sum_sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales，产品WHERE sales.prod_id = products.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_name，TO_CHAR（sales_time_id，'yyyy-mm'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过首先将日期范围折叠到月份范围中，然后将表示月份的表达式与月份表达式匹配来重写查询</font></font><code class="codeph">mv3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此重写分两步显示（首先折叠日期范围，然后是实际重写）。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_name，SUM（amount_sold）AS sum_sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售，产品</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里sales.prod_id = products.prod_id AND TO_CHAR（sales.time_id，'yyyy-mm'）&gt; = </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      TO_CHAR（'01 -jan-1998'，'yyyy-mm'）和TO_CHAR（sales.time_id，'01 -jan-1999'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 'yyyy-mm'）&lt;TO_CHAR（TO_DATE（''01-jan-1999''，''dd-mon-yyyy''），''yyyy-mm''）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_name;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT prod_name，sum_sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从mv3 WHERE月&gt; =</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      TO_CHAR（TO_DATE（'01 -jan-1998'，'dd-mon-yyyy'），'yyyy-mm'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AND月&lt;TO_CHAR（TO_DATE（'01 -jan-1999'，'dd-mon-yyyy'），'yyyy-mm'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code class="codeph">mv3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经预先汇总了销售额</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和年份而不是</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">月份，则仍可以通过将日期范围折叠到年份范围然后匹配年份表达式来重写查询。</font></font></p>
</div>
</div>
<a id="DWHSG8546"></a><a id="DWHSG8547"></a><a id="DWHSG08036"></a>
<div class="props_rev_3"><a id="GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF"></a>
<h3 id="DWHSG-GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用视图约束重写查询</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据仓库 </font></font><a id="d39287e4046" class="indexterm-anchor"></a><a id="d39287e4048" class="indexterm-anchor"></a><a id="d39287e4052" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序通过识别关系模式中的完整性约束来识别数据库中的多维立方体。</font><font style="vertical-align: inherit;">完整性约束表示事实和维度表之间的主要和外部关键关系。</font><font style="vertical-align: inherit;">通过查询数据字典，应用程序可以识别完整性约束，从而识别数据库中的多维数据集。</font><font style="vertical-align: inherit;">但是，这在数据库管理员出于架构复杂性或安全性原因定义事实和维度表的视图的环境中不起作用。</font><font style="vertical-align: inherit;">在此类环境中，应用程序无法正确识别多维数据集。</font><font style="vertical-align: inherit;">通过允许视图之间的约束定义，您可以将基表约束传播到视图，从而允许应用程序即使在受限制的环境中也能识别多维数据集。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图约束定义本质上是声明性的，但视图上的操作受基础基表上定义的完整性约束的约束，视图上的约束可以通过对基表的约束来实施。</font><font style="vertical-align: inherit;">定义基表的约束不仅对于数据的正确性和清洁度是必要的，而且对于使用原始基础对象的物化视图查询重写目的也是必要的。</font></font></p>
<div class="infoboxnotealso" id="GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF__GUID-E9054D4F-656F-4836-948A-5B1443AA16B4">
<p class="notep1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以看看：</font></font></p>
<p><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5A432C77-CFB2-41EF-ACBF-B57F39F712DB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abut View约束限制</font></font></a></p>
</div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图重写广泛使用约束进行查询重写。</font><font style="vertical-align: inherit;">它们用于确定无损连接，这反过来又确定实体化视图中的连接是否与查询中的连接兼容，因此是否可以重写。</font></font></p>
<p><code class="codeph">DISABLE</code> <code class="codeph">NOVALIDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是视图约束的唯一有效状态。</font><font style="vertical-align: inherit;">但是，您可以选择</font></font><code class="codeph">RELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">NORELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为视图约束状态以启用更复杂的查询重写。</font><font style="vertical-align: inherit;">例如，状态中的视图约束</font></font><code class="codeph">RELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许在查询完整性级别设置为时发生查询重写</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF__g1021713" title="查看约束并重写完整性模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表11-3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明了视图约束何时用于确定无损连接。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，视图约束不能用于查询重写完整性级别</font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此级别强制执行最高程度的约束</font></font><code class="codeph">ENABLE</code> <code class="codeph">VALIDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<div class="tblformal" id="GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF__g1021713">
<p class="titleintable"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表11-3视图约束和重写完整性模式</font></font></p>
<table class="cellalignment1516" title="查看约束并重写完整性模式" summary="View Constraints and Rewrite Integrity Modes">
<thead>
<tr class="cellalignment1507">
<th class="cellalignment1556" id="d39287e4113"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束国</font></font></th>
<th class="cellalignment1523" id="d39287e4116"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依靠</font></font></th>
<th class="cellalignment1523" id="d39287e4119"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NORELY</font></font></th>
</tr>
</thead>
<tbody>
<tr class="cellalignment1507">
<td class="cellalignment1557" id="d39287e4124" headers="d39287e4113">
<p><code class="codeph">ENFORCED</code></p>
</td>
<td class="cellalignment1526" headers="d39287e4124 d39287e4116">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</td>
<td class="cellalignment1526" headers="d39287e4124 d39287e4119">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1557" id="d39287e4135" headers="d39287e4113">
<p><code class="codeph">TRUSTED</code></p>
</td>
<td class="cellalignment1526" headers="d39287e4135 d39287e4116">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></p>
</td>
<td class="cellalignment1526" headers="d39287e4135 d39287e4119">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</td>
</tr>
<tr class="cellalignment1507">
<td class="cellalignment1557" id="d39287e4146" headers="d39287e4113">
<p><code class="codeph">STALE_TOLERATED</code></p>
</td>
<td class="cellalignment1526" headers="d39287e4146 d39287e4116">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></p>
</td>
<td class="cellalignment1526" headers="d39287e4146 d39287e4119">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
</td>
</tr>
</tbody>
</table>
</div>
<!-- class="inftblhruleinformal" -->
<div class="example" id="GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF__GUID-71FAD2CE-6181-4F5D-A80B-05080F6A42A4">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-10查看约束</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要演示视图的重写功能，您需要扩展</font></font><code class="codeph">sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例模式，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建视图time_view AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT time_id，TO_NUMBER（TO_CHAR（time_id，'ddd'））AS day_in_year FROM times;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您现在可以</font></font><code class="codeph">RELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在视图和事实表之间</font><font style="vertical-align: inherit;">建立外键/主键关系（在</font><font style="vertical-align: inherit;">模式下），因此</font><font style="vertical-align: inherit;">通过添加以下约束，可以按</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-1CBDAF40-2412-4A1A-9E41-CF202A6AFDAF__g1021713" title="查看约束并重写完整性模式"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表11-3中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述进行重写</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后，重写将在</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式下工作。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER VIEW time_view ADD（CONSTRAINT time_view_pk </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   PRIMARY KEY（time_id）禁用NOVALIDATE）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER VIEW time_view MODIFY CONSTRAINT time_view_pk RELY;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE sales ADD（CONSTRAINT time_view_fk FOREIGN KEY（time_id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   参考文献time_view（time_id）DISABLE NOVALIDATE）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER TABLE销售MODIFY CONSTRAINT time_view_fk RELY;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下物化视图定义：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sales_pcat_cal_day_mv </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_category，t.day_in_year，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从time_view t，sales s，products p </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = s.time_id AND p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category，t.day_in_year;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">省略维度表的以下查询</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也在没有主键/外键关系的情况下被重写，因为</font><font style="vertical-align: inherit;">已知</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">之间的抑制连接</font></font><code class="codeph">products</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是无损的。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT t.day_in_year，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从time_view t，sales s WHERE t.time_id = s.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY t.day_in_year;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如果物化视图</font></font><code class="codeph">sales_pcat_cal_day_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅根据</font><font style="vertical-align: inherit;">视图</font><font style="vertical-align: inherit;">定义</font></font><code class="codeph">time_view</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则无法重写以下查询，抑制然后在</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">之间进行连接</font></font><code class="codeph">time_view</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为没有基于delta实体化视图连接的无损。</font><font style="vertical-align: inherit;">使用前面显示的附加约束，此查询也将重写。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，products p WHERE p.prod_id = s.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要撤消对</font></font><code class="codeph">sh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构</font><font style="vertical-align: inherit;">所做的更改</font><font style="vertical-align: inherit;">，请发出以下语句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ALTER TABLE sales DROP CONSTRAINT time_view_fk;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
DROP VIEW time_view;</font></font><font></font>
</pre></div>
<!-- class="example" --></div>
<a id="DWHSG8548"></a>
<div class="props_rev_3"><a id="GUID-5A432C77-CFB2-41EF-ACBF-B57F39F712DB"></a>
<h4 id="DWHSG-GUID-5A432C77-CFB2-41EF-ACBF-B57F39F712DB" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abut View约束限制</font></font></h4>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果引用约束定义涉及视图，即外键或引用的键驻留在视图中，则约束只能处于</font></font><code class="codeph">DISABLE</code> <code class="codeph">NOVALIDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式中。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">甲</font></font><code class="codeph">RELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果引用的上视图约束只允许</font></font><code class="codeph">UNIQUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">PRIMARY</code> <code class="codeph">KEY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在约束</font></font><code class="codeph">DISABLE</code> <code class="codeph">NOVALIDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式也是一个</font></font><code class="codeph">RELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">约束。</font></font></p>
<p><font style="vertical-align: inherit;"></font><code class="codeph">ON</code> <code class="codeph">DELETE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不允许与参照完整性约束关联</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">规范</font><font style="vertical-align: inherit;">（例如，</font></font><code class="codeph">DELETE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级联）。</font><font style="vertical-align: inherit;">然而，</font></font><code class="codeph">DELETE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">UPDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="codeph">INSERT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作是允许的视图及其基表作为视图约束在</font></font><code class="codeph">DISABLE</code> <code class="codeph">NOVALIDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式。</font></font></p>
</div>
<!-- class="section" --></div>
</div>
</div>
<a id="DWHSG08037"></a>
<div class="props_rev_3"><a id="GUID-F9ED3594-159E-451C-AABC-F74FB89B6C94"></a>
<h3 id="DWHSG-GUID-F9ED3594-159E-451C-AABC-F74FB89B6C94" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用集合运算符物化视图查询重写</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您</font></font><a id="d39287e4324" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用包含集合运算符的物化视图的查询重写。</font><font style="vertical-align: inherit;">在这种情况下，查询和物化视图不必在文本上匹配以进行重写。</font><font style="vertical-align: inherit;">例如，请考虑以下物化视图，该视图使用来自旧金山或洛杉矶的男性客户的邮政编码：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW cust_male_postal_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_gender ='M'和c.cust_city ='旧金山'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_gender ='M'和c.cust_city ='洛杉矶';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您有以下查询，该查询显示来自旧金山或洛杉矶的男性客户的邮政编码：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='洛杉矶'和c.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='旧金山'和c.cust_gender ='M';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写的查询将如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择mv.cust_city，mv.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_male_postal_mv mv;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写的查询已删除，</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将其替换为物化视图。</font><font style="vertical-align: inherit;">通常，查询重写必须使用现有的一般资格规则集来确定</font><font style="vertical-align: inherit;">查询和物化视图</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下的子选择</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否等效。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-26E9AF20-AE8E-4D6E-9AF0-E5C9679A09F6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION ALL Marker和Query Rewrite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，如果您有一个查询从旧金山，Palmdale或洛杉矶检索男性客户的邮政编码，则可能会发生与前一个示例相同的重写，但查询重写必须</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与基表</font><font style="vertical-align: inherit;">保持</font><font style="vertical-align: inherit;">一致，如下列：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='Palmdale'和c.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='洛杉矶'和c.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='旧金山'和c.cust_gender ='M';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写的查询将是：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择mv.cust_city，mv.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_male_postal_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='Palmdale'和c.cust_gender ='M';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，查询重写检测</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用物化视图重写</font><font style="vertical-align: inherit;">其子集的情况</font></font><code class="codeph">cust_male_postal_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><code class="codeph">UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="codeph">INTERSECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是可交换的，因此无论在查询或物化视图中找到子选择的顺序如何，都可以重写查询重写。</font><font style="vertical-align: inherit;">但是，</font></font><code class="codeph">MINUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是可交换的。</font><font style="vertical-align: inherit;">甲</font></font><code class="codeph">MINUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B不是相当于B </font></font><code class="codeph">MINUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A.因此，在该子选择的下出现的顺序</font></font><code class="codeph">MINUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询运算符和物化视图必须在相同的顺序重写发生。</font><font style="vertical-align: inherit;">例如，考虑存在旧版客户表的情况，</font></font><code class="codeph">customer_old</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且您希望仅为居住在伦敦的男性客户找到旧客户表和当前客户表之间的差异。</font><font style="vertical-align: inherit;">也就是说，您希望在当前的客户中找到那些不属于旧客户的客户。</font><font style="vertical-align: inherit;">以下示例显示了如何使用</font></font><code class="codeph">MINUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font><font style="vertical-align: inherit;">完成此</font><font style="vertical-align: inherit;">操作：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='洛杉矶'和c.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
减去</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自customers_old c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='洛杉矶'和c.cust_gender ='M';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切换子选择会产生不同的答案。</font><font style="vertical-align: inherit;">这表明这</font></font><code class="codeph">MINUS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是可交换的。</font></font></p>
</div>
<a id="DWHSG8549"></a>
<div class="props_rev_3"><a id="GUID-26E9AF20-AE8E-4D6E-9AF0-E5C9679A09F6"></a>
<h4 id="DWHSG-GUID-26E9AF20-AE8E-4D6E-9AF0-E5C9679A09F6" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION ALL标记和查询重写</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图包含一个或多个</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符，则它还可以包含</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记。</font><font style="vertical-align: inherit;">该</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记被用于识别从哪个</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子选择在物化视图始发的每一行。</font><font style="vertical-align: inherit;">查询重写可以使用标记来区分来自物化视图的哪些行属于某个子</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择。</font><font style="vertical-align: inherit;">如果查询仅需要物化视图中的数据子集，或者查询的子选择与实例化视图的子选择不进行文本匹配，则此选项非常有用。</font><font style="vertical-align: inherit;">例如，以下查询检索来自旧金山的男性客户和来自洛杉矶的女性客户的邮政编码：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_gender ='M'和c.cust_city ='旧金山'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_gender ='F'和c.cust_city ='洛杉矶';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用以下物化视图回答查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW cust_postal_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT 1 AS marker，c.cust_gender，c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='洛杉矶'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT 2 AS marker，c.cust_gender，c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='旧金山';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写的查询如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择mv.cust_city，mv.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_postal_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里mv.marker = 2 AND mv.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择mv.cust_city，mv.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_postal_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mv.marker = 1 AND mv.cust_gender ='F';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个子选择</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句包括</font></font><code class="codeph">mv.marker = 2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">mv.cust_gender = 'M'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它仅选择代表第二个子选择中的男性客户的行</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个子选择</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句包括</font></font><code class="codeph">mv.marker = 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">mv.cust_gender = 'F'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它只选择那些代表女性客户的第一个子选择的行</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，查询重写不能利用删除重复行或不同行的set运算符。</font><font style="vertical-align: inherit;">例如，</font></font><code class="codeph">UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drop重复，因此查询重写无法分辨哪些行已被删除，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='Palmdale'和c.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_gender ='M'和c.cust_city ='旧金山'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_gender ='F'和c.cust_city ='洛杉矶';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记</font><font style="vertical-align: inherit;">的重写查询</font><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c.cust_city，c.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里c.cust_city ='Palmdale'和c.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择mv.cust_city，mv.cust_postal_code</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM cust_postal_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里mv.marker = 2 AND mv.cust_gender ='M'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  选择mv.cust_city，mv.cust_postal_code</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FROM cust_postal_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mv.marker = 1 AND mv.cust_gender ='F';</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用标记的规则是它必须：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个常数或字符串，并且是所有子</font></font><code class="codeph">UNION ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">的相同数据类型</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为每个子</font></font><code class="codeph">UNION ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择产生</font><font style="vertical-align: inherit;">一个恒定的，不同的值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您不能在多个子选择中重复使用相同的值。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于所有子选择处于相同的序号位置。</font></font></p>
</li>
</ul>
</div>
</div>
</div>
<a id="DWHSG08038"></a>
<div class="props_rev_3"><a id="GUID-FF240F3F-2EF8-4D46-8FAE-2B6C57FBA749"></a>
<h3 id="DWHSG-GUID-FF240F3F-2EF8-4D46-8FAE-2B6C57FBA749" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于在分组集存在下的查询重写</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论将查询重写与分组集一起使用的以下注意事项：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-9CBC8423-7D9C-4368-92F3-913C5700E1D3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用GROUP BY Extensions时的查询重写</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-05CFC633-105D-45AB-97A0-805AEC29BFFF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用扩展GROUP BY重写查询的提示</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8550"></a>
<div class="props_rev_3"><a id="GUID-9CBC8423-7D9C-4368-92F3-913C5700E1D3"></a>
<h4 id="DWHSG-GUID-9CBC8423-7D9C-4368-92F3-913C5700E1D3" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于使用GROUP BY Extensions时的查询重写</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些 </font></font><a id="d39287e4612" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展了</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在的形式的条款</font></font><code class="codeph">GROUPING</code> <code class="codeph">SETS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">CUBE, ROLLUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及它们的级联可用。</font><font style="vertical-align: inherit;">通过这些扩展，您可以有选择地</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询子句中</font><font style="vertical-align: inherit;">指定感兴趣的分组</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，以下是具有分组集的典型查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_subcategory，t.calendar_month_desc，c.cust_city， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，客户c，产品p，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY GROUPING SETS（（p.prod_subcategory，t.calendar_month_desc），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （c.cust_city，p.prod_subcategory））;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带</font><font style="vertical-align: inherit;">扩展名</font><font style="vertical-align: inherit;">查询</font><font style="vertical-align: inherit;">的术语</font></font><span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本</font></font></span> <span class="bold"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组</font></font></span><font style="vertical-align: inherit;"></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">存在的所有唯一表达式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在上一个查询中，以下分组（</font></font><code class="codeph">p.prod_subcategory, t.calendar_month_desc, c.cust_city</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是基本分组。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展可以存在于用户查询和定义物化视图的查询中。</font><font style="vertical-align: inherit;">在这两种情况下，都应用了物化视图重写，您可以将重写功能区分为以下场景：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-169C564C-2F46-4A30-861A-CEFC4264C919"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Materialized View具有简单的GROUP BY，Query具有扩展的GROUP BY</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-E57F62F2-0F5B-4CD6-AA92-28EA67690850"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图具有扩展GROUP BY，Query具有简单GROUP BY</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5826A5DA-3EC3-4DA6-929C-BB65704BEB19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图和查询都具有扩展GROUP BY</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8551"></a>
<div class="props_rev_3"><a id="GUID-169C564C-2F46-4A30-861A-CEFC4264C919"></a>
<h5 id="DWHSG-GUID-169C564C-2F46-4A30-861A-CEFC4264C919" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Materialized View具有简单的GROUP BY，Query具有扩展的GROUP BY</font></font></h5>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当查询包含扩展</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句时，如果可以使用</font></font><span class="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#GUID-63B491A0-A479-4711-A5B0-40365904115F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle何时重写查询？</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中所述的重写规则中列出的实例化视图重写其基本分组，则可以使用实例化视图对其进行重写</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，在以下查询中：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_subcategory，t.calendar_month_desc，c.cust_city， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，客户c，产品p，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE.time_id = t.time_id AND s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY GROUPING SETS </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（（p.prod_subcategory，t.calendar_month_desc）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （c.cust_city，p.prod_subcategory））;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本分组是</font></font><code class="codeph">(p.prod_subcategory, t.calendar_month_desc, c.cust_city, p.prod_subcategory))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此，Oracle可以使用</font></font><code class="codeph">sum_sales_pscat_month_city_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下</font><font style="vertical-align: inherit;">方式重写查询</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_subcategory，mv.calendar_month_desc，mv.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SUM（mv.sum_amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_pscat_month_city_mv mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY GROUPING SETS </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（（mv.prod_subcategory，mv.calendar_month_desc）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （mv.cust_city，mv.prod_subcategory））;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询使用</font></font><code class="codeph">EXPAND_GSET_TO_UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示</font><font style="vertical-align: inherit;">，则会出现特殊情况</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">使用的示例，</font><font style="vertical-align: inherit;">请参阅</font></font><span class="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-05CFC633-105D-45AB-97A0-805AEC29BFFF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用扩展GROUP BY重写查询的提示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"></font><code class="codeph">EXPAND_GSET_TO_UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG8552"></a>
<div class="props_rev_3"><a id="GUID-E57F62F2-0F5B-4CD6-AA92-28EA67690850"></a>
<h5 id="DWHSG-GUID-E57F62F2-0F5B-4CD6-AA92-28EA67690850" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图具有扩展GROUP BY，Query具有简单GROUP BY</font></font></h5>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使用扩展的物化视图</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于重写，它必须满足两个附加条件：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它必须包含分组区分符，它是</font></font><code class="codeph">GROUPING_ID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句是</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code> <code class="codeph">CUBE(a, b)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表应包含</font></font><code class="codeph">GROUPING_ID(a, b)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句不应导致任何重复分组。</font><font style="vertical-align: inherit;">例如，</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code> <code class="codeph">GROUPING</code> <code class="codeph">SETS</code><code class="codeph">((a, b),</code> <code class="codeph">(a, b))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将取消物化视图与一般重写的资格。</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有扩展的物化视图</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含多个分组。</font><font style="vertical-align: inherit;">Oracle发现具有最低成本的分组，可以从中计算查询并将其用于重写。</font><font style="vertical-align: inherit;">例如，请考虑以下物化视图：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_grouping_set_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_category，p.prod_subcategory，c.cust_state_province，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUPING_ID（p.prod_category，p.prod_subcategory，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
              c.cust_state_province，c.cust_city）作为gid，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY GROUPING SETS </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（（p.prod_category，p.prod_subcategory，c.cust_city）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （p.prod_category，p.prod_subcategory，c.cust_state_province，c.cust_city），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （p.prod_category，p.prod_subcategory））;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，将重写以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_subcategory，c.cust_city，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory，c.cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用物化视图中最接近的匹配分组重写此查询。</font><font style="vertical-align: inherit;">也就是说，</font></font><code class="codeph">(prod_category, prod_subcategory, cust_city)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_subcategory，cust_city，SUM（sum_amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_grouping_set_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE gid = </font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（prod_category，prod_subcategory，cust_city）的分组标识符</font></font></span><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_subcategory，cust_city;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG8553"></a>
<div class="props_rev_3"><a id="GUID-5826A5DA-3EC3-4DA6-929C-BB65704BEB19"></a>
<h5 id="DWHSG-GUID-5826A5DA-3EC3-4DA6-929C-BB65704BEB19" class="sect5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图和查询都具有扩展GROUP BY</font></font></h5>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当物化视图和查询都包含</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展时，Oracle使用两种重写策略：分组匹配和</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重写。</font><font style="vertical-align: inherit;">首先，Oracle尝试分组匹配。</font><font style="vertical-align: inherit;">查询中的分组与实例化视图中的分组进行匹配，如果所有分组都没有汇总，Oracle将从物化视图中选择它们。</font><font style="vertical-align: inherit;">例如，请考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，p.prod_subcategory，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY GROUPING SETS </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（（p.prod_category，p.prod_subcategory，c.cust_city）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （p.prod_category，p.prod_subcategory））;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询匹配来自的两个分组</font></font><code class="codeph">sum_grouping_set_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Oracle将重写查询，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT prod_subcategory，cust_city，sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_grouping_set_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE gid = </font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（prod_category，prod_subcategory，cust_city）的</font></font></span><font style="vertical-align: inherit;"><span class="italic"><font style="vertical-align: inherit;">分组标识符</font></span><font style="vertical-align: inherit;"> 
   或gid = </font></font><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（prod_category，prod_subcategory）的分组标识符</font></font></span>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果分组匹配失败，Oracle会尝试一种名为</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rewrite </font><font style="vertical-align: inherit;">的通用重写机制</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">Oracle首先使用extended </font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">将查询表示</font><font style="vertical-align: inherit;">为等效</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询。</font><font style="vertical-align: inherit;">原始查询的每个分组都放在一个单独的</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分支中。</font><font style="vertical-align: inherit;">该分支将有一个简单的</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条款。</font><font style="vertical-align: inherit;">例如，考虑以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_category，p.prod_subcategory，c.cust_state_province， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  t.calendar_month_desc，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY GROUPING SETS </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（（p.prod_subcategory，t.calendar_month_desc）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （t.calendar_month_desc）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （p.prod_category，p.prod_subcategory，c.cust_state_province）， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （p.prod_category，p.prod_subcategory））;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这首先表示为</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">四个分支：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT null，p.prod_subcategory，null，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    t.calendar_month_desc，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory，t.calendar_month_desc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT null，null，null，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    t.calendar_month_desc，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY t.calendar_month_desc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT p.prod_category，p.prod_subcategory，c.cust_state_province，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    null，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_category，p.prod_subcategory，c.cust_state_province</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT p.prod_category，p.prod_subcategory，null，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    null，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUP BY p.prod_category，p.prod_subcategory;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后使用</font></font><span class="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm#GUID-63B491A0-A479-4711-A5B0-40365904115F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle何时重写查询？</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”中</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的规则单独重写每个分支</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用物化视图</font></font><code class="codeph">sum_grouping_set_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，Oracle只能重写第三个分支（需要物化视图汇总）和四个（完全匹配物化视图）。</font><font style="vertical-align: inherit;">unrewritten分支将转换回扩展</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式。</font><font style="vertical-align: inherit;">因此，最终，查询被重写为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT null，p.prod_subcategory，null，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    t.calendar_month_desc，SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.prod_id = p.prod_id AND s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY GROUPING SETS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  （（p.prod_subcategory，t.calendar_month_desc），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （t.calendar_month_desc））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT prod_category，prod_subcategory，cust_state_province，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    null，SUM（sum_amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  来自sum_grouping_set_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE gid = &lt;分组ID（prod_category，prod_subcategory，cust_city）&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  GROUP BY p.prod_category，p.prod_subcategory，c.cust_state_province</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UNION ALL </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT prod_category，prod_subcategory，null，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    null，sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  来自sum_grouping_set_mv </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE gid = &lt;分组ID（prod_category，prod_subcategory）&gt;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，带有extended的查询</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示为等效，</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并递归提交以进行重写优化。</font><font style="vertical-align: inherit;">无法重写的分组保留在最后一个分支中</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而是访问基础数据。</font></font></p>
</div>
</div>
</div>
<a id="DWHSG8554"></a>
<div class="props_rev_3"><a id="GUID-05CFC633-105D-45AB-97A0-805AEC29BFFF"></a>
<h4 id="DWHSG-GUID-05CFC633-105D-45AB-97A0-805AEC29BFFF" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用扩展GROUP BY重写查询的提示</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以 </font></font><a id="d39287e5011" class="indexterm-anchor"></a><a id="d39287e5015" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="codeph">EXPAND_GSET_TO_UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示强制将扩展查询</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展到等效</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询中。</font><font style="vertical-align: inherit;">此提示可以在物化视图</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅</font><font style="vertical-align: inherit;">包含简单</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">的环境中使用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这种情况下，Oracle扩展了重写的灵活性，因为每个分支都可以由单独的物化视图独立重写。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">的更多信息，</font><font style="vertical-align: inherit;">请参见“ </font></font><a class="olink TGSQL" target="_blank" href="https://docs.oracle.com/database/121/TGSQL/toc.htm"><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库SQL调优指南”</font></font></span></a><font style="vertical-align: inherit;"></font><code class="codeph">EXPAND_GSET_TO_UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<a id="DWHSG08039"></a>
<div class="props_rev_3"><a id="GUID-1BA3AB83-5155-47A5-90DA-1D8AEA8E8CC6"></a>
<h3 id="DWHSG-GUID-1BA3AB83-5155-47A5-90DA-1D8AEA8E8CC6" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在窗口函数存在的情况下查询重写</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口函数用于计算累积，移动和居中聚合。</font><font style="vertical-align: inherit;">这些功能与以下聚集工作：</font></font><code class="codeph">SUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">AVG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">MIN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code class="codeph">MAX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">VARIANCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">STDDEV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">FIRST_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><code class="codeph">LAST_VALUE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">可以使用精确文本匹配重写来重写具有窗口函数的查询。</font><font style="vertical-align: inherit;">这要求物化视图定义也与查询完全匹配。</font><font style="vertical-align: inherit;">当物化视图上没有窗口函数时，如果在物化视图中找到查询中的聚合并且所有其他合格性检查（例如连接可计算性检查）成功，则可以重写具有窗口函数的查询。</font><font style="vertical-align: inherit;">查询的窗口函数使用其规范的表单格式与物化视图中的窗口函数进行比较。</font><font style="vertical-align: inherit;">这使得查询重写能够重写甚至复杂的窗口函数。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当具有窗口函数的查询在查询重写期间需要汇总时，查询重写将尽可能将查询拆分为带有聚合的内部查询和带有窗口函数的外部查询。</font><font style="vertical-align: inherit;">这允许查询重写在应用窗口函数之前重写内部查询中的聚合。</font><font style="vertical-align: inherit;">一个例外是查询同时具有窗口功能和分组集。</font><font style="vertical-align: inherit;">在这种情况下，分组集的存在可防止查询重写分割查询，因此在这种情况下不会发生查询重写。</font></font></p>
</div>
</div>
<a id="DWHSG08040"></a>
<div class="props_rev_3"><a id="GUID-E0B7B0AB-6D13-4AA4-BFCE-119B5834AAAF"></a>
<h3 id="DWHSG-GUID-E0B7B0AB-6D13-4AA4-BFCE-119B5834AAAF" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写和表达式匹配</font></font></h3>
<div>
<p><a id="d39287e5122" class="indexterm-anchor"></a><a id="d39287e5126" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果物化视图列表示与查询中的表达式匹配的预计算表达式，则查询中显示的表达式可以替换为物化视图中的简单列。</font><font style="vertical-align: inherit;">如果可以重写查询以使用实体化视图，则会更快。</font><font style="vertical-align: inherit;">这是因为物化视图包含预先计算的计算，不需要执行表达式计算。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式匹配是通过首先将表达式转换为规范形式然后将它们进行相等性来完成的。</font><font style="vertical-align: inherit;">因此，只要它们彼此等同，通常将匹配两个不同的表达。</font><font style="vertical-align: inherit;">此外，如果查询中的整个表达式无法与实例化视图中的表达式匹配，则尝试使用它的子表达式来查找匹配项。</font><font style="vertical-align: inherit;">子表达式以自上而下的顺序尝试以获得最大表达式匹配。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑一个询问按年龄括号（1-10,11-20,21-30等）的销售总额的查询。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sales_by_age_bracket_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT TO_CHAR（（2000-c.cust_year_of_birth）/10-0.5,999）AS age_bracket，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，customers c WHERE s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY TO_CHAR（（2000-c.cust_year_of_birth）/10-0.5,999）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下查询使用表达式匹配重写：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT TO_CHAR（（（2000-c.cust_year_of_birth）/ 10）-0.5,999），SUM（s.amount_sold） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，customers c WHERE s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY TO_CHAR（（2000-c.cust_year_of_birth）/10-0.5,999）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"></font><code class="codeph">sales_by_age_bracket_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据年龄段表达式（即2000  - </font></font><code class="codeph">c.cust_year_of_birth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）/10-0.5）</font><font style="vertical-align: inherit;">的规范形式的匹配，</font><font style="vertical-align: inherit;">重写此查询</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT age_bracket，sum_amount_sold FROM sales_by_age_bracket_mv;
</font></font></pre></div>
<a id="DWHSG8555"></a>
<div class="props_rev_3"><a id="GUID-8906324F-1EAD-4F1B-B506-4824AE0F3E4B"></a>
<h4 id="DWHSG-GUID-8906324F-1EAD-4F1B-B506-4824AE0F3E4B" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用部分过时的物化视图查询重写</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHE</font></font><a id="d39287e5173" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新详细信息表的na分区，仅物化视图的特定部分标记为陈旧。</font><font style="vertical-align: inherit;">物化视图必须具有可以识别与物化视图的特定行或组对应的表的分区的信息。</font><font style="vertical-align: inherit;">最简单的方案是表格的分区键</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在物化视图列表中</font><font style="vertical-align: inherit;">可用，</font><font style="vertical-align: inherit;">因为这是将行映射到过时分区的最简单方法。</font><font style="vertical-align: inherit;">使用部分过时的物化视图时的关键点是：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果已知用于回答查询</font><font style="vertical-align: inherit;">的物化视图中</font><font style="vertical-align: inherit;">的行，则</font><font style="vertical-align: inherit;">查询重写可以使用物理视图</font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式</font></font><code class="codeph">FRESH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图中的新行通过将选择谓词添加到物化视图的</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">来标识</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果其答案包含在此（受限制的）物化视图中，Oracle将使用此物化视图重写查询。</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实表</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据以下范围进行分区</font></font><code class="codeph">time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按范围划分（time_id）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（PARTITION SALES_Q1_1998 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           价值不到（截止日期（'01-APR-1998'，'DD-MON-YYYY'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION SALES_Q2_1998 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           价值不到（截止到（'01-JUL-1998'，'DD-MON-YYYY'）），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 PARTITION SALES_Q3_1998 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           价值不到（截止日期（'01 -OCT-1998'，'DD-MON-YYYY'））， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
...</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您具有物化视图分组，</font></font><code class="codeph">time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_sales_per_city_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT s.time_id，p.prod_subcategory，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.cust_id = c.cust_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY time_id，prod_subcategory，cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还假设将插入2000年12月的新数据，该数据将分配给分区</font></font><code class="codeph">sales_q4_2000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于测试目的，您可以应用任意DML操作</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">sales_q1_2000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当此物化视图为新的时</font><font style="vertical-align: inherit;">，更改不同的分区，而不是</font><font style="vertical-align: inherit;">以下查询请求此分区中的数据。</font><font style="vertical-align: inherit;">例如，以下内容：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入销售价值（17,10，'01 -DEC-2000'，4,380,123.45,54321）;
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在完成刷新之前，物化视图通常是陈旧的，不能用于强制模式下的无限重写。</font><font style="vertical-align: inherit;">但是，由于表</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已分区，并且并非所有分区都已修改，因此Oracle可以识别所有未触及的分区。</font><font style="vertical-align: inherit;">优化程序可以通过将选择谓词隐式添加到物化视图定义查询来识别物化视图中的新行（自上次刷新操作以来不受更新影响的数据），如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.time_id，p.prod_subcategory，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.cust_id = c.cust_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND s.time_id &lt;TO_DATE（'01 -OCT-2000'，'DD-MON-YYYY'） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
或者s.time_id&gt; = TO_DATE（'01 -OCT-2001'，'DD-MON-YYYY'））</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY time_id，prod_subcategory，cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，部分过时的物化视图的新鲜度是在每个分区基础上跟踪的，而不是在逻辑基础上。</font><font style="vertical-align: inherit;">由于</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实表</font><font style="vertical-align: inherit;">的分区策略</font><font style="vertical-align: inherit;">是按季度进行的，因此2000年12月的更改会导致整个分区</font></font><code class="codeph">sales_q4_2000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变得陈旧。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下查询，该查询要求在2000年第1季度和第2季度进行销售：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.time_id，p.prod_subcategory，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.cust_id = c.cust_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND s.time_id BETWEEN TO_DATE（'01 -JAN-2000'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和时间（'01 -JUL-2000'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY time_id，prod_subcategory，cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库知道物化视图中的那些行范围是新鲜的，因此可以使用物化视图重写查询。</font><font style="vertical-align: inherit;">重写的查询如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT time_id，prod_subcategory，cust_city，sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_per_city_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在什么时间_DATE到_DATE（'01 -JAN-2000'，'DD-MON-YYYY'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
和_DATE（'01 -JUL-2000'，'DD-MON-YYYY'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分隔标记（标识给定rowid的分区的函数）可以存在于实体</font><font style="vertical-align: inherit;">化视图</font><font style="vertical-align: inherit;">的</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（和</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表）中，</font><font style="vertical-align: inherit;">而不是分区键</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用物化视图重写仅需要来自某些分区（可通过分区标记识别）的数据的查询，例如，具有指定包含整个分区的分区键范围的谓词的查询。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">提供的分区标记功能的详细信息，</font><font style="vertical-align: inherit;">请参阅</font></font><a href="https://docs.oracle.com/database/121/DWHSG/advmv.htm#GUID-F7394DFE-7CF6-401C-A312-C36603BEB01B"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级物化视图</font></font></a><font style="vertical-align: inherit;"></font><code class="codeph">DBMS_MVIEW.PMARKER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例说明了在物化视图中使用分区标记而不是直接使用分区键列：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sum_sales_per_city_2_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT DBMS_MVIEW.PMARKER（s.rowid）AS pmarker，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       t.fiscal_quarter_desc，p.prod_subcategory，c.cust_city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       SUM（s.amount_sold）AS sum_amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.cust_id = c.cust_id AND s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND s.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY DBMS_MVIEW.PMARKER（s.rowid），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    p.prod_subcategory，c.cust_city，t.fiscal_quarter_desc;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设您知道该分区</font></font><code class="codeph">sales_q1_2000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是新鲜的，并且对</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">其他分区进行了DML更改</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">出于测试目的，您可以应用任意DML操作</font></font><code class="codeph">sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，更改不同的分区，而不是</font></font><code class="codeph">sales_q1_2000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例化视图是新鲜的。</font><font style="vertical-align: inherit;">一个例子如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入销售价值（17,10，'01 -DEC-2000'，4,380,123.45,54321）;
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管物化视图</font></font><code class="codeph">sum_sales_per_city_2_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在通常被认为是陈旧的，但Oracle数据库可以使用此物化视图重写以下查询。</font><font style="vertical-align: inherit;">此查询将数据限制为分区</font></font><code class="codeph">sales_q1_2000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并仅选择某些值</font></font><code class="codeph">cust_city</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT p.prod_subcategory，c.cust_city，SUM（s.amount_sold）AS sum_amount_sold </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售s，产品p，客户c，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE s.cust_id = c.cust_id AND s.prod_id = p.prod_id AND s.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND c.cust_city ='纽伦堡' </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND s.time_id&gt; = TO_DATE（'01 -JAN-2000'，'dd-mon-yyyy'）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND s.time_id &lt;TO_DATE（'01 -APR-2000'，'dd-mon-yyyy'） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_subcategory，cust_city;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，</font></font><code class="codeph">PMARKER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有在访问一个或多个分区的完整数据内容并且谓词条件位于分区事实表本身时，才能使用</font><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的部分过时的物化视图进行重写</font><font style="vertical-align: inherit;">，如前面的示例所示。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">DBMS_MVIEW.PMARKER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数为每个分区提供了一个不同的值。</font><font style="vertical-align: inherit;">与分区键本身相比，这大大减少了潜在物化视图中的行数，但您也放弃了有关此键的任何详细信息。</font><font style="vertical-align: inherit;">您知道的唯一信息是分区号，因此是下边界值和上边界值。</font><font style="vertical-align: inherit;">这是减少范围分区列的基数以及因此减少行数的权衡。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设</font></font><code class="codeph">p_marker</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for partition的</font></font><code class="codeph">sales_q1_2000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值为31070，则可以对物化视图重写先前显示的查询，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT mv.prod_subcategory，mv.cust_city，SUM（mv.sum_amount_sold） </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自sum_sales_per_city_2_mv mv </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在哪里mv.pmarker = 31070和mv.cust_city ='纽伦堡'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY prod_subcategory，cust_city; </font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，可以针对物化视图重写查询，而无需访问过时数据。</font></font></p>
</div>
</div>
</div>
<a id="DWHSG08041"></a>
<div class="props_rev_3"><a id="GUID-5C3DD547-5E57-40CE-9AC9-770214718949"></a>
<h3 id="DWHSG-GUID-5C3DD547-5E57-40CE-9AC9-770214718949" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写期间的游标共享和绑定变量</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问</font></font><a id="d39287e5350" class="indexterm-anchor"></a><a id="d39287e5354" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要在查询重写期间不需要实际绑定值，查询包含用户绑定变量时，支持重写。</font><font style="vertical-align: inherit;">如果在查询重写期间需要绑定变量的实际值，则可以说查询重写依赖于绑定值。</font><font style="vertical-align: inherit;">由于在查询重写时间内用户绑定变量不可用，如果查询重写依赖于绑定值，则无法重写查询。</font><font style="vertical-align: inherit;">例如，请考虑以下物化视图，</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">子句中</font></font><code class="codeph">customer_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有谓词（</font></font><code class="codeph">customer_id &gt;= 1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW customer_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT cust_id，prod_id，SUM（amount_sold）AS total_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales WHERE cust_id&gt; = 1000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_id，prod_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"></font><code class="codeph">:user_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">考虑以下查询，该查询具有用户绑定变量</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_id，prod_id，SUM（amount_sold）AS sum_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales WHERE cust_id&gt;：user_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_id，prod_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于物化视图</font></font><code class="codeph">customer_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">有选择</font><font style="vertical-align: inherit;">，因此查询重写依赖于用户绑定变量的实际值</font></font><code class="codeph">user_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来计算包含。</font><font style="vertical-align: inherit;">因为</font></font><code class="codeph">user_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询重写时间不可用且查询重写依赖于绑定值</font></font><code class="codeph">user_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以不能重写此查询。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管前面的示例在</font></font><code class="codeph">WHERE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句中</font><font style="vertical-align: inherit;">具有用户绑定变量，但</font><font style="vertical-align: inherit;">无论用户绑定变量在查询中出现的位置如何，都是如此。</font><font style="vertical-align: inherit;">换句话说，无论用户绑定变量在查询中出现的位置如何，如果查询重写依赖于其值，则无法重写查询。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在考虑以下</font></font><code class="codeph">:user_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在其</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表中</font><font style="vertical-align: inherit;">具有用户绑定变量的查询</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_id +：user_id，prod_id，SUM（amount_sold）AS total_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales WHERE cust_id&gt; = 2000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY cust_id，prod_id;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于</font></font><code class="codeph">user_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询重写时间内不需要</font><font style="vertical-align: inherit;">用户绑定变量的值</font><font style="vertical-align: inherit;">，因此前面的查询将重写。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT cust_id +：user_id，prod_id，total_amount</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM customer_mv;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG08042"></a>
<div class="props_rev_3"><a id="GUID-3FD90BE4-F577-4AB9-8762-2701C8B60193"></a>
<h3 id="DWHSG-GUID-3FD90BE4-F577-4AB9-8762-2701C8B60193" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在查询重写中处理表达式</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当表达式求值为常量时，也支持使用某些表达式重写，例如</font></font><code class="codeph">TO_DATE(</code><code class="codeph">'</code><code class="codeph">12-SEP-1999</code><code class="codeph">'</code><code class="codeph">,</code><code class="codeph">'</code><code class="codeph">DD-Mon-YYYY</code><code class="codeph">'</code><code class="codeph">)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，如果现有的物化视图定义为：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW sales_on_valentines_day_99_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
立即建立</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
刷新力量</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT s.prod_id，s.cust_id，s.amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从时间t开始，销售额为WH. s.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND t.time_id = TO_DATE（'14-FEB-1999'，'DD-MON-YYYY'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后可以重写以下查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT s.prod_id，s.cust_id，s.amount_sold</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，times t WHERE s.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AND t.time_id = TO_DATE（'14-FEB-1999'，'DD-MON-YYYY'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询将重写如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM sales_on_valentines_day_99_mv;
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论何时</font></font><code class="codeph">TO_DATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用，只有在提供的日期掩码与指定的日期掩码相同时才会发生查询重写</font></font><code class="codeph">NLS_DATE_FORMAT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
<a id="DWHSG8556"></a><a id="DWHSG8557"></a><a id="DWHSG8558"></a><a id="DWHSG0804"></a>
<div class="props_rev_3"><a id="GUID-94D148DC-1E2A-4791-A7B6-28F9BF0306C1"></a>
<h2 id="DWHSG-GUID-94D148DC-1E2A-4791-A7B6-28F9BF0306C1" class="sect2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用等效性重写高级查询</font></font></h2>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有</font></font><a id="d39287e5505" class="indexterm-anchor"></a><a id="d39287e5509" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一种特殊类型的查询重写，可以声明两个SQL语句在功能上是等效的。</font><font style="vertical-align: inherit;">此功能使您可以将内部应用程序知识放入数据库中，以便数据库可以利用此知识来提高查询性能。</font><font style="vertical-align: inherit;">这样做是通过声明两个</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句在功能上等效（返回相同的行和列）并指示其中一个</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句更有利于性能。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种高级重写功能通常可以应用于各种查询性能问题和机会。</font><font style="vertical-align: inherit;">任何应用程序都可以使用此功能来影响复杂用户查询的重写，这些查询可以通过专门创建的更简单，性能更高的查询来回答，通常由具有内部应用知识的人员进行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在许多情况下，您可以拥有允许SQL语句转换和调优的内部应用程序知识，从而显着提高性能。</font><font style="vertical-align: inherit;">您可能希望影响的优化类型可能非常简单，也可能与查询的重大重构一样复杂。</font><font style="vertical-align: inherit;">但是，传入的SQL查询通常由应用程序生成，您无法控制应用程序生成的查询的形式和结构。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要获得对此功能的访问权限，您需要连接as </font></font><code class="codeph">SYSDBA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并明确授予对将要声明重写等效的所需数据库管理员的执行访问权限。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息，</font><font style="vertical-align: inherit;">请参见</font></font><a class="olink ARPLS083" target="_blank" href="https://docs.oracle.com/database/121/ARPLS/d_advrwr.htm#ARPLS083"><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle Database PL / SQL包和类型参考</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了说明这种类型的高级重写，提供了一些使用多维数据的示例。</font><font style="vertical-align: inherit;">为了优化资源使用，应用程序可以使用复杂的SQL，自定义C代码或表函数来从数据库中检索数据。</font><font style="vertical-align: inherit;">就最终用户而言，这种复杂性无关紧要。</font><font style="vertical-align: inherit;">用户仍然希望使用带有</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...的</font><font style="vertical-align: inherit;">典型查询来获取他们的答案</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<!-- class="section" -->
<div class="example" id="GUID-94D148DC-1E2A-4791-A7B6-28F9BF0306C1__GUID-4F830616-3710-4710-A833-69FB860C60EF">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-11使用等价重写</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例向Oracle声明必须使用指定的备用查询执行给定的用户查询。</font><font style="vertical-align: inherit;">Oracle会识别这种关系，每次用户询问查询时，它都会使用替代方法透明地重写它。</font><font style="vertical-align: inherit;">因此，用户可以免于理解和编写用于复杂聚合计算的SQL的麻烦。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有两个基表</font></font><code class="codeph">sales_fact</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">geog_dim</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过发出以下语句计算每个城市，州和地区的累计销售总额：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT g.region，g.state，g.city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUPING_ID（g.city，g.state，g.region），SUM（销售）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_fact f，geog_dim g WHERE f.geog_key = g.geog_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY ROLLUP（g.region，g.state，g.city）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序可能希望实现此查询以获得快速结果。</font><font style="vertical-align: inherit;">不幸的是，最终的物化视图占用了太多的磁盘空间。</font><font style="vertical-align: inherit;">但是，如果您有一个维度将城市向州或地区汇总，则可以使用解码语句轻松地将三个分组列压缩为一列。</font><font style="vertical-align: inherit;">（这也称为嵌入式总计）：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DECODE（gid，0，city，1，state，3，region，7，“grand_total”）
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样做是使用层次结构的最低级别来表示整个信息。</font><font style="vertical-align: inherit;">例如，说</font></font><code class="codeph">Boston</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的手段</font></font><code class="codeph">Boston, MA, New England Region</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，说</font></font><code class="codeph">CA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手段</font></font><code class="codeph">CA, Western Region</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，应用程序可以将这些嵌入的总结果存储到表中</font></font><code class="codeph">embedded_total_sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，将结果返回给用户时，您可能希望拥有所有数据列（城市，州，地区）。</font><font style="vertical-align: inherit;">为了有效和快速地返回结果，应用程序可以使用自定义表函数（</font></font><code class="codeph">et_function</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）以</font></font><code class="codeph">embedded_total_sales</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展形式</font><font style="vertical-align: inherit;">从</font><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">检索数据</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM TABLE（et_function）;
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">换句话说，此功能允许应用程序声明用户的先前查询与备用查询的等效性，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_ADVANCED_REWRITE.DECLARE_REWRITE_EQUIVALENCE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   'EMBEDDED_TOTAL'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   'SELECT g.region，g.state，g.city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    GROUPING_ID（g.city，g.state，g.region），SUM（销售）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    FROM sales_fact f，geog_dim g</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    WHERE f.geog_key = g.geog_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    GROUP BY ROLLUP（g.region，g.state，g.city）'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    'SELECT * FROM TABLE（et_function）'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个调用</font></font><code class="codeph">DECLARE_REWRITE_EQUIVALENCE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建了一个等价声明，命名</font></font><code class="codeph">EMBEDDED_TOTAL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明指定的</font></font><code class="codeph">SOURCE_STMT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和指定的</font></font><code class="codeph">DESTINATION_STMT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在功能上是等价的，并且指定</font></font><code class="codeph">DESTINATION_STMT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的性能更可取。</font><font style="vertical-align: inherit;">在DBA创建这样的声明之后，用户不需要知道在封面下执行的空间优化。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此功能还允许应用程序执行SQL查询的特殊部分实现。</font><font style="vertical-align: inherit;">例如，它可以使用</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三个关系</font><font style="vertical-align: inherit;">执行汇总</font><font style="vertical-align: inherit;">，如</font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-94D148DC-1E2A-4791-A7B6-28F9BF0306C1__BABIGJAH"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-12</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所示</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-94D148DC-1E2A-4791-A7B6-28F9BF0306C1__BABIGJAH">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-12使用等效重写（UNION ALL）</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建物化视图T1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
AS SELECT g.region，g.state，g.city，0 AS gid，SUM（sales）AS sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_fact f，geog_dim g WHERE f.geog_key = g.geog_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY g.region，g.state，g.city;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建物质化视图T2 AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT t.region，t.state，SUM（t.sales）AS sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自T1 GROUP BY t.region，t.state;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
创建视图T3 AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT t.region，SUM（t.sales）AS sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自T2 GROUP BY t.region;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">ROLLUP(region, state, city)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询等同于：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM T1 UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT区域，状态，NULL，1 AS gid，销售来自T2 UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT区域，NULL，NULL，3 AS gid，销售来自T3 UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT NULL，NULL，NULL，7 AS gid，SUM（sales）FROM T3;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过指定此等效性，Oracle数据库将使用更有效的第二种形式的查询来计算</font></font><code class="codeph">ROLLUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户询问</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">查询。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_ADVANCED_REWRITE.DECLARE_REWRITE_EQUIVALENCE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   'CUSTOM_ROLLUP'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   'SELECT g.region，g.state，g.city，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   GROUPING_ID（g.city，g.state，g.region），SUM（销售）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   FROM sales_fact f，geog_dim g</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   WHERE f.geog_key = g.geog_key</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   GROUP BY ROLLUP（g.region，g.state，g.city'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   'SELECT * FROM T1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SELECT区域，状态，NULL，1作为gid，sales FROM T2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SELECT区域，NULL，NULL，3作为gid，sales FROM T3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   UNION ALL</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SELECT NULL，NULL，NULL，7为gid，SUM（sales）FROM T3'）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此功能的另一个应用是为用户提供特殊的聚合计算，这些计算可能在概念上很简单，但在SQL中表达起来非常复杂。</font><font style="vertical-align: inherit;">在这种情况下，应用程序要求用户使用指定的自定义聚合函数，并使用复杂的SQL在内部对其进行计算。</font></font></p>
</div>
<!-- class="example" -->
<div class="example" id="GUID-94D148DC-1E2A-4791-A7B6-28F9BF0306C1__GUID-3278789A-FFC9-4A1D-A5DF-E0DF1D6C3A8D">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例11-13使用等效重写（使用自定义聚合）</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设应用程序用户希望查看每个城市，州和地区的销售额以及特定季节的其他销售信息。</font><font style="vertical-align: inherit;">例如，新英格兰用户希望在冬季月份为新英格兰的城市提供额外的销售信息。</font><font style="vertical-align: inherit;">该应用程序将为您提供一个</font></font><code class="codeph">Seasonal_Agg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算早期聚合</font><font style="vertical-align: inherit;">的特殊</font><font style="vertical-align: inherit;">聚合。</font><font style="vertical-align: inherit;">你会问一个经典的摘要查询但是使用</font></font><code class="codeph">Seasonal_Agg(sales, region)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><code class="codeph">SUM(sales)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT g.region，t.calendar_month_name，Seasonal_Agg（f.sales，g.region）AS sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales_fact f，geog_dim g，次数t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
WHERE f.geog_key = g.geog_key AND f.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY g.region，t.calendar_month_name;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序可以使用此功能自动为它们执行此操作，而不是要求用户编写执行额外计算的SQL。</font><font style="vertical-align: inherit;">在此示例中，</font></font><code class="codeph">Seasonal_Agg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用电子表格功能计算（请参阅</font></font><a href="https://docs.oracle.com/database/121/DWHSG/sqlmodel.htm#GUID-538F78AA-9BF3-46F2-93D1-39A8739B3237"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL for Modeling</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">请注意，即使</font></font><code class="codeph">Seasonal_Agg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用户定义的聚合，所需的行为是在查询的答案中添加额外的行，这对于简单的PL / SQL函数来说是不容易的。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_ADVANCED_REWRITE.DECLARE_REWRITE_EQUIVALENCE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   'CUSTOM_SEASONAL_AGG'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   SELECT g.region，t.calendar_month_name，Seasonal_Agg（sales，region）AS sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   FROM sales_fact f，geog_dim g，次数t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   WHERE f.geog_key = g.geog_key AND f.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   GROUP BY g.region，t.calendar_month_name'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   'SELECT g，region，t.calendar_month_name，SUM（sales）AS sales</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   FROM sales_fact f，geog_dim g</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   WHERE f.geog_key = g.geog_key AND t.time_id = f.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   GROUP BY g.region，g.state，g.city，t.calendar_month_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   DIMENSION BY g.region，t.calendar_month_name</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （销售['新英格兰'，'冬季'] = AVG（销售）超过calendar_month_name IN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （'Dec'，'Jan'，'Feb'，'Mar'），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   sales ['Western'，'Summer'] = AVG（销售）超过calendar_month_name IN</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   （'May'，'Jun'，'July'，'Aug'）,.）;</font></font><font></font>
</pre></div>
<!-- class="example" --></div>
</div>
<a id="DWHSG8915"></a><a id="DWHSG0807"></a>
<div class="props_rev_3"><a id="GUID-71197259-E8A4-45E5-A462-A9ADF6517CD6"></a>
<h2 id="DWHSG-GUID-71197259-E8A4-45E5-A462-A9ADF6517CD6" class="sect2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用等效项创建结果缓存物化视图</font></font></h2>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一种特殊类型的物化视图（称为结果缓存物化视图（RCMV））使您可以在运行查询重写时使用结果缓存。</font><font style="vertical-align: inherit;">这些结果缓存物化视图提供了结果缓存的主要优点，更快的访问需要更少的空间，而没有无法对它们运行查询重写的正常缺点。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此类物化视图的示例如下。</font></font></p>
<div class="example" id="GUID-71197259-E8A4-45E5-A462-A9ADF6517CD6__GUID-232AD555-A465-4DF8-AFA8-45C2256AA281">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例11-14结果缓存物化视图</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，授予必要的权限：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONNECT / AS SYSDBA</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GRANT创建物质化的视图sh;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在DBMS_ADVANCED_REWRITE上执行GRANT EXECUTE到sh;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，创建结果缓存物化视图：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接sh / sh</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   sys.DBMS_ADVANCED_REWRITE.Declare_Rewrite_Equivalence</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    （</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Name =&gt;'RCMV_SALES'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Source_Stmt =&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      'select channel_id，prod_id，sum（amount_sold），count（amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       来自销售</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       group by prod_id，channel_id'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Destination_Stmt =&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      'select * from</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
      （选择/ * + RESULT_CACHE（名称= RCMV_SALES）* /</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
               channel_id，prod_id，sum（amount_sold），count（amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         来自销售</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         group by prod_id，channel_id）'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       验证=&gt; FALSE，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Rewrite_Mode =&gt;'GENERAL'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结束;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ALTER SESSION SET query_rewrite_integrity = stale_tolerated;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，</font></font><code class="codeph">RCMV_SALES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过查看解释计划</font><font style="vertical-align: inherit;">验证所有重写的不同查询</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释计划</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT channel_id，SUM（amount_sold）FROM sales GROUP BY channel_id;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
@？/ RDBMS /管理/ utlxpls</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PLAN_TABLE_OUTPUT</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------------------------------------- ------------------------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
计划哈希值：3903632134</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------------------------------------- ------------------------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| Id | </font><font style="vertical-align: inherit;">操作| </font><font style="vertical-align: inherit;">名称|行|字节|成本（％CPU）| </font><font style="vertical-align: inherit;">时间| Pstart | Pstop |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------------------------------------- -------------------------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">0 | </font><font style="vertical-align: inherit;">选择声明| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">64 | </font><font style="vertical-align: inherit;">1340（68）| 00:00:17 | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">HASH GROUP BY | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">64 | </font><font style="vertical-align: inherit;">1340（68）| 00:00:17 | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">查看| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">204 | </font><font style="vertical-align: inherit;">3264 | </font><font style="vertical-align: inherit;">1340（68）| 00:00:17 | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">3 | </font><font style="vertical-align: inherit;">RESULT CACHE | 3gps5zr86gyb53y36js9zuay2s | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">4 | </font><font style="vertical-align: inherit;">HASH GROUP BY | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">204 | </font><font style="vertical-align: inherit;">2448 | </font><font style="vertical-align: inherit;">1340（68）| 00:00:17 | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">5 | </font><font style="vertical-align: inherit;">PARTITION RANGE ALL | </font><font style="vertical-align: inherit;">| 918K | </font><font style="vertical-align: inherit;">10M | </font><font style="vertical-align: inherit;">655（33）| 00：00：08 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">28 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
| </font><font style="vertical-align: inherit;">6 | </font><font style="vertical-align: inherit;">表访问完全| </font><font style="vertical-align: inherit;">销售| 918K | </font><font style="vertical-align: inherit;">10M | </font><font style="vertical-align: inherit;">655（33）| 00：00：08 | </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">28 |</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------------------------------------- -------------------------------</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结果缓存信息（由操作ID标识）：</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------------------------------------- ----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   3  - 列数= 4; </font><font style="vertical-align: inherit;">依赖=（SH.SALES）; </font><font style="vertical-align: inherit;">NAME = “RCMV_SALES”</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择了18行。</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，执行创建缓存结果的查询：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT channel_id，SUM（amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从销售</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY channel_id;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CHANNEL_ID SUM（AMOUNT_SOLD）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
---------- ----------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         2 26346342.3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         4 13706802</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         3 57875260.6</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         9 277426.26</font></font><font></font>
<font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，验证物化视图是否在结果缓存中具体化：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CONNECT / AS SYSDBA</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT名称，scan_count命中，block_count块，depend_count依赖项</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自V $ RESULT_CACHE_OBJECTS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名称='RCMV_SALES';</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
名称取决于障碍物的依赖性</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
---------- ---- ------ ------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
RCMV_SALES 0 5 1</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，删除RCMV查询等价：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  sys.DBMS_ADVANCED_REWRITE.Drop_Rewrite_equivalence（ 'RCMV_SALES'）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结束;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/</font></font><font></font>
</pre></div>
<!-- class="example" -->
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关结果缓存的更多信息，请参见“ </font></font><a class="olink TGSQL" target="_blank" href="https://docs.oracle.com/database/121/TGSQL/toc.htm"><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库SQL调优指南”</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG0805"></a>
<div class="props_rev_3"><a id="GUID-3AB77341-BDA9-4F84-9691-EB79E4C8B832"></a>
<h2 id="DWHSG-GUID-3AB77341-BDA9-4F84-9691-EB79E4C8B832" class="sect2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证是否已发生查询重写</font></font></h2>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于查询重写是透明的，因此必须采取特殊步骤来验证查询是否已被重写。</font><font style="vertical-align: inherit;">当然，如果查询运行得更快，这应该表明已经发生了重写，但这不是证明。</font><font style="vertical-align: inherit;">因此，要确认确实发生了查询重写，请使用</font></font><code class="codeph">EXPLAIN</code> <code class="codeph">PLAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句或</font></font><code class="codeph">DBMS_MVIEW.EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节包含以下主题：</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-4D27E4FA-A642-42FD-8627-7060B1861884"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用EXPLAIN PLAN和Query Rewrite</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-D4E6983B-D503-4801-8B0C-5E69D5313A11"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将EXPLAIN_REWRITE过程与Query Rewrite一起使用</font></font></a></p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="DWHSG08051"></a>
<div class="props_rev_3"><a id="GUID-4D27E4FA-A642-42FD-8627-7060B1861884"></a>
<h3 id="DWHSG-GUID-4D27E4FA-A642-42FD-8627-7060B1861884" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用EXPLAIN PLAN和Query Rewrite</font></font></h3>
<div>
<div class="section">
<p><a id="d39287e5806" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">EXPLAIN</code> <code class="codeph">PLAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具按</font></font><a class="olink SQLRF01601" target="_blank" href="https://docs.oracle.com/database/121/SQLRF/statements_9010.htm#SQLRF01601"><span class="italic"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle数据库SQL语言参考中的</font></font></span></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述使用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于查询重写，您需要检查的是操作显示</font></font><code class="codeph">MAT_VIEW</code> <code class="codeph">REWRITE</code> <code class="codeph">ACCESS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果是，则发生查询重写。</font><font style="vertical-align: inherit;">下面是一个示例，它创建了物化视图</font></font><code class="codeph">cal_month_sales_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW cal_month_sales_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT t.calendar_month_desc，SUM（s.amount_sold）AS美元</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，times t WHERE s.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY t.calendar_month_desc;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code class="codeph">EXPLAIN</code> <code class="codeph">PLAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下SQL语句中使用，则结果将放在默认表中</font></font><code class="codeph">PLAN_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，</font></font><code class="codeph">PLAN_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须首先使用</font></font><code class="codeph">utlxplan.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，</font></font><code class="codeph">EXPLAIN</code> <code class="codeph">PLAN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上并不执行查询。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解释计划</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT t.calendar_month_desc，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，times t WHERE s.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY t.calendar_month_desc; </font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于查询重写的目的，唯一感兴趣的信息</font></font><code class="codeph">PLAN_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是操作</font></font><code class="codeph">OBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">操作</font><font style="vertical-align: inherit;">标识用于执行此查询的方法。</font><font style="vertical-align: inherit;">因此，您可能希望</font></font><code class="codeph">MAT_VIEW</code> <code class="codeph">REWRITE</code> <code class="codeph">ACCESS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在输出中</font><font style="vertical-align: inherit;">看到操作</font><font style="vertical-align: inherit;">，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自PLAN_TABLE的SELECT OPERATION，OBJECT_NAME;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
OPERATION OBJECT_NAME</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------- -----------------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择声明</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MAT_VIEW REWRITE ACCESS CALENDAR_MONTH_SALES_MV</font></font><font></font>
</pre></div>
<!-- class="section" --></div>
</div>
<a id="DWHSG8559"></a>
<div class="props_rev_3"><a id="GUID-D4E6983B-D503-4801-8B0C-5E69D5313A11"></a>
<h3 id="DWHSG-GUID-D4E6983B-D503-4801-8B0C-5E69D5313A11" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将EXPLAIN_REWRITE过程与Query Rewrite一起使用</font></font></h3>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可能很困难 </font></font><a id="d39287e5903" class="indexterm-anchor"></a><a id="d39287e5907" class="indexterm-anchor"></a><a id="d39287e5911" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理解为什么查询没有重写。</font><font style="vertical-align: inherit;">管理查询重写资格的规则非常复杂，涉及各种因素，例如约束，维度，查询重写完整性模式，物化视图的新鲜度以及查询本身的类型。</font><font style="vertical-align: inherit;">此外，您可能想知道为什么查询重写选择了特定的物化视图而不是另一个。</font><font style="vertical-align: inherit;">为了解决这个问题，Oracle数据库提供了</font></font><code class="codeph">DBMS_MVIEW.EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在重写查询时建议您</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">过程，如果没有，为什么</font><font style="vertical-align: inherit;">不重要</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">使用结果</font></font><code class="codeph">DBMS_MVIEW.EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您可以采取适当的操作，以便尽可能重写查询。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，语句中指定的查询</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上并不执行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节包含以下主题：</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-723FEA4B-2299-4DF1-8216-AAA5D03D8920"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_MVIEW.EXPLAIN_REWRITE语法</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-5C0A241C-FDA4-4BBD-98EF-EC5FF47C8E62"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用REWRITE_TABLE查看EXPLAIN_REWRITE输出</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-F936CEE1-3568-4487-842A-015AFE940F87"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Varray查看EXPLAIN_REWRITE输出</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-EB88C4EC-D843-4AB5-934D-063894CE51D5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN_REWRITE福利统计</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-80AAF9D9-DA04-4804-931D-432CF883CE54"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在EXPLAIN_REWRITE中支持大于32KB的查询文本</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C6BFEB7A-B1E3-4E08-B38D-87FA3D6B1BBC"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于EXPLAIN_REWRITE和多个物化视图</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-4A5FD50D-E2AB-4176-BD1B-418E7B2491BB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于EXPLAIN_REWRITE输出</font></font></a></p>
</li>
</ul>
</div>
<!-- class="section" --></div>
<a id="DWHSG8560"></a>
<div class="props_rev_3"><a id="GUID-723FEA4B-2299-4DF1-8216-AAA5D03D8920"></a>
<h4 id="DWHSG-GUID-723FEA4B-2299-4DF1-8216-AAA5D03D8920" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_MVIEW.EXPLAIN_REWRITE语法</font></font></h4>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过</font></font><code class="codeph">DBMS_MVIEW.EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两种方式</font><font style="vertical-align: inherit;">获得输出</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">第一个是使用表，而第二个是创建表</font></font><code class="codeph">VARRAY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">以下显示了使用输出表的基本语法：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_MVIEW.EXPLAIN_REWRITE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    查询VARCHAR2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    mv VARCHAR2（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    statement_id VARCHAR2（30））;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font></font><code class="codeph">REWRITE_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过执行</font></font><code class="codeph">utlxrw.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本</font><font style="vertical-align: inherit;">来创建调用的输出表</font><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数是表示SQL查询的文本字符串。</font><font style="vertical-align: inherit;">参数,, </font></font><code class="codeph">mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个完全限定的物化视图名称，格式为</font></font><code class="codeph">schema.mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是一个可选参数。</font><font style="vertical-align: inherit;">如果未指定，则</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回有关考虑重写给定查询的所有物化视图的任何相关消息。</font><font style="vertical-align: inherit;">如果</font></font><code class="codeph">schema</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">省略且仅</font></font><code class="codeph">mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定，</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则在当前模式中查找实例化视图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要将输出</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定向到varray而不是表，则应按如下方式调用过程：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_MVIEW.EXPLAIN_REWRITE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    查询[VARCHAR2 | </font><font style="vertical-align: inherit;">CLOB]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    mv VARCHAR2（30），</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    output_array SYS.RewriteArrayType）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，如果查询长度小于256个字符，</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">则可以使用</font></font><code class="codeph">EXECUTE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL * Plus中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">轻松调用</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">否则，建议的方法是使用PL / SQL </font></font><code class="codeph">BEGIN... END</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块，如下面的示例所示</font></font><code class="codeph">/rdbms/demo/smxrw*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
<!-- class="section" --></div>
</div>
<a id="DWHSG8562"></a><a id="DWHSG8561"></a>
<div class="props_rev_3"><a id="GUID-5C0A241C-FDA4-4BBD-98EF-EC5FF47C8E62"></a>
<h4 id="DWHSG-GUID-5C0A241C-FDA4-4BBD-98EF-EC5FF47C8E62" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用REWRITE_TABLE查看EXPLAIN_REWRITE输出</font></font></h4>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将</font><font style="vertical-align: inherit;">输出</font><font style="vertical-align: inherit;">定向到名为的表</font></font><code class="codeph">REWRITE_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以通过运行</font></font><code class="codeph">utlxrw.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本</font><font style="vertical-align: inherit;">来创建此输出表</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该脚本可以在</font></font><code class="codeph">admin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录中</font><font style="vertical-align: inherit;">找到</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">格式</font></font><code class="codeph">REWRITE_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE TABLE REWRITE_TABLE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  statement_id VARCHAR2（30）， - 查询的id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mv_owner VARCHAR2（30）， -  MV的所有者</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mv_name VARCHAR2（30）， -  MV的名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  sequence INTEGER， -  msg的序列号</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  query VARCHAR2（2000）， - 用户查询</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  query_block_no INTEGER， - 阻止当前子查询的no</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  rewritten_txt VARCHAR2（2000）， - 重写查询</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  消息VARCHAR2（512）， -  EXPLAIN_REWRITE消息</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  传递VARCHAR2（3）， - 重写传递号</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mv_in_msg VARCHAR2（30）， - 当前消息中的MV </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  measure_in_msg VARCHAR2（30）， - 在当前消息中测量 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  join_back_tbl VARCHAR2（30）， - 在消息中加入表 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  join_back_col VARCHAR2（30）， - 加入消息中的列</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  original_cost INTEGER， - 原始查询的费用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  rewritten_cost INTEGER， - 重写查询的成本</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  flags INTEGER， - 相关标志</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  reserved1 INTEGER， - 目前未使用 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  reerved2 VARCHAR2（10）） - 目前未使用;</font></font><font></font>
</pre></div>
<!-- class="section" -->
<div class="example" id="GUID-5C0A241C-FDA4-4BBD-98EF-EC5FF47C8E62__GUID-F6ADC987-2327-487D-B648-B5E6E3E690CD">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-15 EXPLAIN_REWRITE使用REWRITE_TABLE</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / SQL调用示例如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXECUTE DBMS_MVIEW.EXPLAIN_REWRITE  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
（'SELECT p.prod_name，SUM（amount_sold）'||  - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'FROM sales s，products p'|| </font><font style="vertical-align: inherit;"> - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'WHERE s.prod_id = p.prod_id'|| </font><font style="vertical-align: inherit;"> - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'AND prod_name&gt;''B％'''|| </font><font style="vertical-align: inherit;"> - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'AND prod_name &lt;''C％'''|| </font><font style="vertical-align: inherit;"> - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'GROUP BY prod_name'， - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'TestXRW.PRODUCT_SALES_MV'， - </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
'SH'）;</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT消息FROM rewrite_table ORDER BY sequence;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
信息                                                                         </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------------------------------------- ------------------------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QSM-01033：使用物化视图PRODUCT_SALES_MV重写查询             </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
选择了1行。</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示文件</font></font><code class="codeph">xrwutl.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个过程，您可以调用该过程以提供更详细的输出</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">更多信息，</font><font style="vertical-align: inherit;">请参见</font></font><span class="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-4A5FD50D-E2AB-4176-BD1B-418E7B2491BB"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于EXPLAIN_REWRITE输出</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是一个示例，您可以在其中更详细地解释为什么不考虑某些物化视图，并最终</font></font><code class="codeph">sales_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择</font><font style="vertical-align: inherit;">物化视图</font><font style="vertical-align: inherit;">作为最佳</font><font style="vertical-align: inherit;">视图</font><font style="vertical-align: inherit;">。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宣布</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  qrytext VARCHAR2（500）：='SELECT cust_first_name，cust_last_name，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 SUM（amount_sold）AS dollar_sales FROM sales s，customers c WHERE s.cust_id =</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 c.cust_id GROUP BY cust_first_name，cust_last_name';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    idno VARCHAR2（30）：='ID1';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  DBMS_MVIEW.EXPLAIN_REWRITE（qrytext，''，idno）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结束;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT消息FROM rewrite_table ORDER BY sequence;</font></font><font></font>
<font></font>
</pre>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL&gt; MESSAGE                                      </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-------------------------------------------------- ------------------------------</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QSM-01082：加入物化视图CAL_MONTH_SALES_MV，表，SALES，不可能</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QSM-01022：比PRODUCT_SALES_MV用于重写的更优化的物化视图</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QSM-01022：比FWEEK_PSCAT_SALES_MV用于重写的更优化的物化视图</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QSM-01033：使用物化视图SALES_MV重写的查询</font></font><font></font>
</pre></div>
<!-- class="example" --></div>
</div>
<a id="DWHSG8564"></a><a id="DWHSG8563"></a>
<div class="props_rev_3"><a id="GUID-F936CEE1-3568-4487-842A-015AFE940F87"></a>
<h4 id="DWHSG-GUID-F936CEE1-3568-4487-842A-015AFE940F87" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Varray查看EXPLAIN_REWRITE输出</font></font></h4>
<div>
<div class="section">
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以保存</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PL / SQL中</font><font style="vertical-align: inherit;">的输出</font></font><code class="codeph">VARRAY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此数组的元素属于类型</font></font><code class="codeph">RewriteMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在</font></font><code class="codeph">SYS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式中</font><font style="vertical-align: inherit;">预定义，</font><font style="vertical-align: inherit;">如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TYPE RewriteMessage是对象（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mv_owner VARCHAR2（30）， -  MV的架构</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mv_name VARCHAR2（30）， -  MV的名称</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  序列号NUMBER（3）， -  msg的序列号 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  query_text VARCHAR2（2000）， - 用户查询</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  query_block_no NUMBER（3）， - 阻止当前子查询的no</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  rewritten_text VARCHAR2（2000）， - 重写的查询文本 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  消息VARCHAR2（512）， -  EXPLAIN_REWRITE错误消息</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  传递VARCHAR2（3）， - 查询重写传递号 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  mv_in_msg VARCHAR2（30）， - 当前消息中的MV </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  measure_in_msg VARCHAR2（30）， - 在当前消息中测量 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  join_back_tbl VARCHAR2（30）， - 在当前消息中加入表 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  join_back_col VARCHAR2（30）， - 在当前消息中加入返回列 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  original_cost NUMBER（10）， - 原始查询的费用 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  rewritten_cost NUMBER（10）， - 成本重写查询 </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  标志NUMBER， - 相关标志</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  reserved1 NUMBER， - 供将来使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  reserved2 VARCHAR2（10） - 供将来使用</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组类型</font></font><code class="codeph">RewriteArrayType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><code class="codeph">RewriteMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的varray，</font><font style="vertical-align: inherit;">在</font></font><code class="codeph">SYS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式中</font><font style="vertical-align: inherit;">预定义</font><font style="vertical-align: inherit;">如下：</font></font></p>
</div>
<!-- class="section" -->
<div class="section">
<ul style="list-style-type: disc;">
<li>
<p><code class="codeph">TYPE RewriteArrayType AS VARRAY(256) OF RewriteMessage;</code></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此数组类型，现在可以声明一个数组变量并在</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句中</font><font style="vertical-align: inherit;">指定它</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每条</font></font><code class="codeph">RewriteMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录都提供有关重写处理的消息。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"></font><code class="codeph">REWRITE_TABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了</font></font><code class="codeph">statement_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用varray作为输出时未使用</font><font style="vertical-align: inherit;">的参数，参数与for相同</font><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">mv_owner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段定义与消息相关的物化视图的所有者。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">mv_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段定义与消息相关的实例化视图的名称。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">sequence</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段定义了应该排序消息的顺序。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">query_text</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段包含正在分析的查询文本的前2000个字符。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">message</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段包含与重写处理相关的消息文本</font></font><code class="codeph">query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</li>
<li>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code class="codeph">flags</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">reserved1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">reserved2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段留作将来使用。</font></font></p>
</li>
</ul>
</div>
<!-- class="section" -->
<div class="example" id="GUID-F936CEE1-3568-4487-842A-015AFE940F87__GUID-B0470E88-BB63-4361-8FB4-419CC9826993">
<p class="titleinexample"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例11-16 EXPLAIN_REWRITE使用VARRAY</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请考虑以下物化视图：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE MATERIALIZED VIEW avg_sales_city_state_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
启用QUERY REWRITE AS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SELECT c.cust_city，c.cust_state_province，AVG（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，customers c WHERE s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY c.cust_city，c.cust_state_province;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以尝试使用以下查询使用此物化视图：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT c.cust_state_province，AVG（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，customers c WHERE s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY c.cust_state_province;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，查询不会使用此物化视图重写。</font><font style="vertical-align: inherit;">这对于新手用户来说可能非常混乱，因为看起来重写所需的所有信息都存在于物化视图中。</font><font style="vertical-align: inherit;">你可以找到从</font></font><code class="codeph">DBMS_MVIEW.EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那个</font></font><code class="codeph">AVG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不能从给定的计算物化视图。</font><font style="vertical-align: inherit;">问题是，</font></font><code class="codeph">ROLLUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里需要和</font></font><code class="codeph">AVG</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求</font></font><code class="codeph">COUNT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">SUM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">做</font></font><code class="codeph">ROLLUP</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一个查询的示例PL / SQL块，使用a </font></font><code class="codeph">VARRAY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为其输出，如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SET SERVEROUTPUT ON</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
宣布</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Rewrite_Array SYS.RewriteArrayType：= SYS.RewriteArrayType（）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  querytxt VARCHAR2（1500）：='SELECT c.cust_state_province，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  AVG（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   FROM sales s，customers c WHERE s.cust_id = c.cust_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   GROUP BY c.cust_state_province';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  我号码;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  DBMS_MVIEW.EXPLAIN_REWRITE（querytxt，'AVG_SALES_CITY_STATE_MV'，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Rewrite_Array）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  FOR i IN 1..Rewrite_Array.count</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  环</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
    DBMS_OUTPUT.PUT_LINE（Rewrite_Array（ⅰ）.message）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  结束循环;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结束;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是此</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明</font><font style="vertical-align: inherit;">的输出</font><font style="vertical-align: inherit;">：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QSM-01065：物化视图AVG_SALES_CITY_STATE_MV无法计算</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在查询中测量AVG</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QSM-01101：汇总发生在mv，AVG_SALES_CITY_STATE_MV</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QSM-01053：表上的NORELY参照完整性约束，CUSTOMERS，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  在TRUSTED / STALE TOLERATED完整性模式</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / SQL过程成功完成。</font></font><font></font>
</pre></div>
<!-- class="example" --></div>
</div>
<a id="DWHSG8565"></a>
<div class="props_rev_3"><a id="GUID-EB88C4EC-D843-4AB5-934D-063894CE51D5"></a>
<h4 id="DWHSG-GUID-EB88C4EC-D843-4AB5-934D-063894CE51D5" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXPLAIN_REWRITE福利统计</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的输出</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含两列，</font></font><code class="codeph">original_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且</font></font><code class="codeph">rewritten_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它可以帮助你估算的查询成本。</font></font><code class="codeph">original_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在禁用查询重写时，给出优化程序对查询成本的估计。</font></font><code class="codeph">rewritten_cost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当使用物化视图重写查询时，给出优化器对查询成本的估计。</font><font style="vertical-align: inherit;">这些成本值可用于找出特定查询从重写中获得的好处。</font></font></p>
</div>
</div>
<a id="DWHSG8566"></a>
<div class="props_rev_3"><a id="GUID-80AAF9D9-DA04-4804-931D-432CF883CE54"></a>
<h4 id="DWHSG-GUID-80AAF9D9-DA04-4804-931D-432CF883CE54" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在EXPLAIN_REWRITE中支持大于32KB的查询文本</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此版本中，该</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程已得到增强，可支持大型查询。</font><font style="vertical-align: inherit;">现在可以使用</font></font><code class="codeph">CLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据类型而不是数据类型来</font><font style="vertical-align: inherit;">定义输入查询文本</font></font><code class="codeph">VARCHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这允许</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受最多4 GB的查询。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using </font></font><code class="codeph">CLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取表输出</font><font style="vertical-align: inherit;">的语法</font><font style="vertical-align: inherit;">如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_MVIEW.EXPLAIN_REWRITE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   查询IN CLOB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   mv IN VARCHAR2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   statement_id IN VARCHAR2）;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二个参数，</font></font><code class="codeph">mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和第三个参数</font></font><code class="codeph">statement_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以是</font></font><code class="codeph">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">类似地，使用</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using </font></font><code class="codeph">CLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来获取输出到varray </font><font style="vertical-align: inherit;">的语法</font><font style="vertical-align: inherit;">如下所示：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_MVIEW.EXPLAIN_REWRITE（</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   查询IN CLOB，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   mv IN VARCHAR2，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   msg_array IN OUT SYS.RewriteArrayType）;</font></font><font></font>
 <font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和以前一样，第二个参数</font></font><code class="codeph">mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以是</font></font><code class="codeph">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，</font></font><code class="codeph">CLOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用程序</font></font><code class="codeph">DBMS_LOB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包中</font><font style="vertical-align: inherit;">提供的过程生</font><font style="vertical-align: inherit;">成长查询文本</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG8567"></a>
<div class="props_rev_3"><a id="GUID-C6BFEB7A-B1E3-4E08-B38D-87FA3D6B1BBC"></a>
<h4 id="DWHSG-GUID-C6BFEB7A-B1E3-4E08-B38D-87FA3D6B1BBC" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于EXPLAIN_REWRITE和多个物化视图</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与多个物化视图一起</font><font style="vertical-align: inherit;">使用的语法</font><font style="vertical-align: inherit;">与使用单个物化视图</font><font style="vertical-align: inherit;">的语法</font><font style="vertical-align: inherit;">相同，只是物化视图由逗号分隔的字符串指定。</font><font style="vertical-align: inherit;">例如，为了找出是否一个给定的物化视图</font></font><code class="codeph">mv1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">mv2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font><code class="codeph">mv3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于重写查询，</font></font><code class="codeph">query_txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及，如果没有，为什么不呢，使用</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DBMS_MVIEW.EXPLAIN_REWRITE（query_txt，'mv1，mv2，mv3'）
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询</font></font><code class="codeph">query_txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用给定的物化视图集重写，则会显示以下消息：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QSM-01127：使用物化视图，mv1，mv2和mv3重写的查询。
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询无法使用一组或多组给定的物化视图重写，则将针对</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未参与重写的每个物化视图</font><font style="vertical-align: inherit;">输出失败的原因</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG8568"></a>
<div class="props_rev_3"><a id="GUID-4A5FD50D-E2AB-4176-BD1B-418E7B2491BB"></a>
<h4 id="DWHSG-GUID-4A5FD50D-E2AB-4176-BD1B-418E7B2491BB" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于EXPLAIN_REWRITE输出</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示如何使用的一些示例</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括在内</font></font><code class="codeph">/rdbms/demo/smxrw.sql</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">还有一个名为</font></font><code class="codeph">SYS.XRW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含在演示</font></font><code class="codeph">xrw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区域中</font><font style="vertical-align: inherit;">的实用程序</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">可帮助您从</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程中</font><font style="vertical-align: inherit;">选择输出</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在</font></font><code class="codeph">EXPLAIN_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估查询时，其输出包括诸如重写的查询文本，查询块编号和重写查询的成本之类的信息。</font><font style="vertical-align: inherit;">该实用程序</font></font><code class="codeph">SYS.XRW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以整齐的格式输出用户指定的字段，以便可以轻松理解输出。</font><font style="vertical-align: inherit;">语法如下：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SYS.XRW（list_of_mvs，list_of_commands，query_text），
</font></font></pre>
<p><font style="vertical-align: inherit;"></font><code class="codeph">list_of_mvs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户希望查询重写使用的物化视图在</font><font style="vertical-align: inherit;">哪里</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果有多个物化视图，则必须用逗号分隔，并且</font></font><code class="codeph">list_of_commands</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是以下字段之一：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QUERY_TXT：用户查询文本</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REWRITTEN_TXT：重写的查询文本</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
QUERY_BLOCK_NO：查询块编号以标识每个查询块</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                case查询具有子查询或内联视图</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PASS：Pass表示是否生成了给定的消息</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                在查询重写的视图合并过程之前或之后。</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
成本：成本表示估计的执行成本</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
                原始查询和重写的查询</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下示例说明了此实用程序的用法：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DROP MATERIALIZED VIEW month_sales_mv;</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CREATE MATERIALIZED VIEW month_sales_mv</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  启用QUERY REWRITE</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  如</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SELECT t.calendar_month_number，SUM（s.amount_sold）AS sum_dollars</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  从销售s，时间t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE.time_id = t.time_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY t.calendar_month_number;</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SET SERVEROUTPUT ON</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
宣布</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  querytxt VARCHAR2（1500）：='SELECT t.calendar_month_number，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         SUM（s.amount_sold）AS sum_dollars FROM sales s，times t</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  WHERE.time_id = t.time_id GROUP BY t.calendar_month_number';</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
开始</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  SYS.XRW（'MONTH_SALES_MV'，'COSTS，PASS，REWRITTEN_TXT，QUERY_BLOCK_NO'，querytxt）;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
结束;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下是输出</font></font><code class="codeph">SYS.XRW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从输出中可以看出，</font></font><code class="codeph">SYS.XRW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出原始查询成本，重写成本，重写查询文本，查询块编号以及是否在视图合并过程之前或之后生成消息。</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt;消息：QSM-01151：查询被重写</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt; RW QUERY：选择MONTH_SALES_MV.CALENDAR_MONTH_NUMBER CALENDAR_MONTH_NUMBER，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
来自SH.MONTH_SALES_MV MONTH_SALES_MV的MONTH_SALES_MV.SUM_DOLLARS SUM_DOLLARS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt; ORIG COST：19.952763130792 RW成本：1.80687108</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
================================================== ==========================</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
------------------------- QUERY REWRITE的分析--------------------- ----</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt; QRY BLK＃：0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt;消息：QSM-01209：用物化视图重写的查询， </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   MONTH_SALES_MV，使用文本匹配算法</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt; RW QUERY：选择MONTH_SALES_MV.CALENDAR_MONTH_NUMBER CALENDAR_MONTH_NUMBER，</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   来自SH.MONTH_SALES_MV MONTH_SALES_MV的MONTH_SALES_MV.SUM_DOLLARS SUM_DOLLARS</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt; ORIG COST：19.952763130792 RW成本：1.80687108</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
&gt;&gt;在观看之前的消息输出......</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
============================消息结束=================== ============</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PL / SQL过程成功完成。</font></font><font></font>
</pre></div>
</div>
</div>
</div>
<a id="DWHSG0806"></a>
<div class="props_rev_3"><a id="GUID-098C13EA-774C-49D9-8199-A8092BA7D437"></a>
<h2 id="DWHSG-GUID-098C13EA-774C-49D9-8199-A8092BA7D437" class="sect2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提高查询重写能力的设计考虑因素</font></font></h2>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论有助于从查询重写中获得最大好处的设计注意事项。</font><font style="vertical-align: inherit;">它们不是强制使用查询重写，如果您遵循它们，则无法保证重写。</font><font style="vertical-align: inherit;">它们是要考虑的一般规则，如下：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-63E9C200-ECCD-4498-8EEE-F744AA0F1249"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：约束</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-80545DAD-1A1C-44B3-9D81-D1CEC7C397EA"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：维度</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-7C1DD903-100F-4E7B-8333-DA9CEF5BA2FE"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：外部联接</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-62FBB3B4-D352-4A0E-AEF7-450421F8E2C1"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：文本匹配</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-FD786B39-80E0-4725-A974-8B18D3568919"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：聚合</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-B3149060-5313-450B-84CA-0199B62D2F13"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：分组条件</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-402A542B-BB8D-4113-A2CB-C1DAB9D3EDF6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：表达式匹配</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-65FD33D7-DEBD-4164-B49F-514B5419480C"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：日期折叠</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C576AD61-4EEA-4F52-9E2E-8A2185D898FA"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：统计信息</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-30951956-2D59-4543-B421-7FA078315C9F"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：提示</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8569"></a>
<div class="props_rev_3"><a id="GUID-63E9C200-ECCD-4498-8EEE-F744AA0F1249"></a>
<h3 id="DWHSG-GUID-63E9C200-ECCD-4498-8EEE-F744AA0F1249" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：约束</font></font></h3>
<div>
<p><a id="d39287e6623" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保在物化视图中引用的所有内部联接都具有参照完整性（外键/主键约束）以及</font></font><code class="codeph">NOT</code> <code class="codeph">NULL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对外键列的</font><font style="vertical-align: inherit;">附加</font><font style="vertical-align: inherit;">约束。</font><font style="vertical-align: inherit;">因为约束往往会产生很大的开销，所以你可以创建它们</font></font><code class="codeph">NO</code> <code class="codeph">VALIDATE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将</font></font><code class="codeph">RELY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数设置</font></font><code class="codeph">QUERY_REWRITE_INTEGRITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code class="codeph">STALE_TOLERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，如果设置</font></font><code class="codeph">QUERY_REWRITE_INTEGRITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code class="codeph">ENFORCED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则必须启用，强制和验证所有约束以获得最大可重写性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您应该避免使用该</font></font><code class="codeph">ON</code> <code class="codeph">DELETE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，因为它可能导致意外结果。</font></font></p>
</div>
</div>
<a id="DWHSG8570"></a>
<div class="props_rev_3"><a id="GUID-80545DAD-1A1C-44B3-9D81-D1CEC7C397EA"></a>
<h3 id="DWHSG-GUID-80545DAD-1A1C-44B3-9D81-D1CEC7C397EA" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：维度</font></font></h3>
<div>
<p><a id="d39287e6688" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用维度的</font></font><code class="codeph">HIERARCHY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">DETERMINES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句表示</font><font style="vertical-align: inherit;">规范化或非规范化维度表中的层次关系和函数依赖关系</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">维度可以表达不能由约束表达的表内关系。</font><font style="vertical-align: inherit;">将参数设置</font></font><code class="codeph">QUERY_REWRITE_INTEGRITY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code class="codeph">TRUSTED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code class="codeph">STALE_TOLERATED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于查询重写，以利用维度中声明的关系。</font></font></p>
</div>
</div>
<a id="DWHSG8571"></a>
<div class="props_rev_3"><a id="GUID-7C1DD903-100F-4E7B-8333-DA9CEF5BA2FE"></a>
<h3 id="DWHSG-GUID-7C1DD903-100F-4E7B-8333-DA9CEF5BA2FE" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：外部联接</font></font></h3>
<div>
<p><a id="d39287e6730" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免约束的另一种方法是在物化视图中使用外连接。</font><font style="vertical-align: inherit;">查询重写将能够在查询中派生内部联接，例如</font></font><code class="codeph">(A.a=B.b)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从物化视图中的外部</font></font><code class="codeph">(A.a = B.b(+))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联接，只要</font><font style="vertical-align: inherit;">物化视图</font><font style="vertical-align: inherit;">中的rowid </font></font><code class="codeph">B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或列</font></font><code class="codeph">B.b</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用。</font><font style="vertical-align: inherit;">大多数对具有外连接的重写的支持仅针对具有连接的物化视图提供。</font><font style="vertical-align: inherit;">要利用它，具有外连接的物化视图应存储外连接的内部表的rowid或主键。</font><font style="vertical-align: inherit;">例如，物化视图</font></font><code class="codeph">join_sales_time_product_mv_oj</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储主键</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">time_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外连接的内部表。</font></font></p>
</div>
</div>
<a id="DWHSG8572"></a>
<div class="props_rev_3"><a id="GUID-62FBB3B4-D352-4A0E-AEF7-450421F8E2C1"></a>
<h3 id="DWHSG-GUID-62FBB3B4-D352-4A0E-AEF7-450421F8E2C1" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：文本匹配</font></font></h3>
<div>
<p><a id="d39287e6778" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果需要加速极其复杂，长时间运行的查询，可以使用查询的确切文本创建实体化视图。</font><font style="vertical-align: inherit;">然后，物化视图将包含查询结果，从而消除执行任何复杂连接所需的时间，并搜索所需数据。</font></font></p>
</div>
</div>
<a id="DWHSG8573"></a>
<div class="props_rev_3"><a id="GUID-FD786B39-80E0-4725-A974-8B18D3568919"></a>
<h3 id="DWHSG-GUID-FD786B39-80E0-4725-A974-8B18D3568919" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：聚合</font></font></h3>
<div>
<p><a id="d39287e6804" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要从查询重写中获得最大收益，请确保在物化视图中存在计算目标查询集中所需聚合所需的所有聚合。</font><font style="vertical-align: inherit;">聚合的条件与增量刷新的条件非常相似。</font><font style="vertical-align: inherit;">例如，如果</font></font><code class="codeph">AVG(x)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在查询中，那么你应该存储</font></font><code class="codeph">COUNT(x)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code class="codeph">AVG(x)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或储存</font></font><code class="codeph">SUM(x)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code class="codeph">COUNT(x)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在物化视图。</font><font style="vertical-align: inherit;">有关</font><font style="vertical-align: inherit;">快速刷新要求，</font><font style="vertical-align: inherit;">请参阅</font></font><span class="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.oracle.com/database/121/DWHSG/basicmv.htm#GUID-505C24CF-5D56-4820-88AA-2221410950E7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速刷新的一般限制</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG8574"></a>
<div class="props_rev_3"><a id="GUID-B3149060-5313-450B-84CA-0199B62D2F13"></a>
<h3 id="DWHSG-GUID-B3149060-5313-450B-84CA-0199B62D2F13" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：分组条件</font></font></h3>
<div>
<p><a id="d39287e6850" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在层次结构中较低级别聚合数据比在较高级别聚合更好，因为较低级别可用于重写更多查询。</font><font style="vertical-align: inherit;">但请注意，这样做也会占用更多空间。</font><font style="vertical-align: inherit;">例如，不是在州上分组，而是在城市上分组（除非空间限制禁止它）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是使用重叠或分层相关的</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">创建多个物化视图，而是</font><font style="vertical-align: inherit;">使用所有这些</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">创建单个物化视图</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，不使用按城市分组的物化视图和按月分组的其他物化视图，而是使用按城市和月份分组的单个物化视图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与维度中的级别对应但不依赖于功能相关的列的列，因为查询重写将能够基于</font></font><code class="codeph">DETERMINES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维度中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">自动使用功能依赖性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">例如，代替分组</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，分组</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（只要有一个指示属性</font></font><code class="codeph">prod_id</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定</font><font style="vertical-align: inherit;">的维度</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，您将启用重写涉及的查询</font></font><code class="codeph">prod_name</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></p>
</div>
</div>
<a id="DWHSG8575"></a>
<div class="props_rev_3"><a id="GUID-402A542B-BB8D-4113-A2CB-C1DAB9D3EDF6"></a>
<h3 id="DWHSG-GUID-402A542B-BB8D-4113-A2CB-C1DAB9D3EDF6" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：表达式匹配</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果多个查询共享相同的公共子选择，则创建具有公共子选择作为其</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">之一的物化视图是有利的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样，可以跨多个查询获得由于公共子选择的预计算而导致的性能益处。</font></font></p>
</div>
</div>
<a id="DWHSG8576"></a>
<div class="props_rev_3"><a id="GUID-65FD33D7-DEBD-4164-B49F-514B5419480C"></a>
<h3 id="DWHSG-GUID-65FD33D7-DEBD-4164-B49F-514B5419480C" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：日期折叠</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建通过折叠日期粒度（例如月或季度或年份）聚合数据的物化视图时，始终使用年份组件作为前缀，但不使用后缀。</font><font style="vertical-align: inherit;">例如，</font></font><code class="codeph">TO_CHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="codeph">date_col</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><code class="codeph">'yyyy-q'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）将日期折叠为四分之一，按年份顺序整理，而</font></font><code class="codeph">TO_CHAR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><code class="codeph">date_col, 'q-yyyy'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）将日期折叠为四分之一，按季度整理。</font><font style="vertical-align: inherit;">前者保留了排序，而后者则没有。</font><font style="vertical-align: inherit;">因此，任何没有年前缀创建的物化视图都不符合日期折叠重写的条件。</font></font></p>
</div>
</div>
<a id="DWHSG8577"></a>
<div class="props_rev_3"><a id="GUID-C576AD61-4EEA-4F52-9E2E-8A2185D898FA"></a>
<h3 id="DWHSG-GUID-C576AD61-4EEA-4F52-9E2E-8A2185D898FA" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：统计信息</font></font></h3>
<div>
<p><a id="d39287e6980" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">物化视图的优化基于成本，优化器需要物化视图和查询中的表的统计信息，以进行基于成本的选择。</font><font style="vertical-align: inherit;">因此，物化视图应使用</font></font><code class="codeph">DBMS_STATS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包</font><font style="vertical-align: inherit;">收集统计数据</font><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
<a id="DWHSG8578"></a>
<div class="props_rev_3"><a id="GUID-30951956-2D59-4543-B421-7FA078315C9F"></a>
<h3 id="DWHSG-GUID-30951956-2D59-4543-B421-7FA078315C9F" class="sect3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写注意事项：提示</font></font></h3>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节讨论以下注意事项：</font></font></p>
<ul style="list-style-type: disc;">
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-AB5DA1BA-C714-420F-B329-370D1E68EB82"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：REWRITE和NOREWRITE提示</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-C535DD88-E429-47CE-8F9D-040ADA30261C"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：REWRITE_OR_ERROR提示</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-BB34C03E-88FB-408A-8486-A8F2C9670C08"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：多个物化视图重写提示</font></font></a></p>
</li>
<li>
<p style="margin: 0px;"><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-DF01D4B0-1E95-400B-9815-63725519E5F0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：EXPAND_GSET_TO_UNION提示</font></font></a></p>
</li>
</ul>
</div>
<a id="DWHSG8579"></a>
<div class="props_rev_3"><a id="GUID-AB5DA1BA-C714-420F-B329-370D1E68EB82"></a>
<h4 id="DWHSG-GUID-AB5DA1BA-C714-420F-B329-370D1E68EB82" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：REWRITE和NOREWRITE提示</font></font></h4>
<div>
<p><a id="d39287e7050" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL语句</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">块中</font><font style="vertical-align: inherit;">包含提示，</font><font style="vertical-align: inherit;">以控制是否发生查询重写。</font><font style="vertical-align: inherit;">使用</font></font><a id="d39287e7058" class="indexterm-anchor"></a><a id="d39287e7062" class="indexterm-anchor"></a><a id="d39287e7064" class="indexterm-anchor"></a><a id="d39287e7066" class="indexterm-anchor"></a><a id="d39287e7070" class="indexterm-anchor"></a><a id="d39287e7076" class="indexterm-anchor"></a><a id="d39287e7082" class="indexterm-anchor"></a><a id="d39287e7089" class="indexterm-anchor"></a> <code class="codeph">NOREWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 查询中的提示会阻止优化程序重写它。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><code class="codeph">REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示</font></font><a id="d39287e7102" class="indexterm-anchor"></a><a id="d39287e7104" class="indexterm-anchor"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询中没有参数，则强制优化器使用实例化视图（如果有）来重写它，而不管成本如何。</font><font style="vertical-align: inherit;">如果使用</font></font><code class="codeph">REWRITE(mv1,mv2,...)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带参数</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">提示，则强制重写以从指定的名称列表中选择最合适的物化视图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要防止重写，可以使用以下语句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + NOREWRITE * / p.p​​rod_subcategory，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，products p WHERE s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要强制使用重写</font></font><code class="codeph">sum_sales_pscat_week_mv</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（如果可以重写），请使用以下语句：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + REWRITE（sum_sales_pscat_week_mv）* / </font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       p.prod_subcategory，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，products p WHERE s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory;</font></font><font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，重写提示的范围是查询块。</font><font style="vertical-align: inherit;">如果SQL语句由多个查询块（</font></font><code class="codeph">SELECT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句）组成，则必须在每个查询块上指定重写提示以控制整个语句的重写。</font></font></p>
</div>
</div>
<a id="DWHSG8580"></a>
<div class="props_rev_3"><a id="GUID-C535DD88-E429-47CE-8F9D-040ADA30261C"></a>
<h4 id="DWHSG-GUID-C535DD88-E429-47CE-8F9D-040ADA30261C" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：REWRITE_OR_ERROR提示</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运用</font></font><a id="d39287e7150" class="indexterm-anchor"></a><a id="d39287e7152" class="indexterm-anchor"></a><font style="vertical-align: inherit;"></font><code class="codeph">REWRITE_OR_ERROR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果查询无法重写，查询中</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">提示会导致以下错误：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ORA-30393：语句中的查询块没有重写
</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，当没有合适的物化视图供查询重写使用时，以下查询会发出ORA-30393错误：</font></font></p>
<pre dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT / * + REWRITE_OR_ERROR * / p.p​​rod_subcategory，SUM（s.amount_sold）</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FROM sales s，products p WHERE s.prod_id = p.prod_id</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GROUP BY p.prod_subcategory;</font></font><font></font>
</pre></div>
</div>
<a id="DWHSG8581"></a>
<div class="props_rev_3"><a id="GUID-BB34C03E-88FB-408A-8486-A8F2C9670C08"></a>
<h4 id="DWHSG-GUID-BB34C03E-88FB-408A-8486-A8F2C9670C08" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：多个物化视图重写提示</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用多个物化视图时，有两个提示可以控制重写。</font><font style="vertical-align: inherit;">该</font></font><code class="codeph">NO_MULTIMV_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示可防止使用多个物化视图重写查询，并且该</font></font><code class="codeph">NO_BASETABLE_MULTIMV_REWRITE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示可防止使用物化视图和基表的组合重写查询。</font></font></p>
</div>
</div>
<a id="DWHSG8582"></a>
<div class="props_rev_3"><a id="GUID-DF01D4B0-1E95-400B-9815-63725519E5F0"></a>
<h4 id="DWHSG-GUID-DF01D4B0-1E95-400B-9815-63725519E5F0" class="sect4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询重写：EXPAND_GSET_TO_UNION提示</font></font></h4>
<div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你可以使用</font></font><a id="d39287e7217" class="indexterm-anchor"></a><a id="d39287e7221" class="indexterm-anchor"></a> <code class="codeph">EXPAND_GSET_TO_UNION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示强制扩展查询</font></font><code class="codeph">GROUP</code> <code class="codeph">BY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩展到等效</font></font><code class="codeph">UNION</code> <code class="codeph">ALL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询。</font><font style="vertical-align: inherit;">有关详细信息，请参阅</font></font><span class="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ </font></font><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#GUID-05CFC633-105D-45AB-97A0-805AEC29BFFF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用扩展GROUP BY重写查询的提示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”</font></font></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
</div>
</div>
</div>
</div>
<div id="bar3" class="border-top glyph" style="position: relative; text-align: center;"><span style="position: absolute; left: 8px; top: 8px;"><a href="https://docs.oracle.com/database/121/DWHSG/qrbasic.htm" title="转到上一页"><span class="JetFW-caret-w_16"></span><span class="hide-mobile-inline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一页</font></font></span></a></span><div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第17页，共32页</font></font></div><span style="position: absolute; right: 8px; top: 8px;"><a href="https://docs.oracle.com/database/121/DWHSG/attcluster.htm" title="转到下一页"><span class="hide-mobile-inline"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一页</font></font></span><span class="JetFW-caret-e_16"></span></a></span></div></div>
<!-- class="ind" --><!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><div class="footer-container clearboth"><div style="max-width: 994px; padding: 10px 0px 0px 17px;"><div id="footernav" class="glyph"><ul><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#" style="font-size: 12px;"><img width="16" height="16" alt="选择你的语言" src="./物化视图的高级查询重写_files/func_worldglobe_16_act.png" style="vertical-align: middle; margin: 0px 4px;"><span class="JetFW-caret-n_16"> </span></a><ul class="shadow"><li><a href="https://docs.oracle.com/database/121/DWHSG/qradv.htm#" style="font-size: 12px;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">英语</font></font></a></li></ul></li></ul></div><div class="footer-list"><ul><li><a href="http://www.oracle.com/corporate/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于Oracle</font></font></a></li><li><a href="http://www.oracle.com/us/corporate/contact/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联系我们</font></font></a></li><li><a href="http://www.oracle.com/us/legal/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">法律声明</font></font></a></li><li><a href="http://www.oracle.com/us/legal/terms/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用条款</font></font></a></li><li><a href="http://www.oracle.com/us/legal/privacy/index.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的隐私权</font></font></a></li></ul></div><span class="copyright"><a href="http://www.oracle.com/pls/topic/lookup?ctx=cpyr&amp;id=en-US"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有©2001,2017，Oracle和/或其附属公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></a></span></div></div></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>


<div id="_atssh" style="visibility: hidden; height: 1px; width: 1px; position: absolute; top: -9999px; z-index: 100000;"><iframe id="_atssh139" title="AddThis实用程序框架" style="height: 1px; width: 1px; position: absolute; top: 0px; z-index: 100000; border: 0px; left: 0px;" src="./物化视图的高级查询重写_files/sh.e4e8af4de595fdb10ec1459d.html"></iframe></div><style id="service-icons-0"></style><script type="application/javascript" src="./物化视图的高级查询重写_files/ora_docs.js.下载"></script><script src="./物化视图的高级查询重写_files/ora_code_docs.js.下载"></script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./物化视图的高级查询重写_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><script src="./物化视图的高级查询重写_files/ora_code.js.下载"></script><div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>